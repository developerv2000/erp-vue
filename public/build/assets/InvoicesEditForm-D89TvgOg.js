import{u as j,d as T,l as b,h as C,m as A,p as L,s as z,D as O,j as G,c as V,o as n,w as o,a,g,t as F,b as e,e as H,f as J,F as K,r as Q,E as W,k as X}from"./app-7F7n231s.js";import{u as Y,F as Z}from"./vee-validate-DitXN_gH.js";import{u as h}from"./useVeeFormFields-D3hBZ0Tv.js";import{u as ee}from"./useFormData-DEk4Ge6e.js";import{u as ae}from"./messages-BpNGX81Q.js";import{u as le}from"./useDateFormatter-aJ6VLTy8.js";import{D as k}from"./DefaultSheet-Bm4meVVs.js";import{_ as y}from"./DefaultTitle-DATk8Np2.js";import{_ as S}from"./DefaultWysiwyg-B20h2Gec.js";import{F as se}from"./FormActionsContainer-BjLDdYrs.js";import{_ as oe}from"./FormResetButton-C2t87iFc.js";import{a as te,_ as re}from"./FormUpdateWithourRedirect-B6LYWHXu.js";import{_ as ue}from"./DefaultDateInput-LY6Hla1c.js";import{_ as de}from"./DefaultFileInput-4A_vjSaC.js";import{V as w,a as i}from"./VRow-CyQ_eN64.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./StandardLabeledGroup-6CEA9mNA.js";import"./DefaultButton-CwMkA5bK.js";import"./mdi-BZMfrfO1.js";const Be={__name:"InvoicesEditForm",setup(me){const{t:r}=j(),{objectToFormData:B}=ee(),c=T(),f=ae(),{removeDateTimezonesFromFormData:P}=le(),u=b(()=>c.props.record),d=C(!1),p=C(!1),U=A({receive_date:O().required(),pdf_file:z().nullable(),products:L().required().min(1)}),q=b(()=>({receive_date:u.value.receive_date,pdf_file:null,products:u.value.products.map(m=>m.id)})),E={comment:null},_=b(()=>({...q.value,...E})),{handleSubmit:I,errors:v,setErrors:N,resetForm:$,meta:D}=Y({validationSchema:U,initialValues:_.value}),{values:t}=h(Object.keys(_.value)),x=I(m=>{const l=B(m);P(l),d.value=!0,axios.post(route("cmd.invoices.update",{record:u.value.id}),l).then(()=>{f.addUpdatedSuccessfullyMessage(),p.value?window.history.back():R()}).catch(s=>{s.response?.status===422?(N(s.response.data.errors),f.addFixErrorsMessage()):f.addSubmitionFailedMessage()}).finally(()=>{d.value=!1})}),R=()=>{G.reload({only:["record","availableProducts"],onSuccess:()=>{$({values:_.value})}})};return(m,l)=>(n(),V(e(Z),{class:"d-flex flex-column ga-6 pb-8",enctype:"multipart/form-data"},{default:o(()=>[a(k,null,{default:o(()=>[a(y,null,{default:o(()=>[g(F(e(r)("Invoice")),1)]),_:1}),a(w,null,{default:o(()=>[a(i,null,{default:o(()=>[a(ue,{label:e(r)("dates.Receive"),modelValue:e(t).receive_date,"onUpdate:modelValue":l[0]||(l[0]=s=>e(t).receive_date=s),"error-messages":e(v).receive_date,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),a(i,null,{default:o(()=>[a(de,{label:e(r)("fields.Pdf"),modelValue:e(t).pdf_file,"onUpdate:modelValue":l[1]||(l[1]=s=>e(t).pdf_file=s),"error-messages":e(v).pdf_file,accept:".pdf",required:""},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),a(k,null,{default:o(()=>[a(y,null,{default:o(()=>[g(F(e(r)("Products")),1)]),_:1}),H("div",null,[(n(!0),J(K,null,Q(e(c).props.availableProducts,s=>(n(),V(W,{key:s.id,modelValue:e(t).products,"onUpdate:modelValue":l[2]||(l[2]=M=>e(t).products=M),value:s.id,label:s.process.full_english_product_label,disabled:e(c).props.isPrepayment,color:"primary"},null,8,["modelValue","value","label","disabled"]))),128))])]),_:1}),a(k,null,{default:o(()=>[a(y,null,{default:o(()=>[g(F(e(r)("Comments")),1)]),_:1}),a(w,null,{default:o(()=>[a(i,null,{default:o(()=>[a(S,{modelValue:e(t).comment,"onUpdate:modelValue":l[3]||(l[3]=s=>e(t).comment=s),label:e(r)("comments.New"),"error-messages":e(v).comment,folder:"comments"},null,8,["modelValue","label","error-messages"])]),_:1}),u.value.last_comment?(n(),V(i,{key:0},{default:o(()=>[a(S,{modelValue:u.value.last_comment.body,"onUpdate:modelValue":l[4]||(l[4]=s=>u.value.last_comment.body=s),label:e(r)("comments.Last"),disabled:""},null,8,["modelValue","label"])]),_:1})):X("",!0)]),_:1})]),_:1}),a(se,null,{default:o(()=>[a(oe,{onClick:e($),loading:d.value},null,8,["onClick","loading"]),a(te,{onClick:l[5]||(l[5]=s=>{p.value=!1,e(x)()}),loading:d.value,disabled:!e(D).valid},null,8,["loading","disabled"]),a(re,{onClick:l[6]||(l[6]=s=>{p.value=!0,e(x)()}),loading:d.value,disabled:!e(D).valid},null,8,["loading","disabled"])]),_:1})]),_:1}))}};export{Be as default};
