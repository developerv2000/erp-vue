import{u as T,d as G,l as f,h as P,q as H,n as L,s as _,m as Q,j as z,c,o as p,w as o,a as l,k,g as $,t as y,b as e}from"./app-B129XDPu.js";import{u as J,F as K}from"./vee-validate-CT_T1e_1.js";import{u as W}from"./useVeeFormFields-C7o3I6cE.js";import{u as X}from"./useFormData-DEk4Ge6e.js";import{u as Y}from"./messages-DtWWhcER.js";import{u as Z}from"./global-B0kfi4Ll.js";import{D as F}from"./DefaultSheet-COzA4QDz.js";import{_ as C}from"./DefaultTitle-BPZyLOkx.js";import{_ as h}from"./DefaultAutocomplete-Dcd2lVOE.js";import{_ as w}from"./DefaultWysiwyg-kqqXvPKv.js";import{_ as M}from"./DefaultNumberInput-DgKsvjuT.js";import{F as ee}from"./FormActionsContainer-BDpsr5uj.js";import{_ as le}from"./FormResetButton-B3uCjbKj.js";import{a as ae,_ as oe}from"./FormUpdateWithourRedirect-DeHLfOue.js";import{_ as q}from"./DefaultTextField-CV9Mh93M.js";import{_ as b}from"./DefaultFileInput-CtllTJad.js";import{V as U,a as i}from"./VRow-B7t-PEF8.js";import"./useAuth-CdIBRpE4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./StandardLabeledGroup-f4crissH.js";import"./filter-CIvQV_OK.js";import"./WrappedLabelGroup-C3GCCjx7.js";import"./VNumberInput-CHjdEx4I.js";import"./DefaultButton-CvVzxMjx.js";import"./mdi-BiCQTzTv.js";const we={__name:"OrderProductsEditForm",setup(se){const{t}=T(),{objectToFormData:E}=X(),N=G(),g=Y();Z();const r=f(()=>N.props.record),m=P(!1),v=P(!1),O=f(()=>{const n={price:H().required()};return r.value?.production_is_started&&(n.production_status=L().nullable()),r.value?.can_be_prepared_for_shipping_from_manufacturer&&(n.packing_list_file=_().nullable(),n.coa_file=_().nullable(),n.coo_file=_().nullable(),n.declaration_for_europe_file=_().nullable()),Q(n)}),R=f(()=>({price:Number(r.value.price??r.value.process.agreed_price),production_status:r.value.production_is_started?r.value.production_status:null,packing_list_file:null,coa_file:null,coo_file:null,declaration_for_europe_file:null})),A={comment:null},V=f(()=>({...R.value,...A})),{handleSubmit:j,errors:d,setErrors:B,resetForm:x,meta:S}=J({validationSchema:O,initialValues:V.value}),{values:u}=W(Object.keys(V.value)),D=j(n=>{const a=E(n);m.value=!0,axios.post(route("cmd.order-products.update",{record:r.value.id}),a).then(()=>{g.addUpdatedSuccessfullyMessage(),v.value?window.history.back():I()}).catch(s=>{s.response?.status===422?(B(s.response.data.errors),g.addFixErrorsMessage()):g.addSubmitionFailedMessage()}).finally(()=>{m.value=!1})}),I=()=>{z.reload({only:["record"],onSuccess:()=>{x({values:V.value})}})};return(n,a)=>(p(),c(e(K),{class:"d-flex flex-column ga-6 pb-8",enctype:"multipart/form-data"},{default:o(()=>[l(F,null,{default:o(()=>[l(C,null,{default:o(()=>[$(y(e(t)("Product")),1)]),_:1}),l(U,null,{default:o(()=>[l(i,{cols:"4"},{default:o(()=>[l(q,{label:e(t)("fields.TM Eng"),value:r.value.process.full_english_product_label,disabled:""},null,8,["label","value"])]),_:1}),l(i,{cols:"4"},{default:o(()=>[l(h,{label:e(t)("fields.MAH"),value:r.value.process.mah.name,disabled:""},null,8,["label","value"])]),_:1}),l(i,{cols:"4"},{default:o(()=>[l(M,{label:e(t)("fields.Quantity"),value:r.value.quantity,disabled:""},null,8,["label","value"])]),_:1}),l(i,{cols:"4"},{default:o(()=>[l(M,{label:e(t)("fields.Price"),modelValue:e(u).price,"onUpdate:modelValue":a[0]||(a[0]=s=>e(u).price=s),"error-messages":e(d).price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),r.value.production_is_started?(p(),c(i,{key:0,cols:"4"},{default:o(()=>[l(q,{label:e(t)("fields.Production status"),modelValue:e(u).production_status,"onUpdate:modelValue":a[1]||(a[1]=s=>e(u).production_status=s),"error-messages":e(d).production_status},null,8,["label","modelValue","error-messages"])]),_:1})):k("",!0)]),_:1})]),_:1}),r.value.can_be_prepared_for_shipping_from_manufacturer?(p(),c(F,{key:0},{default:o(()=>[l(C,null,{default:o(()=>[$(y(e(t)("titles.Prepare for shipment")),1)]),_:1}),l(U,null,{default:o(()=>[l(i,{cols:"4"},{default:o(()=>[l(b,{label:e(t)("fields.Packing list"),modelValue:e(u).packing_list_file,"onUpdate:modelValue":a[2]||(a[2]=s=>e(u).packing_list_file=s),"error-messages":e(d).packing_list_file},null,8,["label","modelValue","error-messages"])]),_:1}),l(i,{cols:"4"},{default:o(()=>[l(b,{label:e(t)("fields.COA"),modelValue:e(u).coa_file,"onUpdate:modelValue":a[3]||(a[3]=s=>e(u).coa_file=s),"error-messages":e(d).coa_file},null,8,["label","modelValue","error-messages"])]),_:1}),l(i,{cols:"4"},{default:o(()=>[l(b,{label:e(t)("fields.COO"),modelValue:e(u).coo_file,"onUpdate:modelValue":a[4]||(a[4]=s=>e(u).coo_file=s),"error-messages":e(d).coo_file},null,8,["label","modelValue","error-messages"])]),_:1}),l(i,{cols:"4"},{default:o(()=>[l(b,{label:e(t)("fields.Declaration for EUR1"),modelValue:e(u).declaration_for_europe_file,"onUpdate:modelValue":a[5]||(a[5]=s=>e(u).declaration_for_europe_file=s),"error-messages":e(d).declaration_for_europe_file},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1})):k("",!0),l(F,null,{default:o(()=>[l(C,null,{default:o(()=>[$(y(e(t)("Comments")),1)]),_:1}),l(U,null,{default:o(()=>[l(i,null,{default:o(()=>[l(w,{modelValue:e(u).comment,"onUpdate:modelValue":a[6]||(a[6]=s=>e(u).comment=s),label:e(t)("comments.New"),"error-messages":e(d).comment,folder:"comments"},null,8,["modelValue","label","error-messages"])]),_:1}),r.value.last_comment?(p(),c(i,{key:0},{default:o(()=>[l(w,{modelValue:r.value.last_comment.body,"onUpdate:modelValue":a[7]||(a[7]=s=>r.value.last_comment.body=s),label:e(t)("comments.Last"),disabled:""},null,8,["modelValue","label"])]),_:1})):k("",!0)]),_:1})]),_:1}),l(ee,null,{default:o(()=>[l(le,{onClick:e(x),loading:m.value},null,8,["onClick","loading"]),l(ae,{onClick:a[8]||(a[8]=s=>{v.value=!1,e(D)()}),loading:m.value,disabled:!e(S).valid},null,8,["loading","disabled"]),l(oe,{onClick:a[9]||(a[9]=s=>{v.value=!0,e(D)()}),loading:m.value,disabled:!e(S).valid},null,8,["loading","disabled"])]),_:1})]),_:1}))}};export{we as default};
