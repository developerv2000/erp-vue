import{u as T,d as j,l as p,h as U,q as f,m as B,j as H,K as L,c as V,o as v,w as o,a as l,k as z,g as y,t as g,b as e}from"./app-BNo3BRZK.js";import{u as K,F as Q}from"./vee-validate-BGprmE20.js";import{u as G}from"./useVeeFormFields-CcqTQBJf.js";import{u as J}from"./useFormData-CgBSWld4.js";import{u as W}from"./messages-Cs0KdrfF.js";import{D as q}from"./DefaultSheet-DFjuZFHA.js";import{_ as F}from"./DefaultTitle-CflPgBg7.js";import{_ as k}from"./DefaultAutocomplete-DszskMLj.js";import{_ as N}from"./DefaultWysiwyg-Berhlzg0.js";import{F as X}from"./FormActionsContainer-DVRhIQui.js";import{_ as Y}from"./FormResetButton-JYxkgVjV.js";import{_ as Z,a as h}from"./FormUpdateWithourRedirect-CAH9E1oV.js";import{V as C,a as d}from"./VRow-CaL1JTsj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./StandardLabeledGroup-BYx6jjmA.js";import"./filter-l9f7gJs0.js";import"./DefaultButton-DV9vALRm.js";import"./mdi-FFd_BlEo.js";const ye={__name:"OrderProductsEditForm",setup(ee){const{t:r}=T(),{objectToFormData:x}=J(),D=j(),_=W(),i=p(()=>D.props.record),n=U(!1),c=U(!1),I=p(()=>{const u={process_id:f().required(),quantity:f().required(),serialization_type_id:f().required()};return i.value.is_sent_to_confirmation&&(u.price=f().required()),B(u)}),O=p(()=>({process_id:i.value.process_id,quantity:i.value.quantity,serialization_type_id:i.value.serialization_type_id,price:i.value.price})),P={comment:null},b=p(()=>({...O.value,...P})),{handleSubmit:A,errors:$,setErrors:E,resetForm:S,meta:w}=K({validationSchema:I,initialValues:b.value}),{values:s}=G(Object.keys(b.value)),M=A(u=>{const a=x(u);n.value=!0,axios.post(route("pld.order-products.update",{record:i.value.id}),a).then(()=>{_.addUpdatedSuccessfullyMessage(),c.value?window.history.back():R()}).catch(m=>{m.response?.status===422?(E(m.response.data.errors),_.addFixErrorsMessage()):_.addSubmitionFailedMessage()}).finally(()=>{n.value=!1})}),R=()=>{H.reload({only:["record"],onSuccess:()=>{S({values:b.value})}})};return(u,a)=>{const m=L("DefaultNumberInput");return v(),V(e(Q),{class:"d-flex flex-column ga-6 pb-8",enctype:"multipart/form-data"},{default:o(()=>[l(q,null,{default:o(()=>[l(F,null,{default:o(()=>[y(g(e(r)("departments.PLD")),1)]),_:1}),l(C,null,{default:o(()=>[l(d,{cols:"3"},{default:o(()=>[l(k,{label:e(r)("fields.TM Eng"),modelValue:e(s).ready_for_order_process_id,"onUpdate:modelValue":[a[0]||(a[0]=t=>e(s).ready_for_order_process_id=t),a[1]||(a[1]=t=>u.updateMAHOptions(u.field,t))],items:u.readyForOrderProcesses,"item-title":"full_english_product_label_with_id",required:""},null,8,["label","modelValue","items"])]),_:1}),l(d,{cols:"3"},{default:o(()=>[l(k,{label:e(r)("fields.MAH"),modelValue:e(s).process_id,"onUpdate:modelValue":a[2]||(a[2]=t=>e(s).process_id=t),items:u.mahOptions,"item-title":"mah_name_with_id",required:""},null,8,["label","modelValue","items"])]),_:1}),l(d,{cols:"3"},{default:o(()=>[l(m,{label:e(r)("fields.Quantity"),modelValue:e(s).quantity,"onUpdate:modelValue":a[3]||(a[3]=t=>e(s).quantity=t),min:0},null,8,["label","modelValue"])]),_:1}),l(d,{cols:"3"},{default:o(()=>[l(k,{label:e(r)("fields.Serialization type"),modelValue:e(s).serialization_type_id,"onUpdate:modelValue":a[4]||(a[4]=t=>e(s).serialization_type_id=t),items:e(D).props.serializationTypes,required:""},null,8,["label","modelValue","items"])]),_:1})]),_:1})]),_:1}),i.value.is_sent_to_confirmation?(v(),V(q,{key:0},{default:o(()=>[l(F,null,{default:o(()=>[y(g(e(r)("departments.CMD")),1)]),_:1}),l(C,null,{default:o(()=>[l(d,{cols:"4"},{default:o(()=>[l(m,{label:e(r)("fields.Price"),modelValue:e(s).price,"onUpdate:modelValue":a[5]||(a[5]=t=>e(s).price=t),"error-messages":e($).price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1})):z("",!0),l(q,null,{default:o(()=>[l(F,null,{default:o(()=>[y(g(e(r)("Comments")),1)]),_:1}),l(C,null,{default:o(()=>[l(d,null,{default:o(()=>[l(N,{modelValue:e(s).comment,"onUpdate:modelValue":a[6]||(a[6]=t=>e(s).comment=t),label:e(r)("comments.New"),"error-messages":e($).comment,folder:"comments"},null,8,["modelValue","label","error-messages"])]),_:1}),i.value.last_comment?(v(),V(d,{key:0},{default:o(()=>[l(N,{modelValue:i.value.last_comment.body,"onUpdate:modelValue":a[7]||(a[7]=t=>i.value.last_comment.body=t),label:e(r)("comments.Last"),disabled:""},null,8,["modelValue","label"])]),_:1})):z("",!0)]),_:1})]),_:1}),l(X,null,{default:o(()=>[l(Y,{onClick:e(S),loading:n.value},null,8,["onClick","loading"]),l(Z,{onClick:a[8]||(a[8]=t=>{c.value=!0,e(M)()}),loading:n.value,disabled:!e(w).valid},null,8,["loading","disabled"]),l(h,{onClick:a[9]||(a[9]=t=>{c.value=!1,e(M)()}),loading:n.value,disabled:!e(w).valid},null,8,["loading","disabled"])]),_:1})]),_:1})}}};export{ye as default};
