import{u as L,d as G,l as _,h as f,q as b,m as Q,j as h,c as V,o as g,w as s,a,k as U,g as F,t as q,b as e}from"./app-B9LPjWSD.js";import{u as J,F as K}from"./vee-validate-CEw9W1pP.js";import{u as W}from"./useVeeFormFields-TGFQGttC.js";import{u as X}from"./useFormData-DEk4Ge6e.js";import{u as Y}from"./messages-Bx-X0MsL.js";import{u as Z}from"./global-B1_AbHmT.js";import{D as k}from"./DefaultSheet-CUJFLEyh.js";import{_ as S}from"./DefaultTitle-DGhQm38J.js";import{_ as $}from"./DefaultAutocomplete-BXgm-69R.js";import{_ as z}from"./DefaultWysiwyg-B2Vavwb9.js";import{_ as P}from"./DefaultNumberInput-LCLIRzSy.js";import{F as ee}from"./FormActionsContainer-Dq-nzt-A.js";import{_ as ae}from"./FormResetButton-SAU_D-pz.js";import{a as le,_ as oe}from"./FormUpdateWithourRedirect-Dtea9Uf8.js";import{V as w,a as u}from"./VRow-YwEE9k1_.js";import"./useAuth-BdfaLBok.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./StandardLabeledGroup-BZldPcee.js";import"./filter-CLF1nGTb.js";import"./WrappedLabelGroup-DQK6QduX.js";import"./VNumberInput-BGCQJ9Qa.js";import"./DefaultButton-BY5T7BWX.js";import"./mdi-BiCQTzTv.js";const Ce={__name:"OrderProductsEditForm",setup(se){const{t:i}=L(),{objectToFormData:A}=X(),m=G(),p=Y(),x=Z(),r=_(()=>m.props.record),n=f(!1),v=f(!1),E=f(m.props.readyForOrderProcesses),c=f(m.props.mahOptions),N=_(()=>{const d={process_id:b().required(),quantity:b().required(),serialization_type_id:b().required()};return r.value?.is_sent_to_confirmation&&(d.price=b().required()),Q(d)}),R=_(()=>({ready_for_order_process_id:r.value.process_id,process_id:r.value.process_id,quantity:r.value.quantity,serialization_type_id:r.value.serialization_type_id,price:r.value.price})),T={comment:null},y=_(()=>({...R.value,...T})),{handleSubmit:j,errors:C,setErrors:B,resetForm:D,meta:M}=J({validationSchema:N,initialValues:y.value}),{values:t}=W(Object.keys(y.value)),O=j(d=>{const l=A(d);n.value=!0,axios.post(route("pld.order-products.update",{record:r.value.id}),l).then(()=>{p.addUpdatedSuccessfullyMessage(),v.value?window.history.back():H()}).catch(o=>{o.response?.status===422?(B(o.response.data.errors),p.addFixErrorsMessage()):p.addSubmitionFailedMessage()}).finally(()=>{n.value=!1})}),H=()=>{h.reload({only:["record","readyForOrderProcesses"],onSuccess:()=>{D({values:y.value})}})},I=async d=>{if(!d){c.value=[],t.process_id=null;return}x.loading=!0;try{const l=await axios.get(route("pld.get-process-with-it-similar-records-for-order",{process_id:d}));c.value=l.data??[]}catch{c.value=[],p.addSubmitionFailedMessage()}finally{t.process_id=null,x.loading=!1}};return(d,l)=>(g(),V(e(K),{class:"d-flex flex-column ga-6 pb-8",enctype:"multipart/form-data"},{default:s(()=>[a(k,null,{default:s(()=>[a(S,null,{default:s(()=>[F(q(e(i)("departments.PLD")),1)]),_:1}),a(w,null,{default:s(()=>[a(u,{cols:"3"},{default:s(()=>[a($,{label:e(i)("fields.TM Eng"),modelValue:e(t).ready_for_order_process_id,"onUpdate:modelValue":[l[0]||(l[0]=o=>e(t).ready_for_order_process_id=o),I],items:E.value,"item-title":"full_english_product_label_with_id",required:""},null,8,["label","modelValue","items"])]),_:1}),a(u,{cols:"3"},{default:s(()=>[a($,{label:e(i)("fields.MAH"),modelValue:e(t).process_id,"onUpdate:modelValue":l[1]||(l[1]=o=>e(t).process_id=o),items:c.value,"item-title":"mah_name_with_id",required:""},null,8,["label","modelValue","items"])]),_:1}),a(u,{cols:"3"},{default:s(()=>[a(P,{label:e(i)("fields.Quantity"),modelValue:e(t).quantity,"onUpdate:modelValue":l[2]||(l[2]=o=>e(t).quantity=o),min:0},null,8,["label","modelValue"])]),_:1}),a(u,{cols:"3"},{default:s(()=>[a($,{label:e(i)("fields.Serialization type"),modelValue:e(t).serialization_type_id,"onUpdate:modelValue":l[3]||(l[3]=o=>e(t).serialization_type_id=o),items:e(m).props.serializationTypes,required:""},null,8,["label","modelValue","items"])]),_:1})]),_:1})]),_:1}),r.value.is_sent_to_confirmation?(g(),V(k,{key:0},{default:s(()=>[a(S,null,{default:s(()=>[F(q(e(i)("departments.CMD")),1)]),_:1}),a(w,null,{default:s(()=>[a(u,{cols:"4"},{default:s(()=>[a(P,{label:e(i)("fields.Price"),modelValue:e(t).price,"onUpdate:modelValue":l[4]||(l[4]=o=>e(t).price=o),"error-messages":e(C).price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1})):U("",!0),a(k,null,{default:s(()=>[a(S,null,{default:s(()=>[F(q(e(i)("Comments")),1)]),_:1}),a(w,null,{default:s(()=>[a(u,null,{default:s(()=>[a(z,{modelValue:e(t).comment,"onUpdate:modelValue":l[5]||(l[5]=o=>e(t).comment=o),label:e(i)("comments.New"),"error-messages":e(C).comment,folder:"comments"},null,8,["modelValue","label","error-messages"])]),_:1}),r.value.last_comment?(g(),V(u,{key:0},{default:s(()=>[a(z,{modelValue:r.value.last_comment.body,"onUpdate:modelValue":l[6]||(l[6]=o=>r.value.last_comment.body=o),label:e(i)("comments.Last"),disabled:""},null,8,["modelValue","label"])]),_:1})):U("",!0)]),_:1})]),_:1}),a(ee,null,{default:s(()=>[a(ae,{onClick:e(D),loading:n.value},null,8,["onClick","loading"]),a(le,{onClick:l[7]||(l[7]=o=>{v.value=!1,e(O)()}),loading:n.value,disabled:!e(M).valid},null,8,["loading","disabled"]),a(oe,{onClick:l[8]||(l[8]=o=>{v.value=!0,e(O)()}),loading:n.value,disabled:!e(M).valid},null,8,["loading","disabled"])]),_:1})]),_:1}))}};export{Ce as default};
