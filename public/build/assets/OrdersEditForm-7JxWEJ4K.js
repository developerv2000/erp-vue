import{u as O,d as T,l as b,h as w,p as H,m as E,n as x,q as M,s as Q,j as z,c as f,o as i,w as t,a as l,g as k,t as F,b as e,k as V,f as G,F as J,r as K}from"./app-Clvn7mZt.js";import{u as W,F as X}from"./vee-validate-CtywQttp.js";import{u as Y}from"./useVeeFormFields-D7gXNeDw.js";import{u as Z}from"./useFormData-DEk4Ge6e.js";import{u as ee}from"./messages-NMh0QN-V.js";import{D as $}from"./DefaultSheet-CDkrXgyL.js";import{_ as q}from"./DefaultTitle-McgGyca7.js";import{_ as c}from"./DefaultTextField-RKxCG5Y-.js";import{_ as le}from"./DefaultAutocomplete-Czwix3Fg.js";import{_ as N}from"./DefaultWysiwyg-BU4XL9Yo.js";import{F as ae}from"./FormActionsContainer-B6L5wfCr.js";import{_ as te}from"./FormResetButton-CO2Q9277.js";import{a as se,_ as oe}from"./FormUpdateWithourRedirect-zhImdEEy.js";import{_ as re}from"./DefaultNumberInput-CnqZJhao.js";import{_ as ue}from"./DefaultFileInput-D1r9L_lo.js";import{V as C,a as d}from"./VRow-D9HLbqfl.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./WrappedLabelGroup-aYf4w-ZQ.js";import"./StandardLabeledGroup-LekNWnmf.js";import"./filter-DSSeUQYK.js";import"./DefaultButton-BFphiFCx.js";import"./mdi-BiCQTzTv.js";import"./VNumberInput-Dvx616f0.js";const Ee={__name:"OrdersEditForm",setup(de){const{t:o}=O(),{objectToFormData:P}=Z(),g=T(),v=ee(),u=b(()=>g.props.record),p=w(!1),y=w(!1),B=b(()=>{const r={name:x().required(),currency_id:M().required(),pdf_file:Q().nullable(),products:H().of(E({price:M().required(),production_status:x().nullable()}))};return u.value?.is_sent_to_manufacturer&&(r.expected_dispatch_date=x().nullable()),E(r)}),I=b(()=>({name:u.value.name,currency_id:u.value.currency_id??g.props.defaultSelectedCurrencyID,pdf_file:null,products:u.value.products.map(r=>({id:r.id,full_english_product_label:r.process.full_english_product_label,mah_name:r.process.mah.name,last_comment:r.last_comment?.plain_text,quantity:r.quantity,price:Number(r.price??r.process.agreed_price),production_status:r.production_is_started?r.production_status:null})),expected_dispatch_date:u.value.is_sent_to_manufacturer?u.value.expected_dispatch_date:null})),R={comment:null},U=b(()=>({...I.value,...R})),{handleSubmit:j,errors:_,setErrors:A,resetForm:h,meta:S}=W({validationSchema:B,initialValues:U.value}),{values:n}=Y(Object.keys(U.value)),D=j(r=>{const s=P(r);p.value=!0,axios.post(route("cmd.orders.update",{record:u.value.id}),s).then(()=>{v.addUpdatedSuccessfullyMessage(),y.value?window.history.back():L()}).catch(a=>{a.response?.status===422?(A(a.response.data.errors),v.addFixErrorsMessage()):v.addSubmitionFailedMessage()}).finally(()=>{p.value=!1})}),L=()=>{z.reload({only:["record"],onSuccess:()=>{h({values:U.value})}})};return(r,s)=>(i(),f(e(X),{class:"d-flex flex-column ga-6 pb-8",enctype:"multipart/form-data"},{default:t(()=>[l($,null,{default:t(()=>[l(q,null,{default:t(()=>[k(F(e(o)("Order")),1)]),_:1}),l(C,null,{default:t(()=>[l(d,null,{default:t(()=>[l(c,{label:e(o)("fields.Name"),modelValue:e(n).name,"onUpdate:modelValue":s[0]||(s[0]=a=>e(n).name=a),"error-messages":e(_).name,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),l(d,null,{default:t(()=>[l(le,{label:e(o)("fields.Currency"),items:e(g).props.currencies,modelValue:e(n).currency_id,"onUpdate:modelValue":s[1]||(s[1]=a=>e(n).currency_id=a),"error-messages":e(_).currency_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),l(d,null,{default:t(()=>[l(ue,{label:e(o)("fields.Pdf"),modelValue:e(n).pdf_file,"onUpdate:modelValue":s[2]||(s[2]=a=>e(n).pdf_file=a),"error-messages":e(_).pdf_file,accept:".pdf",required:""},null,8,["label","modelValue","error-messages"])]),_:1}),u.value.production_is_started?(i(),f(d,{key:0},{default:t(()=>[l(c,{label:e(o)("dates.Expected dispatch"),modelValue:e(n).expected_dispatch_date,"onUpdate:modelValue":s[3]||(s[3]=a=>e(n).expected_dispatch_date=a),"error-messages":e(_).expected_dispatch_date,required:""},null,8,["label","modelValue","error-messages"])]),_:1})):V("",!0)]),_:1})]),_:1}),l($,null,{default:t(()=>[l(q,null,{default:t(()=>[k(F(e(o)("Products")),1)]),_:1}),(i(!0),G(J,null,K(e(n).products,a=>(i(),f(C,{key:a.id},{default:t(()=>[l(d,null,{default:t(()=>[l(c,{label:e(o)("fields.TM Eng"),modelValue:a.full_english_product_label,"onUpdate:modelValue":m=>a.full_english_product_label=m,disabled:""},null,8,["label","modelValue","onUpdate:modelValue"])]),_:2},1024),l(d,null,{default:t(()=>[l(c,{label:e(o)("fields.MAH"),modelValue:a.mah_name,"onUpdate:modelValue":m=>a.mah_name=m,disabled:""},null,8,["label","modelValue","onUpdate:modelValue"])]),_:2},1024),l(d,null,{default:t(()=>[l(c,{label:e(o)("comments.Last"),modelValue:a.last_comment,"onUpdate:modelValue":m=>a.last_comment=m,disabled:""},null,8,["label","modelValue","onUpdate:modelValue"])]),_:2},1024),u.value.production_is_started?V("",!0):(i(),f(d,{key:0},{default:t(()=>[l(c,{label:e(o)("fields.Quantity"),modelValue:a.quantity,"onUpdate:modelValue":m=>a.quantity=m,disabled:""},null,8,["label","modelValue","onUpdate:modelValue"])]),_:2},1024)),l(d,null,{default:t(()=>[l(re,{label:e(o)("fields.Price"),modelValue:a.price,"onUpdate:modelValue":m=>a.price=m,"error-messages":e(_).price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","onUpdate:modelValue","error-messages"])]),_:2},1024),u.value.production_is_started?(i(),f(d,{key:1},{default:t(()=>[l(c,{label:e(o)("fields.Production status"),modelValue:a.production_status,"onUpdate:modelValue":m=>a.production_status=m},null,8,["label","modelValue","onUpdate:modelValue"])]),_:2},1024)):V("",!0)]),_:2},1024))),128))]),_:1}),l($,null,{default:t(()=>[l(q,null,{default:t(()=>[k(F(e(o)("Comments")),1)]),_:1}),l(C,null,{default:t(()=>[l(d,null,{default:t(()=>[l(N,{modelValue:e(n).comment,"onUpdate:modelValue":s[4]||(s[4]=a=>e(n).comment=a),label:e(o)("comments.New"),"error-messages":e(_).comment,folder:"comments"},null,8,["modelValue","label","error-messages"])]),_:1}),u.value.last_comment?(i(),f(d,{key:0},{default:t(()=>[l(N,{modelValue:u.value.last_comment.body,"onUpdate:modelValue":s[5]||(s[5]=a=>u.value.last_comment.body=a),label:e(o)("comments.Last"),disabled:""},null,8,["modelValue","label"])]),_:1})):V("",!0)]),_:1})]),_:1}),l(ae,null,{default:t(()=>[l(te,{onClick:e(h),loading:p.value},null,8,["onClick","loading"]),l(se,{onClick:s[6]||(s[6]=a=>{y.value=!1,e(D)()}),loading:p.value,disabled:!e(S).valid},null,8,["loading","disabled"]),l(oe,{onClick:s[7]||(s[7]=a=>{y.value=!0,e(D)()}),loading:p.value,disabled:!e(S).valid},null,8,["loading","disabled"])]),_:1})]),_:1}))}};export{Ee as default};
