import{u as O,d as T,l as b,h as w,p as H,m as E,n as x,q as M,j as Q,c as _,o as i,w as t,a as l,g as k,t as F,b as e,k as V,f as z,F as G,r as J}from"./app-B129XDPu.js";import{u as K,F as W}from"./vee-validate-CT_T1e_1.js";import{u as X}from"./useVeeFormFields-C7o3I6cE.js";import{u as Y}from"./useFormData-DEk4Ge6e.js";import{u as Z}from"./messages-DtWWhcER.js";import{D as $}from"./DefaultSheet-COzA4QDz.js";import{_ as q}from"./DefaultTitle-BPZyLOkx.js";import{_ as c}from"./DefaultTextField-CV9Mh93M.js";import{_ as ee}from"./DefaultAutocomplete-Dcd2lVOE.js";import{_ as N}from"./DefaultWysiwyg-kqqXvPKv.js";import{F as le}from"./FormActionsContainer-BDpsr5uj.js";import{_ as ae}from"./FormResetButton-B3uCjbKj.js";import{a as te,_ as se}from"./FormUpdateWithourRedirect-DeHLfOue.js";import{_ as oe}from"./DefaultNumberInput-DgKsvjuT.js";import{V as h,a as n}from"./VRow-B7t-PEF8.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./WrappedLabelGroup-C3GCCjx7.js";import"./StandardLabeledGroup-f4crissH.js";import"./filter-CIvQV_OK.js";import"./DefaultButton-CvVzxMjx.js";import"./mdi-BiCQTzTv.js";import"./VNumberInput-CHjdEx4I.js";const Se={__name:"OrdersEditForm",setup(re){const{t:r}=O(),{objectToFormData:B}=Y(),g=T(),v=Z(),u=b(()=>g.props.record),p=w(!1),y=w(!1),I=b(()=>{const o={name:x().required(),currency_id:M().required(),products:H().of(E({price:M().required(),production_status:x().nullable()}))};return u.value?.is_sent_to_manufacturer&&(o.expected_dispatch_date=x().nullable()),E(o)}),P=b(()=>({name:u.value.name,currency_id:u.value.currency_id??g.props.defaultSelectedCurrencyID,products:u.value.products.map(o=>({id:o.id,full_english_product_label:o.process.full_english_product_label,mah_name:o.process.mah.name,last_comment:o.last_comment?.plain_text,quantity:o.quantity,price:Number(o.price??o.process.agreed_price),production_status:o.production_is_started?o.production_status:null})),expected_dispatch_date:u.value.is_sent_to_manufacturer?u.value.expected_dispatch_date:null})),R={comment:null},U=b(()=>({...P.value,...R})),{handleSubmit:j,errors:f,setErrors:A,resetForm:C,meta:S}=K({validationSchema:I,initialValues:U.value}),{values:m}=X(Object.keys(U.value)),D=j(o=>{const s=B(o);p.value=!0,axios.post(route("cmd.orders.update",{record:u.value.id}),s).then(()=>{v.addUpdatedSuccessfullyMessage(),y.value?window.history.back():L()}).catch(a=>{a.response?.status===422?(A(a.response.data.errors),v.addFixErrorsMessage()):v.addSubmitionFailedMessage()}).finally(()=>{p.value=!1})}),L=()=>{Q.reload({only:["record"],onSuccess:()=>{C({values:U.value})}})};return(o,s)=>(i(),_(e(W),{class:"d-flex flex-column ga-6 pb-8",enctype:"multipart/form-data"},{default:t(()=>[l($,null,{default:t(()=>[l(q,null,{default:t(()=>[k(F(e(r)("Order")),1)]),_:1}),l(h,null,{default:t(()=>[l(n,null,{default:t(()=>[l(c,{label:e(r)("fields.Name"),modelValue:e(m).name,"onUpdate:modelValue":s[0]||(s[0]=a=>e(m).name=a),"error-messages":e(f).name,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),l(n,null,{default:t(()=>[l(ee,{label:e(r)("fields.Currency"),items:e(g).props.currencies,modelValue:e(m).currency_id,"onUpdate:modelValue":s[1]||(s[1]=a=>e(m).currency_id=a),"error-messages":e(f).currency_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),u.value.production_is_started?(i(),_(n,{key:0},{default:t(()=>[l(c,{label:e(r)("dates.Expected dispatch"),modelValue:e(m).expected_dispatch_date,"onUpdate:modelValue":s[2]||(s[2]=a=>e(m).expected_dispatch_date=a),"error-messages":e(f).expected_dispatch_date,required:""},null,8,["label","modelValue","error-messages"])]),_:1})):V("",!0)]),_:1})]),_:1}),l($,null,{default:t(()=>[l(q,null,{default:t(()=>[k(F(e(r)("Products")),1)]),_:1}),(i(!0),z(G,null,J(e(m).products,a=>(i(),_(h,{key:a.id},{default:t(()=>[l(n,null,{default:t(()=>[l(c,{label:e(r)("fields.TM Eng"),modelValue:a.full_english_product_label,"onUpdate:modelValue":d=>a.full_english_product_label=d,disabled:""},null,8,["label","modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,null,{default:t(()=>[l(c,{label:e(r)("fields.MAH"),modelValue:a.mah_name,"onUpdate:modelValue":d=>a.mah_name=d,disabled:""},null,8,["label","modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,null,{default:t(()=>[l(c,{label:e(r)("comments.Last"),modelValue:a.last_comment,"onUpdate:modelValue":d=>a.last_comment=d,disabled:""},null,8,["label","modelValue","onUpdate:modelValue"])]),_:2},1024),u.value.production_is_started?V("",!0):(i(),_(n,{key:0},{default:t(()=>[l(c,{label:e(r)("fields.Quantity"),modelValue:a.quantity,"onUpdate:modelValue":d=>a.quantity=d,disabled:""},null,8,["label","modelValue","onUpdate:modelValue"])]),_:2},1024)),l(n,null,{default:t(()=>[l(oe,{label:e(r)("fields.Price"),modelValue:a.price,"onUpdate:modelValue":d=>a.price=d,"error-messages":e(f).price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","onUpdate:modelValue","error-messages"])]),_:2},1024),u.value.production_is_started?(i(),_(n,{key:1},{default:t(()=>[l(c,{label:e(r)("fields.Production status"),modelValue:a.production_status,"onUpdate:modelValue":d=>a.production_status=d},null,8,["label","modelValue","onUpdate:modelValue"])]),_:2},1024)):V("",!0)]),_:2},1024))),128))]),_:1}),l($,null,{default:t(()=>[l(q,null,{default:t(()=>[k(F(e(r)("Comments")),1)]),_:1}),l(h,null,{default:t(()=>[l(n,null,{default:t(()=>[l(N,{modelValue:e(m).comment,"onUpdate:modelValue":s[3]||(s[3]=a=>e(m).comment=a),label:e(r)("comments.New"),"error-messages":e(f).comment,folder:"comments"},null,8,["modelValue","label","error-messages"])]),_:1}),u.value.last_comment?(i(),_(n,{key:0},{default:t(()=>[l(N,{modelValue:u.value.last_comment.body,"onUpdate:modelValue":s[4]||(s[4]=a=>u.value.last_comment.body=a),label:e(r)("comments.Last"),disabled:""},null,8,["modelValue","label"])]),_:1})):V("",!0)]),_:1})]),_:1}),l(le,null,{default:t(()=>[l(ae,{onClick:e(C),loading:p.value},null,8,["onClick","loading"]),l(te,{onClick:s[5]||(s[5]=a=>{y.value=!1,e(D)()}),loading:p.value,disabled:!e(S).valid},null,8,["loading","disabled"]),l(se,{onClick:s[6]||(s[6]=a=>{y.value=!0,e(D)()}),loading:p.value,disabled:!e(S).valid},null,8,["loading","disabled"])]),_:1})]),_:1}))}};export{Se as default};
