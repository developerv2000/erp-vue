import{u as k,c as y,o as m,w as t,g as s,t as n,b as a,v as $,l as v,f as g,a as u,k as S,e as N,F as h,r as P,d as C,i as V}from"./app-B9LPjWSD.js";import{u as A}from"./useQueryParams-BE0-NS-t.js";import{u as T}from"./orders-Btrq4d5Q.js";import{u as D}from"./useDateFormatter-BCAMysvV.js";import{_ as w,D as B,V as z}from"./TableNavigateToPage-B3G9pwKB.js";import R from"./OrdersTableTop-Cd1m29rF.js";import{T as E}from"./TableDefaultSkeleton-DEtY7Jax.js";import{_ as U}from"./TdEditButton-DNnxYMjv.js";import{_ as j}from"./TdAva-DLrJD8H1.js";import{T as M}from"./TdInertiaLink-D-qXVllw.js";import{_ as L}from"./TogglableThreeLinesLimitedText-Bba3LHMs.js";import{_ as q}from"./TdRecordCommentsLink-XMbj38df.js";import{_ as G}from"./TdOrderStatus-Byzg8uf1.js";import{u as x}from"./messages-Bx-X0MsL.js";import{u as I}from"./global-B1_AbHmT.js";import{_ as O}from"./DefaultButton-BY5T7BWX.js";import{g as F,M as H}from"./mdi-BiCQTzTv.js";import{_ as Q}from"./TdArrowedInertiaLink-B9ZCCrQG.js";import"./queryHelper-LZTJtzGq.js";import"./createRecordActions-Ba682ZE6.js";import"./VTable-BwJ3bl9X.js";import"./DefaultTableToolbar-Dx-14Mtl.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ColumnsListItem-Bc8G2spJ.js";import"./VRow-YwEE9k1_.js";import"./VSwitch-BeDFw3gd.js";import"./VNumberInput-BGCQJ9Qa.js";import"./FullscreenListItem-CQ0aQifs.js";import"./filter-CLF1nGTb.js";import"./InertiaLinkedButtonedIcon-BQ84oza8.js";import"./InertiaLink-BdP1QpLD.js";import"./useAuth-BdfaLBok.js";const J={__name:"TdOrderSentToConfirmation",props:{orderId:Number},setup(c){const p=c,{t:l}=k(),_=T(),o=I(),r=x(),f=d=>{o.loading=!0,$.post(route("cmd.orders.sent-to-confirmation",{record:d})).then(i=>{r.addSuccessMessage(),_.updateRecord(i.data)}).catch(()=>{r.addSubmitionFailedMessage()}).finally(()=>{o.loading=!1})};return(d,i)=>(m(),y(O,{size:"small","append-icon":a(F),color:"deep-orange",onClick:i[0]||(i[0]=b=>f(p.orderId))},{default:t(()=>[s(n(a(l)("actions.Send")),1)]),_:1},8,["append-icon"]))}},K={__name:"TdOrderSentToManufacturer",props:{orderId:Number},setup(c){const p=c,{t:l}=k(),_=T(),o=I(),r=x(),f=d=>{o.loading=!0,$.post(route("cmd.orders.sent-to-manufacturer",{record:d})).then(i=>{r.addSuccessMessage(),_.updateRecord(i.data)}).catch(()=>{r.addSubmitionFailedMessage()}).finally(()=>{o.loading=!1})};return(d,i)=>(m(),y(O,{size:"small","append-icon":a(F),color:"blue",onClick:i[0]||(i[0]=b=>f(p.orderId))},{default:t(()=>[s(n(a(l)("actions.Send")),1)]),_:1},8,["append-icon"]))}},W={__name:"TdOrderStartProduction",props:{orderId:Number},setup(c){const p=c,{t:l}=k(),_=T(),o=I(),r=x(),f=d=>{o.loading=!0,$.post(route("cmd.orders.start-production",{record:d})).then(i=>{r.addSuccessMessage(),_.updateRecord(i.data)}).catch(()=>{r.addSubmitionFailedMessage()}).finally(()=>{o.loading=!1})};return(d,i)=>(m(),y(O,{size:"small","append-icon":a(H),color:"indigo",onClick:i[0]||(i[0]=b=>f(p.orderId))},{default:t(()=>[s(n(a(l)("actions.Start")),1)]),_:1},8,["append-icon"]))}},X={class:"text-lowercase"},Y={key:0,class:"d-flex flex-column ga-1"},Z={__name:"TdCMDOrderInvoices",props:{item:{type:Object,required:!0},paymentTypesByName:{type:Object,required:!0}},setup(c){const p=c,{t:l}=k(),_=v(()=>[{enabled:p.item.can_attach_production_prepayment_invoice,paymentTypeName:"Prepayment",label:l("actions.Add prepayment")},{enabled:p.item.can_attach_production_final_payment_invoice,paymentTypeName:"Final payment",label:l("actions.Add final payment")},{enabled:p.item.can_attach_production_full_payment_invoice,paymentTypeName:"Full payment",label:l("actions.Add full payment")}]),o=v(()=>_.value.filter(r=>r.enabled&&p.paymentTypesByName[r.paymentTypeName]));return(r,f)=>(m(),g(h,null,[u(Q,{link:r.route("cmd.invoices.index",{invoiceable_id:c.item.id,initialize_from_inertia_page:!0})},{default:t(()=>[N("span",X,n(c.item.production_invoices_count)+" "+n(a(l)("Invoices")),1)]),_:1},8,["link"]),c.item.can_attach_any_production_invoice?(m(),g("div",Y,[(m(!0),g(h,null,P(o.value,d=>(m(),y(M,{key:d.paymentTypeName,link:r.route("cmd.invoices.create",{order_id:c.item.id,payment_type_id:c.paymentTypesByName[d.paymentTypeName].id})},{default:t(()=>[s(n(d.label),1)]),_:2},1032,["link"]))),128))])):S("",!0)],64))}},ee={class:"text-lowercase"},te=["href"],Ae={__name:"OrdersTable",setup(c){const{t:p}=k(),{get:l}=A(),_=C(),o=T(),{formatDate:r}=D();V(()=>{(!o.initializedFromInertiaPage||l("initialize_from_inertia_page"))&&o.initFromInertiaPage(_),o.fetchRecords({updateUrl:!0})});const f=i=>{o.fetchRecordsIfOptionsChanged(i)},d=v(()=>Object.fromEntries((_.props.invoicePaymentTypes??[]).map(i=>[i.name,i])));return(i,b)=>(m(),y(z,{class:"main-table main-table--limited-height main-table--with-filter",headers:a(_).props.tableVisibleHeaders,modelValue:a(o).selected,"onUpdate:modelValue":b[0]||(b[0]=e=>a(o).selected=e),items:a(o).records,"items-length":a(o).pagination.total_records,page:a(o).pagination.page,"items-per-page":a(o).pagination.per_page,"items-per-page-options":a(B),"sort-by":[{key:a(o).pagination.order_by,order:a(o).pagination.order_direction}],"onUpdate:options":f,loading:a(o).loading,"must-sort":"","show-select":"","show-current-page":"","fixed-header":"",hover:""},{top:t(()=>[u(R)]),loading:t(()=>[u(E)]),"footer.prepend":t(()=>[u(w,{store:a(o)},null,8,["store"])]),"item.edit":t(({item:e})=>[u(U,{link:i.route("cmd.orders.edit",e.id)},null,8,["link"])]),"item.manufacturer_bdm":t(({item:e})=>[u(j,{user:e.manufacturer.bdm},null,8,["user"])]),"item.receive_date":t(({item:e})=>[s(n(a(r)(e.receive_date)),1)]),"item.manufacturer_id":t(({item:e})=>[s(n(e.manufacturer.name),1)]),"item.country_id":t(({item:e})=>[s(n(e.country.code),1)]),"item.products_count":t(({item:e})=>[u(M,{link:i.route("cmd.order-products.index",{"order_id[]":e.id,initialize_from_inertia_page:!0})},{default:t(()=>[N("span",ee,n(e.products_count)+" "+n(a(p)("Products")),1)]),_:2},1032,["link"])]),"item.comments_count":t(({item:e})=>[u(q,{record:e},null,8,["record"])]),"item.last_comment_body":t(({item:e})=>[u(L,{class:"main-table__last-comment",text:e.last_comment?.body},null,8,["text"])]),"item.status":t(({item:e})=>[u(G,{status:e.status},null,8,["status"])]),"item.sent_to_bdm_date":t(({item:e})=>[s(n(a(r)(e.sent_to_bdm_date)),1)]),"item.name":t(({item:e})=>[s(n(e.name),1)]),"item.purchase_date":t(({item:e})=>[s(n(a(r)(e.purchase_date)),1)]),"item.currency_id":t(({item:e})=>[s(n(e.currency?.name),1)]),"item.pdf_file":t(({item:e})=>[N("a",{class:"text-primary",href:e.pdf_file_url,target:"_blank"},n(e.pdf_file),9,te)]),"item.sent_to_confirmation_date":t(({item:e})=>[e.is_sent_to_confirmation?(m(),g(h,{key:0},[s(n(a(r)(e.sent_to_confirmation_date)),1)],64)):e.can_be_sent_for_confirmation?(m(),y(J,{key:1,"order-id":e.id},null,8,["order-id"])):S("",!0)]),"item.confirmation_date":t(({item:e})=>[s(n(a(r)(e.confirmation_date)),1)]),"item.sent_to_manufacturer_date":t(({item:e})=>[e.is_sent_to_manufacturer?(m(),g(h,{key:0},[s(n(a(r)(e.sent_to_manufacturer_date)),1)],64)):e.is_confirmed?(m(),y(K,{key:1,"order-id":e.id},null,8,["order-id"])):S("",!0)]),"item.expected_dispatch_date":t(({item:e})=>[s(n(e.expected_dispatch_date),1)]),"item.production_invoices_count":t(({item:e})=>[u(Z,{item:e,"payment-types-by-name":d.value},null,8,["item","payment-types-by-name"])]),"item.production_start_date":t(({item:e})=>[e.production_is_started?(m(),g(h,{key:0},[s(n(a(r)(e.production_start_date)),1)],64)):e.is_sent_to_manufacturer?(m(),y(W,{key:1,"order-id":e.id},null,8,["order-id"])):S("",!0)]),"item.created_at":t(({item:e})=>[s(n(a(r)(e.created_at)),1)]),"item.updated_at":t(({item:e})=>[s(n(a(r)(e.updated_at)),1)]),_:1},8,["headers","modelValue","items","items-length","page","items-per-page","items-per-page-options","sort-by","loading"]))}};export{Ae as default};
