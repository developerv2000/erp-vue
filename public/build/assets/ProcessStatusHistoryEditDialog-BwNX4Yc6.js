import{n as q,aB as b,u as E,d as U,h as T,l as j,q as v,m as B,J as N,v as P,j as I,c as p,o as f,w as l,a as o,b as e,z as w,bE as z,b$ as A,g as _,t as g,b8 as D,bF as G,e as J,k as y,bG as O,c0 as X}from"./app-CMSjNDK4.js";import{u as K}from"./processStatusHistoryTable-CJomygJz.js";import{u as L}from"./messages-eCh_LZOb.js";import{u as Q}from"./useFormData-DEk4Ge6e.js";import{u as W}from"./useVeeFormFields-CKtARDYP.js";import{d as Z,u as ee}from"./useDateFormatter-DsH7D03H.js";import{u as ae,F as se}from"./vee-validate-D0NdbX5f.js";import{_ as x}from"./DefaultButton-CFfFCqKo.js";import{_ as Y}from"./DefaultTextField-JI6kPgYm.js";import{_ as te}from"./DefaultAutocomplete-D9uSFHTZ.js";import{X as re}from"./mdi-BZMfrfO1.js";import"./WrappedLabelGroup-YDYEYAYF.js";import"./StandardLabeledGroup-DYDuYIbt.js";import"./filter-gwBCF0wV.js";function F({required:u=!0}={}){return q().test("is-valid-timestamp",b.global.t("validations.timestamp"),d=>!d&&!u?!0:!d&&u?!1:Z(d,"YYYY-MM-DD HH:mm:ss",!0).isValid()).required(u?b.global.t("validations.required"):void 0)}const oe={class:"d-flex flex-column ga-5"},De={__name:"ProcessStatusHistoryEditDialog",setup(u){const{t:d}=E(),C=U(),s=K(),{objectToFormData:S}=Q(),m=L(),{formatDate:V}=ee(),n=T(!1),M=j(()=>{const t={id:v().required(),start_date:F()};return s.activeRecord&&!s.activeRecord.is_active_history&&(t.status_id=v().required(),t.end_date=F()),B(t)}),{errors:c,handleSubmit:k,setErrors:H,meta:R}=ae({validationSchema:M,initialValues:{...s.activeRecord}}),$={id:null,status_id:null,start_date:null,end_date:null},{values:i}=W(Object.keys($));N(()=>s.activeRecord,t=>{i.id=t.id,i.status_id=t.status_id,i.start_date=V(t.start_date,"YYYY-MM-DD HH:mm:ss"),i.end_date=V(t.end_date,"YYYY-MM-DD HH:mm:ss")});const h=k(t=>{n.value=!0;const a=S(t);P.post(route("mad.processes.status-history.update",s.activeRecord.id),a).then(()=>{m.addUpdatedSuccessfullyMessage(),s.editDialog=!1,I.reload({only:["historyRecords"]})}).catch(r=>{r.response?.status===422?(H(r.response.data.errors),m.addFixErrorsMessage()):m.addSubmitionFailedMessage()}).finally(()=>{n.value=!1})});return(t,a)=>(f(),p(X,{modelValue:e(s).editDialog,"onUpdate:modelValue":a[4]||(a[4]=r=>e(s).editDialog=r),"max-width":"540"},{default:l(()=>[o(e(se),{enctype:"multipart/form-data"},{default:l(()=>[o(w,null,{default:l(()=>[o(z,{class:"pa-4","prepend-icon":e(re)},{default:l(()=>[o(A,null,{default:l(()=>[_(g(e(d)("modals.Edit record")),1)]),_:1})]),_:1},8,["prepend-icon"]),o(D),o(G,{class:"px-4 py-6"},{default:l(()=>[J("div",oe,[e(s).activeRecord.is_active_history?y("",!0):(f(),p(te,{key:0,label:e(d)("fields.Status"),items:e(C).props.statuses,modelValue:e(i).status_id,"onUpdate:modelValue":a[0]||(a[0]=r=>e(i).status_id=r),"error-messages":e(c).status_id,required:""},null,8,["label","items","modelValue","error-messages"])),o(Y,{label:e(d)("dates.Start date"),modelValue:e(i).start_date,"onUpdate:modelValue":a[1]||(a[1]=r=>e(i).start_date=r),"error-messages":e(c).start_date,required:""},null,8,["label","modelValue","error-messages"]),e(s).activeRecord.is_active_history?y("",!0):(f(),p(Y,{key:1,label:e(d)("dates.End date"),modelValue:e(i).end_date,"onUpdate:modelValue":a[2]||(a[2]=r=>e(i).end_date=r),"error-messages":e(c).end_date,required:""},null,8,["label","modelValue","error-messages"]))])]),_:1}),o(D),o(O,{class:"pa-4"},{default:l(()=>[o(x,{class:"px-6",color:"grey-lighten-2",onClick:a[3]||(a[3]=r=>e(s).editDialog=!1)},{default:l(()=>[_(g(e(d)("actions.Cancel")),1)]),_:1}),o(x,{class:"px-6",color:"success",loading:n.value,disabled:!e(R).valid,onClick:e(h)},{default:l(()=>[_(g(e(d)("actions.Update")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};export{De as default};
