import{n as q,aI as b,u as P,d as U,h as E,l as N,q as v,m as T,P as j,v as B,j as I,c as p,o as f,w as l,a as o,b as e,y as O,bM as w,c2 as A,g as _,t as g,bg as y,bN as z,e as G,k as D,bO as J,c3 as K}from"./app-CAQEU6tV.js";import{u as L}from"./processStatusHistoryTable-B7axgA_A.js";import{u as Q}from"./messages-BUQngoIa.js";import{u as W}from"./useFormData-CgBSWld4.js";import{u as X}from"./useVeeFormFields-IBBPrH_b.js";import{d as Z,u as ee}from"./useDateFormatter-JNdHtaLT.js";import{u as ae,F as se}from"./vee-validate-CLyeuvMU.js";import{_ as x}from"./DefaultButton-SeF06cCw.js";import{_ as Y}from"./DefaultTextField-_Mj_HAhB.js";import{_ as te}from"./DefaultAutocomplete-6kHdZumI.js";import{P as re}from"./mdi-DZCuF3m0.js";import"./WrappedLabelGroup-DTG0B0RT.js";import"./StandardLabeledGroup-BSSzWc1k.js";import"./filter-CnEtE6uU.js";function C({required:u=!0}={}){return q().test("is-valid-timestamp",b.global.t("validations.timestamp"),d=>!d&&!u?!0:!d&&u?!1:Z(d,"YYYY-MM-DD HH:mm:ss",!0).isValid()).required(u?b.global.t("validations.required"):void 0)}const oe={class:"d-flex flex-column ga-5"},ye={__name:"ProcessStatusHistoryEditDialog",setup(u){const{t:d}=P(),F=U(),s=L(),{objectToFormData:M}=W(),m=Q(),{formatDate:V}=ee(),n=E(!1),S=N(()=>{const t={id:v().required(),start_date:C()};return s.activeRecord&&!s.activeRecord.is_active_history&&(t.status_id=v().required(),t.end_date=C()),T(t)}),{errors:c,handleSubmit:k,setErrors:H,meta:R}=ae({validationSchema:S,initialValues:{...s.activeRecord}}),h={id:null,status_id:null,start_date:null,end_date:null},{values:i}=X(Object.keys(h));j(()=>s.activeRecord,t=>{i.id=t.id,i.status_id=t.status_id,i.start_date=V(t.start_date,"YYYY-MM-DD HH:mm:ss"),i.end_date=V(t.end_date,"YYYY-MM-DD HH:mm:ss")});const $=k(t=>{n.value=!0;const a=M(t);B.post(route("mad.processes.status-history.update",s.activeRecord.id),a).then(()=>{m.addUpdatedSuccessfullyMessage(),s.editDialog=!1,I.reload({only:["historyRecords"]})}).catch(r=>{r.response?.status===422?(H(r.response.data.errors),m.addFixErrorsMessage()):m.addSubmitionFailedMessage()}).finally(()=>{n.value=!1})});return(t,a)=>(f(),p(K,{modelValue:e(s).editDialog,"onUpdate:modelValue":a[4]||(a[4]=r=>e(s).editDialog=r),"max-width":"540"},{default:l(()=>[o(e(se),{enctype:"multipart/form-data"},{default:l(()=>[o(O,null,{default:l(()=>[o(w,{class:"pa-4","prepend-icon":e(re)},{default:l(()=>[o(A,null,{default:l(()=>[_(g(e(d)("modals.Edit record")),1)]),_:1})]),_:1},8,["prepend-icon"]),o(y),o(z,{class:"px-4 py-6"},{default:l(()=>[G("div",oe,[e(s).activeRecord.is_active_history?D("",!0):(f(),p(te,{key:0,label:e(d)("fields.Status"),items:e(F).props.statuses,modelValue:e(i).status_id,"onUpdate:modelValue":a[0]||(a[0]=r=>e(i).status_id=r),"error-messages":e(c).status_id,required:""},null,8,["label","items","modelValue","error-messages"])),o(Y,{label:e(d)("dates.Start date"),modelValue:e(i).start_date,"onUpdate:modelValue":a[1]||(a[1]=r=>e(i).start_date=r),"error-messages":e(c).start_date,required:""},null,8,["label","modelValue","error-messages"]),e(s).activeRecord.is_active_history?D("",!0):(f(),p(Y,{key:1,label:e(d)("dates.End date"),modelValue:e(i).end_date,"onUpdate:modelValue":a[2]||(a[2]=r=>e(i).end_date=r),"error-messages":e(c).end_date,required:""},null,8,["label","modelValue","error-messages"]))])]),_:1}),o(y),o(J,{class:"pa-4"},{default:l(()=>[o(x,{class:"px-6",color:"grey-lighten-2",onClick:a[3]||(a[3]=r=>e(s).editDialog=!1)},{default:l(()=>[_(g(e(d)("actions.Cancel")),1)]),_:1}),o(x,{class:"px-6",color:"success",loading:n.value,disabled:!e(R).valid,onClick:e($)},{default:l(()=>[_(g(e(d)("actions.Update")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};export{ye as default};
