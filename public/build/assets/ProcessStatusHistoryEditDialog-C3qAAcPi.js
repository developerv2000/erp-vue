import{n as q,a4 as v,h as U,i as E,r as T,c as j,m as D,j as N,F as P,p as B,q as I,a as p,o as f,w as l,b as o,u as e,V as w,a5 as A,a6 as O,g as _,t as g,a7 as y,a8 as z,d as G,s as b,a9 as J,aa as K}from"./app-BN27vI2s.js";import{u as L}from"./processStatusHistoryTable-BeST96gV.js";import{u as Q}from"./messages-Db4UKgA7.js";import{u as W}from"./useFormData-CgBSWld4.js";import{u as X}from"./useVeeFormFields-C1ufDKTL.js";import{d as Z,u as ee}from"./useDateFormatter-Cn1U-vQt.js";import{u as ae,F as se}from"./vee-validate-BMCBLxOQ.js";import{_ as x}from"./DefaultButton-bK-sfj_8.js";import{_ as Y}from"./DefaultTextField-Nkap9VOR.js";import{_ as te}from"./DefaultAutocomplete-C4u3BvbQ.js";import{e as re}from"./mdi-B8JOKl2S.js";import"./WrappedLabelGroup-WAr2PA7b.js";import"./StandardLabeledGroup-DlI0SdXp.js";import"./filter-C_VrKd3f.js";function F({required:u=!0}={}){return q().test("is-valid-timestamp",v.global.t("validations.timestamp"),d=>!d&&!u?!0:!d&&u?!1:Z(d,"YYYY-MM-DD HH:mm:ss",!0).isValid()).required(u?v.global.t("validations.required"):void 0)}const oe={class:"d-flex flex-column ga-5"},ye={__name:"ProcessStatusHistoryEditDialog",setup(u){const{t:d}=U(),C=E(),s=L(),{objectToFormData:S}=W(),m=Q(),{formatDate:V}=ee(),n=T(!1),M=j(()=>{const t={id:D().required(),start_date:F()};return s.activeRecord&&!s.activeRecord.is_active_history&&(t.status_id=D().required(),t.end_date=F()),N(t)}),{errors:c,handleSubmit:k,setErrors:H,meta:R}=ae({validationSchema:M,initialValues:{...s.activeRecord}}),h={id:null,status_id:null,start_date:null,end_date:null},{values:i}=X(Object.keys(h));P(()=>s.activeRecord,t=>{i.id=t.id,i.status_id=t.status_id,i.start_date=V(t.start_date,"YYYY-MM-DD HH:mm:ss"),i.end_date=V(t.end_date,"YYYY-MM-DD HH:mm:ss")});const $=k(t=>{n.value=!0;const a=S(t);B.post(route("mad.processes.status-history.update",s.activeRecord.id),a).then(()=>{m.addUpdatedSuccessfullyMessage(),s.editDialog=!1,I.reload({only:["historyRecords"]})}).catch(r=>{r.response?.status===422?(H(r.response.data.errors),m.addFixErrorsMessage()):m.addSubmitionFailedMessage()}).finally(()=>{n.value=!1})});return(t,a)=>(f(),p(K,{modelValue:e(s).editDialog,"onUpdate:modelValue":a[4]||(a[4]=r=>e(s).editDialog=r),"max-width":"540"},{default:l(()=>[o(e(se),{enctype:"multipart/form-data"},{default:l(()=>[o(w,null,{default:l(()=>[o(A,{class:"pa-4","prepend-icon":e(re)},{default:l(()=>[o(O,null,{default:l(()=>[_(g(e(d)("modals.Edit record")),1)]),_:1})]),_:1},8,["prepend-icon"]),o(y),o(z,{class:"px-4 py-6"},{default:l(()=>[G("div",oe,[e(s).activeRecord.is_active_history?b("",!0):(f(),p(te,{key:0,label:e(d)("fields.Status"),items:e(C).props.statuses,modelValue:e(i).status_id,"onUpdate:modelValue":a[0]||(a[0]=r=>e(i).status_id=r),"error-messages":e(c).status_id,required:""},null,8,["label","items","modelValue","error-messages"])),o(Y,{label:e(d)("dates.Start date"),modelValue:e(i).start_date,"onUpdate:modelValue":a[1]||(a[1]=r=>e(i).start_date=r),"error-messages":e(c).start_date,required:""},null,8,["label","modelValue","error-messages"]),e(s).activeRecord.is_active_history?b("",!0):(f(),p(Y,{key:1,label:e(d)("dates.End date"),modelValue:e(i).end_date,"onUpdate:modelValue":a[2]||(a[2]=r=>e(i).end_date=r),"error-messages":e(c).end_date,required:""},null,8,["label","modelValue","error-messages"]))])]),_:1}),o(y),o(J,{class:"pa-4"},{default:l(()=>[o(x,{class:"px-6",color:"grey-lighten-2",onClick:a[3]||(a[3]=r=>e(s).editDialog=!1)},{default:l(()=>[_(g(e(d)("actions.Cancel")),1)]),_:1}),o(x,{class:"px-6",color:"success",loading:n.value,disabled:!e(R).valid,onClick:e($)},{default:l(()=>[_(g(e(d)("actions.Update")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};export{ye as default};
