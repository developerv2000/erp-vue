import{n as $,aQ as b,u as q,d as T,h as E,l as j,q as v,m as N,Y as P,v as B,j as I,c as p,o as f,w as l,a as o,b as e,y as w,bU as A,cd as O,g as _,t as g,bo as y,bV as Q,e as W,k as D,bW as z,ce as G}from"./app-BLgoNwh9.js";import{u as J}from"./processStatusHistoryTable-CBjXxKTj.js";import{u as K}from"./messages-Daw9qpnw.js";import{u as L}from"./useFormData-CgBSWld4.js";import{u as X}from"./useVeeFormFields-CjyoEa7T.js";import{d as Z,u as ee}from"./useDateFormatter-DW7w93RU.js";import{u as ae,F as se}from"./vee-validate-Drp1LwNg.js";import{_ as Y}from"./DefaultButton-As932Yet.js";import{_ as x}from"./DefaultTextField-DLLz5uQ3.js";import{_ as te}from"./DefaultAutocomplete-DaB-TeL_.js";import{T as re}from"./mdi-FFd_BlEo.js";import"./WrappedLabelGroup-mjx86u9J.js";import"./StandardLabeledGroup-CKUmWAz5.js";import"./filter-p85kxTXY.js";function C({required:u=!0}={}){return $().test("is-valid-timestamp",b.global.t("validations.timestamp"),d=>!d&&!u?!0:!d&&u?!1:Z(d,"YYYY-MM-DD HH:mm:ss",!0).isValid()).required(u?b.global.t("validations.required"):void 0)}const oe={class:"d-flex flex-column ga-5"},ye={__name:"ProcessStatusHistoryEditDialog",setup(u){const{t:d}=q(),F=T(),s=J(),{objectToFormData:S}=L(),m=K(),{formatDate:V}=ee(),n=E(!1),M=j(()=>{const t={id:v().required(),start_date:C()};return s.activeRecord&&!s.activeRecord.is_active_history&&(t.status_id=v().required(),t.end_date=C()),N(t)}),{errors:c,handleSubmit:k,setErrors:H,meta:R}=ae({validationSchema:M,initialValues:{...s.activeRecord}}),h={id:null,status_id:null,start_date:null,end_date:null},{values:i}=X(Object.keys(h));P(()=>s.activeRecord,t=>{i.id=t.id,i.status_id=t.status_id,i.start_date=V(t.start_date,"YYYY-MM-DD HH:mm:ss"),i.end_date=V(t.end_date,"YYYY-MM-DD HH:mm:ss")});const U=k(t=>{n.value=!0;const a=S(t);B.post(route("mad.processes.status-history.update",s.activeRecord.id),a).then(()=>{m.addUpdatedSuccessfullyMessage(),s.editDialog=!1,I.reload({only:["historyRecords"]})}).catch(r=>{r.response?.status===422?(H(r.response.data.errors),m.addFixErrorsMessage()):m.addSubmitionFailedMessage()}).finally(()=>{n.value=!1})});return(t,a)=>(f(),p(G,{modelValue:e(s).editDialog,"onUpdate:modelValue":a[4]||(a[4]=r=>e(s).editDialog=r),"max-width":"540"},{default:l(()=>[o(e(se),{enctype:"multipart/form-data"},{default:l(()=>[o(w,null,{default:l(()=>[o(A,{class:"pa-4","prepend-icon":e(re)},{default:l(()=>[o(O,null,{default:l(()=>[_(g(e(d)("modals.Edit record")),1)]),_:1})]),_:1},8,["prepend-icon"]),o(y),o(Q,{class:"px-4 py-6"},{default:l(()=>[W("div",oe,[e(s).activeRecord.is_active_history?D("",!0):(f(),p(te,{key:0,label:e(d)("fields.Status"),items:e(F).props.statuses,modelValue:e(i).status_id,"onUpdate:modelValue":a[0]||(a[0]=r=>e(i).status_id=r),"error-messages":e(c).status_id,required:""},null,8,["label","items","modelValue","error-messages"])),o(x,{label:e(d)("dates.Start date"),modelValue:e(i).start_date,"onUpdate:modelValue":a[1]||(a[1]=r=>e(i).start_date=r),"error-messages":e(c).start_date,required:""},null,8,["label","modelValue","error-messages"]),e(s).activeRecord.is_active_history?D("",!0):(f(),p(x,{key:1,label:e(d)("dates.End date"),modelValue:e(i).end_date,"onUpdate:modelValue":a[2]||(a[2]=r=>e(i).end_date=r),"error-messages":e(c).end_date,required:""},null,8,["label","modelValue","error-messages"]))])]),_:1}),o(y),o(z,{class:"pa-4"},{default:l(()=>[o(Y,{class:"px-6",color:"grey-lighten-2",onClick:a[3]||(a[3]=r=>e(s).editDialog=!1)},{default:l(()=>[_(g(e(d)("actions.Cancel")),1)]),_:1}),o(Y,{class:"px-6",color:"success",loading:n.value,disabled:!e(R).valid,onClick:e(U)},{default:l(()=>[_(g(e(d)("actions.Update")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};export{ye as default};
