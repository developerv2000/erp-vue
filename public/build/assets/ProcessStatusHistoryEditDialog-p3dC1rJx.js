import{x as q,aK as v,u as U,d as E,h as N,s as T,z as D,v as j,S as B,B as P,j as I,c as p,o as f,w as l,a as o,b as e,V as w,l as z,c7 as A,g as _,t as g,bq as b,n as K,e as O,k as y,p as G,c8 as J}from"./app-DFGAykv1.js";import{u as L}from"./processStatusHistoryTable-C8Y-f8F9.js";import{u as Q}from"./messages-DM6Hzgr9.js";import{u as W}from"./useFormData-CgBSWld4.js";import{u as X}from"./useVeeFormFields-BYBd5kGd.js";import{d as Z,u as ee}from"./useDateFormatter-1dviXKBu.js";import{u as ae,F as se}from"./vee-validate-bwBYQxrX.js";import{_ as x}from"./DefaultButton-BwBxuaXS.js";import{_ as Y}from"./DefaultTextField-C7s22ckC.js";import{_ as te}from"./DefaultAutocomplete-D2AwreME.js";import{N as re}from"./mdi-_GS73Yti.js";import"./WrappedLabelGroup-uY5caKSu.js";import"./StandardLabeledGroup-DZwc3k__.js";import"./filter-DJBblzN3.js";function S({required:u=!0}={}){return q().test("is-valid-timestamp",v.global.t("validations.timestamp"),d=>!d&&!u?!0:!d&&u?!1:Z(d,"YYYY-MM-DD HH:mm:ss",!0).isValid()).required(u?v.global.t("validations.required"):void 0)}const oe={class:"d-flex flex-column ga-5"},be={__name:"ProcessStatusHistoryEditDialog",setup(u){const{t:d}=U(),C=E(),s=L(),{objectToFormData:F}=W(),m=Q(),{formatDate:V}=ee(),n=N(!1),M=T(()=>{const t={id:D().required(),start_date:S()};return s.activeRecord&&!s.activeRecord.is_active_history&&(t.status_id=D().required(),t.end_date=S()),j(t)}),{errors:c,handleSubmit:k,setErrors:H,meta:R}=ae({validationSchema:M,initialValues:{...s.activeRecord}}),h={id:null,status_id:null,start_date:null,end_date:null},{values:i}=X(Object.keys(h));B(()=>s.activeRecord,t=>{i.id=t.id,i.status_id=t.status_id,i.start_date=V(t.start_date,"YYYY-MM-DD HH:mm:ss"),i.end_date=V(t.end_date,"YYYY-MM-DD HH:mm:ss")});const $=k(t=>{n.value=!0;const a=F(t);P.post(route("mad.processes.status-history.update",s.activeRecord.id),a).then(()=>{m.addUpdatedSuccessfullyMessage(),s.editDialog=!1,I.reload({only:["historyRecords"]})}).catch(r=>{r.response?.status===422?(H(r.response.data.errors),m.addFixErrorsMessage()):m.addSubmitionFailedMessage()}).finally(()=>{n.value=!1})});return(t,a)=>(f(),p(J,{modelValue:e(s).editDialog,"onUpdate:modelValue":a[4]||(a[4]=r=>e(s).editDialog=r),"max-width":"540"},{default:l(()=>[o(e(se),{enctype:"multipart/form-data"},{default:l(()=>[o(w,null,{default:l(()=>[o(z,{class:"pa-4","prepend-icon":e(re)},{default:l(()=>[o(A,null,{default:l(()=>[_(g(e(d)("modals.Edit record")),1)]),_:1})]),_:1},8,["prepend-icon"]),o(b),o(K,{class:"px-4 py-6"},{default:l(()=>[O("div",oe,[e(s).activeRecord.is_active_history?y("",!0):(f(),p(te,{key:0,label:e(d)("fields.Status"),items:e(C).props.statuses,modelValue:e(i).status_id,"onUpdate:modelValue":a[0]||(a[0]=r=>e(i).status_id=r),"error-messages":e(c).status_id,required:""},null,8,["label","items","modelValue","error-messages"])),o(Y,{label:e(d)("dates.Start date"),modelValue:e(i).start_date,"onUpdate:modelValue":a[1]||(a[1]=r=>e(i).start_date=r),"error-messages":e(c).start_date,required:""},null,8,["label","modelValue","error-messages"]),e(s).activeRecord.is_active_history?y("",!0):(f(),p(Y,{key:1,label:e(d)("dates.End date"),modelValue:e(i).end_date,"onUpdate:modelValue":a[2]||(a[2]=r=>e(i).end_date=r),"error-messages":e(c).end_date,required:""},null,8,["label","modelValue","error-messages"]))])]),_:1}),o(b),o(G,{class:"pa-4"},{default:l(()=>[o(x,{class:"px-6",color:"grey-lighten-2",onClick:a[3]||(a[3]=r=>e(s).editDialog=!1)},{default:l(()=>[_(g(e(d)("actions.Cancel")),1)]),_:1}),o(x,{class:"px-6",color:"success",loading:n.value,disabled:!e(R).valid,onClick:e($)},{default:l(()=>[_(g(e(d)("actions.Update")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};export{be as default};
