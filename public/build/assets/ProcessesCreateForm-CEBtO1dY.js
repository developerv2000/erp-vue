import{u as J,d as K,h as U,s as H,y as A,v as N,z as n,cT as L,x as $,S as P,B as W,j as X,c as b,o as V,w as s,a as l,b as e,g as C,t as Z,cU as S,k as F}from"./app-DFGAykv1.js";import{u as h,b as ee,F as re}from"./vee-validate-bwBYQxrX.js";import{u as le}from"./useVeeFormFields-BYBd5kGd.js";import{u as ae}from"./useFormData-CgBSWld4.js";import{u as oe}from"./messages-DM6Hzgr9.js";import{D as y}from"./DefaultSheet-dw4Mk5Bv.js";import{_ as D}from"./DefaultTitle-CJn9DB1m.js";import se from"./AboutProduct-CCFBLPjV.js";import ue from"./ProcessesEditProductBlock-DpPgQCG0.js";import{_ as f}from"./DefaultTextField-C7s22ckC.js";import{_ as c}from"./DefaultAutocomplete-D2AwreME.js";import{_ as te}from"./DefaultWysiwyg-ChN-Wu_1.js";import{_ as de}from"./DefaultDateInput-CKsnSWej.js";import{_ as g}from"./DefaultNumberInput-BlxvA38l.js";import{F as ie}from"./FormActionsContainer-DhN9f8m4.js";import{_ as ne}from"./FormResetButton-eM4AfET6.js";import{_ as me,a as _e}from"./FormStoreAndReset-Br8QPaKf.js";import{_ as fe}from"./FormStoreWithoutReseting-CrnYry9j.js";import pe from"./ProcessesCreateCountriesBlock-BdHE4WTs.js";import{r as ce}from"./queryHelper-zuYrvkeK.js";import{V as v,a as i}from"./VRow-DeYYAS09.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VTable-rJPrYe08.js";import"./utilities-BOpNCN-e.js";import"./WrappedLabelGroup-uY5caKSu.js";import"./StandardLabeledGroup-DZwc3k__.js";import"./filter-DJBblzN3.js";import"./mdi-_GS73Yti.js";import"./VNumberInput-_J9CdEh5.js";import"./DefaultButton-BwBxuaXS.js";const Je={__name:"ProcessesCreateForm",setup(ge){const{t:u}=J(),{objectToFormData:R}=ae(),m=K(),M=oe(),p=U(!1),q=U(!1),k=U(!1),_=U(1),j=H(()=>{const d={product_id:n().required(),product_form_id:n().required(),product_shelf_life_id:n().required(),product_class_id:n().required(),product_moq:n().nullable(),status_id:n().required(),country_ids:A().required().min(1),responsible_person_id:n().required(),created_at:L().nullable(),countries:A().of(N({country_id:n().required(),forecast_year_1:n().required(),forecast_year_2:n().required(),forecast_year_3:n().required()}))};return _.value>=2&&(d.clinical_trial_country_ids=A()),_.value>=3&&(d.manufacturer_first_offered_price=n().required(),d.manufacturer_followed_offered_price=n().nullable(),d.currency_id=n().required(),d.our_first_offered_price=n().required(),d.our_followed_offered_price=n().nullable(),d.marketing_authorization_holder_id=_.value>=5?n().required():n().nullable(),d.trademark_en=_.value>=5?$().required():$().nullable(),d.trademark_ru=_.value>=5?$().required():$().nullable()),_.value>=4&&(d.agreed_price=n().required(),d.increased_price=n().nullable()),N(d)}),x=H(()=>({product_id:m.props.product.id,product_form_id:m.props.product.form_id,product_dosage:m.props.product.dosage,product_pack:m.props.product.pack,product_shelf_life_id:m.props.product.shelf_life_id,product_class_id:m.props.product.class_id,product_moq:m.props.product.moq,status_id:m.props.defaultSelectedStatusID,country_ids:[],responsible_person_id:null,created_at:null,countries:[],comment:null,down_payment_1:null,down_payment_2:null,down_payment_condition:null,dossier_status:null,clinical_trial_year:null,clinical_trial_country_ids:[],clinical_trial_ich_country:null,manufacturer_first_offered_price:null,manufacturer_followed_offered_price:null,currency_id:m.props.defaultSelectedCurrencyID,our_first_offered_price:null,our_followed_offered_price:null,marketing_authorization_holder_id:m.props.defaultSelectedMAHID,trademark_en:null,trademark_ru:null,agreed_price:null,increased_price:null})),{errors:t,handleSubmit:E,resetForm:T,setErrors:Y,meta:B}=h({validationSchema:j,initialValues:{...x.value}}),{values:o}=le(Object.keys(x.value)),{fields:w,push:I,remove:O}=ee("countries");P(()=>o.status_id,d=>{if(!d){_.value=1;return}_.value=m.props.restrictedStatuses.find(r=>r.id==d).general_status.stage}),P(()=>o.country_ids,(d=[])=>{for(const r of d)w.value.some(G=>G.value.country_id===r)||I({country_id:r,forecast_year_1:null,forecast_year_2:null,forecast_year_3:null});for(let r=w.value.length-1;r>=0;r--){const a=w.value[r].value.country_id;d.includes(a)||O(r)}},{deep:!0,immediate:!0});const z=E(d=>{p.value=!0,ce(d,["created_at"]);const r=R(d);W.post(route("mad.processes.store"),r).then(()=>{M.addCreatedSuccessfullyMessage(),q.value?window.history.back():Q()}).catch(a=>{a.response?.status===422?(Y(a.response.data.errors),M.addFixErrorsMessage()):M.addSubmitionFailedMessage()}).finally(()=>{p.value=!1})}),Q=()=>{X.reload({only:["product"],onSuccess:()=>{k.value&&T({values:x.value})}})};return(d,r)=>(V(),b(e(re),{class:"d-flex flex-column ga-6 pb-8",enctype:"multipart/form-data"},{default:s(()=>[l(se,{product:e(m).props.product},null,8,["product"]),l(ue,{values:e(o),errors:e(t)},null,8,["values","errors"]),l(y,null,{default:s(()=>[l(D,null,{default:s(()=>[C(Z(e(u)("pages.Main")),1)]),_:1}),l(v,null,{default:s(()=>[l(i,{cols:"4"},{default:s(()=>[l(c,{label:e(u)("fields.Status"),items:e(m).props.restrictedStatuses,modelValue:e(o).status_id,"onUpdate:modelValue":r[0]||(r[0]=a=>e(o).status_id=a),"error-messages":e(t).status_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),l(i,{cols:"4"},{default:s(()=>[l(c,{label:e(u)("fields.Search country"),"item-title":"code",items:e(m).props.countriesOrderedByProcessesCount,modelValue:e(o).country_ids,"onUpdate:modelValue":r[1]||(r[1]=a=>e(o).country_ids=a),"error-messages":e(t).country_ids,multiple:"",required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),l(i,{cols:"4"},{default:s(()=>[l(c,{label:e(u)("fields.Responsible"),items:e(m).props.responsiblePeople,modelValue:e(o).responsible_person_id,"onUpdate:modelValue":r[2]||(r[2]=a=>e(o).responsible_person_id=a),"error-messages":e(t).responsible_person_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),l(i,{cols:"4"},{default:s(()=>[l(de,{label:e(u)("dates.Historical"),modelValue:e(o).created_at,"onUpdate:modelValue":r[3]||(r[3]=a=>e(o).created_at=a),"error-messages":e(t).created_at},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),l(S,null,{default:s(()=>[e(o).country_ids.length?(V(),b(pe,{key:0,fields:e(w),errors:e(t),push:e(I),remove:e(O)},null,8,["fields","errors","push","remove"])):F("",!0)]),_:1}),l(S,null,{default:s(()=>[_.value>=2?(V(),b(y,{key:0},{default:s(()=>[l(D,null,{default:s(()=>[...r[26]||(r[26]=[C("2ПО",-1)])]),_:1}),l(v,null,{default:s(()=>[l(i,{cols:"4"},{default:s(()=>[l(f,{label:e(u)("fields.Down payment 1"),modelValue:e(o).down_payment_1,"onUpdate:modelValue":r[4]||(r[4]=a=>e(o).down_payment_1=a),"error-messages":e(t).down_payment_1},null,8,["label","modelValue","error-messages"])]),_:1}),l(i,{cols:"4"},{default:s(()=>[l(f,{label:e(u)("fields.Down payment 2"),modelValue:e(o).down_payment_2,"onUpdate:modelValue":r[5]||(r[5]=a=>e(o).down_payment_2=a),"error-messages":e(t).down_payment_2},null,8,["label","modelValue","error-messages"])]),_:1}),l(i,{cols:"4"},{default:s(()=>[l(f,{label:e(u)("fields.Down payment condition"),modelValue:e(o).down_payment_condition,"onUpdate:modelValue":r[6]||(r[6]=a=>e(o).down_payment_condition=a),"error-messages":e(t).down_payment_condition},null,8,["label","modelValue","error-messages"])]),_:1}),l(i,{cols:"4"},{default:s(()=>[l(f,{label:e(u)("fields.Dossier status"),modelValue:e(o).dossier_status,"onUpdate:modelValue":r[7]||(r[7]=a=>e(o).dossier_status=a),"error-messages":e(t).dossier_status},null,8,["label","modelValue","error-messages"])]),_:1}),l(i,{cols:"4"},{default:s(()=>[l(f,{label:e(u)("fields.Year Cr/Be"),modelValue:e(o).clinical_trial_year,"onUpdate:modelValue":r[8]||(r[8]=a=>e(o).clinical_trial_year=a),"error-messages":e(t).clinical_trial_year},null,8,["label","modelValue","error-messages"])]),_:1}),l(i,{cols:"4"},{default:s(()=>[l(c,{label:e(u)("fields.Countries Cr/Be"),items:e(m).props.countriesOrderedByName,modelValue:e(o).clinical_trial_country_ids,"onUpdate:modelValue":r[9]||(r[9]=a=>e(o).clinical_trial_country_ids=a),"error-messages":e(t).clinical_trial_country_ids,multiple:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),l(i,{cols:"4"},{default:s(()=>[l(f,{label:e(u)("fields.Country ich"),modelValue:e(o).clinical_trial_ich_country,"onUpdate:modelValue":r[10]||(r[10]=a=>e(o).clinical_trial_ich_country=a),"error-messages":e(t).clinical_trial_ich_country},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1})):F("",!0)]),_:1}),l(S,null,{default:s(()=>[_.value>=3?(V(),b(y,{key:0},{default:s(()=>[l(D,null,{default:s(()=>[...r[27]||(r[27]=[C("3АЦ",-1)])]),_:1}),l(v,null,{default:s(()=>[l(i,{cols:"4"},{default:s(()=>[l(g,{label:e(u)("fields.Manufacturer price 1"),modelValue:e(o).manufacturer_first_offered_price,"onUpdate:modelValue":r[11]||(r[11]=a=>e(o).manufacturer_first_offered_price=a),"error-messages":e(t).manufacturer_first_offered_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),l(i,{cols:"4"},{default:s(()=>[l(g,{label:e(u)("fields.Manufacturer price 2"),modelValue:e(o).manufacturer_followed_offered_price,"onUpdate:modelValue":r[12]||(r[12]=a=>e(o).manufacturer_followed_offered_price=a),"error-messages":e(t).manufacturer_followed_offered_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),l(i,{cols:"4"},{default:s(()=>[l(c,{label:e(u)("fields.Currency"),items:e(m).props.currencies,modelValue:e(o).currency_id,"onUpdate:modelValue":r[13]||(r[13]=a=>e(o).currency_id=a),"error-messages":e(t).currency_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),l(i,{cols:"4"},{default:s(()=>[l(g,{label:e(u)("fields.Our price 1"),modelValue:e(o).our_first_offered_price,"onUpdate:modelValue":r[14]||(r[14]=a=>e(o).our_first_offered_price=a),"error-messages":e(t).our_first_offered_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),l(i,{cols:"4"},{default:s(()=>[l(g,{label:e(u)("fields.Our price 2"),modelValue:e(o).our_followed_offered_price,"onUpdate:modelValue":r[15]||(r[15]=a=>e(o).our_followed_offered_price=a),"error-messages":e(t).our_followed_offered_price,min:0,precision:2,step:.01},null,8,["label","modelValue","error-messages"])]),_:1}),l(i,{cols:"4"},{default:s(()=>[l(c,{label:e(u)("fields.MAH"),items:e(m).props.MAHs,modelValue:e(o).marketing_authorization_holder_id,"onUpdate:modelValue":r[16]||(r[16]=a=>e(o).marketing_authorization_holder_id=a),"error-messages":e(t).marketing_authorization_holder_id,required:_.value>=5},null,8,["label","items","modelValue","error-messages","required"])]),_:1}),l(i,{cols:"4"},{default:s(()=>[l(f,{label:e(u)("fields.TM Eng"),modelValue:e(o).trademark_en,"onUpdate:modelValue":r[17]||(r[17]=a=>e(o).trademark_en=a),"error-messages":e(t).trademark_en,required:_.value>=5},null,8,["label","modelValue","error-messages","required"])]),_:1}),l(i,{cols:"4"},{default:s(()=>[l(f,{label:e(u)("fields.TM Rus"),modelValue:e(o).trademark_ru,"onUpdate:modelValue":r[18]||(r[18]=a=>e(o).trademark_ru=a),"error-messages":e(t).trademark_ru,required:_.value>=5},null,8,["label","modelValue","error-messages","required"])]),_:1})]),_:1})]),_:1})):F("",!0)]),_:1}),l(S,null,{default:s(()=>[_.value>=4?(V(),b(y,{key:0},{default:s(()=>[l(D,null,{default:s(()=>[...r[28]||(r[28]=[C("4СЦ",-1)])]),_:1}),l(v,null,{default:s(()=>[l(i,{cols:"4"},{default:s(()=>[l(g,{label:e(u)("fields.Agreed price"),modelValue:e(o).agreed_price,"onUpdate:modelValue":r[19]||(r[19]=a=>e(o).agreed_price=a),"error-messages":e(t).agreed_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),l(i,{cols:"4"},{default:s(()=>[l(g,{label:e(u)("fields.Increased price"),modelValue:e(o).increased_price,"onUpdate:modelValue":r[20]||(r[20]=a=>e(o).increased_price=a),"error-messages":e(t).increased_price,min:0,precision:2,step:.01},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1})):F("",!0)]),_:1}),l(y,null,{default:s(()=>[l(v,null,{default:s(()=>[l(i,{cols:"12"},{default:s(()=>[l(te,{modelValue:e(o).comment,"onUpdate:modelValue":r[21]||(r[21]=a=>e(o).comment=a),label:e(u)("Comment"),folder:"comments"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),l(ie,null,{default:s(()=>[l(ne,{onClick:r[22]||(r[22]=a=>e(T)()),loading:p.value},null,8,["loading"]),l(fe,{onClick:r[23]||(r[23]=a=>{k.value=!1,q.value=!1,e(z)()}),loading:p.value,disabled:!e(B).valid},null,8,["loading","disabled"]),l(me,{onClick:r[24]||(r[24]=a=>{k.value=!0,q.value=!1,e(z)()}),loading:p.value,disabled:!e(B).valid},null,8,["loading","disabled"]),l(_e,{onClick:r[25]||(r[25]=a=>{k.value=!0,q.value=!0,e(z)()}),loading:p.value,disabled:!e(B).valid},null,8,["loading","disabled"])]),_:1})]),_:1}))}};export{Je as default};
