import{u as J,d as K,h as U,s as H,y as A,v as N,z as d,cT as L,x as S,S as P,B as W,j as X,c as b,o as V,w as o,a as r,b as e,g as $,t as Z,cU as C,k as F}from"./app-C0zSqAfj.js";import{u as h,b as ee,F as le}from"./vee-validate-C0jZYkdP.js";import{u as re}from"./useVeeFormFields-BCOdbofZ.js";import{u as ae}from"./useFormData-CgBSWld4.js";import{u as se}from"./messages-CzH3BBFj.js";import{D as y}from"./DefaultSheet-C70k7YPX.js";import{_ as D}from"./DefaultTitle-qYoYQrrk.js";import oe from"./AboutProduct-cvta7Eod.js";import ue from"./ProcessesEditProductBlock-BxfLdODs.js";import{_ as f}from"./DefaultTextField-CMYLloHQ.js";import{_ as c}from"./DefaultAutocomplete-DccYNaD_.js";import{_ as te}from"./DefaultWysiwyg-CjR81aaO.js";import{_ as de}from"./DefaultDateInput-BBxkc_L3.js";import{_ as g}from"./DefaultNumberInput-DzwN4gRd.js";import{F as ie}from"./FormActionsContainer-aAyW205H.js";import{_ as ne}from"./FormResetButton-BclX20An.js";import{_ as me,a as _e}from"./FormStoreAndReset-BAIgqRry.js";import{_ as fe}from"./FormStoreWithoutReseting-DjnZYMs1.js";import pe from"./ProcessesCreateCountriesBlock-DTFmZaVK.js";import{r as ce}from"./queryHelper-zuYrvkeK.js";import{V as v,a as n}from"./VRow-klpByHYZ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VTable-DDWJYS8C.js";import"./utilities-BOpNCN-e.js";import"./WrappedLabelGroup-BdeuxiSz.js";import"./StandardLabeledGroup-NCZUUQN6.js";import"./filter-CKwsHNQn.js";import"./mdi-BINEaKNx.js";import"./VNumberInput-CEmwxnOm.js";import"./DefaultButton-HVgzgV1x.js";const Je={__name:"ProcessesCreateForm",setup(ge){const{t:u}=J(),{objectToFormData:R}=ae(),m=K(),M=se(),p=U(!1),q=U(!1),k=U(!1),_=U(1),j=H(()=>{const i={product_id:d().required(),product_form_id:d().required(),product_shelf_life_id:d().required(),product_class_id:d().required(),product_moq:d().nullable(),status_id:d().required(),country_ids:A().required().min(1),responsible_person_id:d().required(),created_at:L().nullable(),countries:A().of(N({country_id:d().required(),forecast_year_1:_.value>=2?d().required():d().nullable(),forecast_year_2:_.value>=2?d().required():d().nullable(),forecast_year_3:_.value>=2?d().required():d().nullable()}))};return _.value>=2&&(i.clinical_trial_country_ids=A()),_.value>=3&&(i.manufacturer_first_offered_price=d().required(),i.manufacturer_followed_offered_price=d().nullable(),i.currency_id=d().required(),i.our_first_offered_price=d().required(),i.our_followed_offered_price=d().nullable(),i.marketing_authorization_holder_id=_.value>=5?d().required():d().nullable(),i.trademark_en=_.value>=5?S().required():S().nullable(),i.trademark_ru=_.value>=5?S().required():S().nullable()),_.value>=4&&(i.agreed_price=d().required(),i.increased_price=d().nullable()),N(i)}),x=H(()=>({product_id:m.props.product.id,product_form_id:m.props.product.form_id,product_dosage:m.props.product.dosage,product_pack:m.props.product.pack,product_shelf_life_id:m.props.product.shelf_life_id,product_class_id:m.props.product.class_id,product_moq:m.props.product.moq,status_id:m.props.defaultSelectedStatusID,country_ids:[],responsible_person_id:null,created_at:null,countries:[],comment:null,down_payment_1:null,down_payment_2:null,down_payment_condition:null,dossier_status:null,clinical_trial_year:null,clinical_trial_country_ids:[],clinical_trial_ich_country:null,manufacturer_first_offered_price:null,manufacturer_followed_offered_price:null,currency_id:m.props.defaultSelectedCurrencyID,our_first_offered_price:null,our_followed_offered_price:null,marketing_authorization_holder_id:m.props.defaultSelectedMAHID,trademark_en:null,trademark_ru:null,agreed_price:null,increased_price:null})),{errors:t,handleSubmit:E,resetForm:T,setErrors:Y,meta:B}=h({validationSchema:j,initialValues:{...x.value}}),{values:s}=re(Object.keys(x.value)),{fields:w,push:I,remove:O}=ee("countries");P(()=>s.status_id,i=>{if(!i){_.value=1;return}_.value=m.props.restrictedStatuses.find(l=>l.id==i).general_status.stage}),P(()=>s.country_ids,(i=[])=>{for(const l of i)w.value.some(G=>G.value.country_id===l)||I({country_id:l,forecast_year_1:null,forecast_year_2:null,forecast_year_3:null});for(let l=w.value.length-1;l>=0;l--){const a=w.value[l].value.country_id;i.includes(a)||O(l)}},{deep:!0,immediate:!0});const z=E(i=>{p.value=!0,ce(i,["created_at"]);const l=R(i);W.post(route("mad.processes.store"),l).then(()=>{M.addCreatedSuccessfullyMessage(),q.value?window.history.back():Q()}).catch(a=>{a.response?.status===422?(Y(a.response.data.errors),M.addFixErrorsMessage()):M.addSubmitionFailedMessage()}).finally(()=>{p.value=!1})}),Q=()=>{X.reload({only:["product"],onSuccess:()=>{k.value&&T({values:x.value})}})};return(i,l)=>(V(),b(e(le),{class:"d-flex flex-column ga-6 pb-8",enctype:"multipart/form-data"},{default:o(()=>[r(oe,{product:e(m).props.product},null,8,["product"]),r(ue,{values:e(s),errors:e(t)},null,8,["values","errors"]),r(y,null,{default:o(()=>[r(D,null,{default:o(()=>[$(Z(e(u)("pages.Main")),1)]),_:1}),r(v,null,{default:o(()=>[r(n,{cols:"4"},{default:o(()=>[r(c,{label:e(u)("fields.Status"),items:e(m).props.restrictedStatuses,modelValue:e(s).status_id,"onUpdate:modelValue":l[0]||(l[0]=a=>e(s).status_id=a),"error-messages":e(t).status_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),r(n,{cols:"4"},{default:o(()=>[r(c,{label:e(u)("fields.Search country"),"item-title":"code",items:e(m).props.countriesOrderedByProcessesCount,modelValue:e(s).country_ids,"onUpdate:modelValue":l[1]||(l[1]=a=>e(s).country_ids=a),"error-messages":e(t).country_ids,multiple:"",required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),r(n,{cols:"4"},{default:o(()=>[r(c,{label:e(u)("fields.Responsible"),items:e(m).props.responsiblePeople,modelValue:e(s).responsible_person_id,"onUpdate:modelValue":l[2]||(l[2]=a=>e(s).responsible_person_id=a),"error-messages":e(t).responsible_person_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),r(n,{cols:"4"},{default:o(()=>[r(de,{label:e(u)("dates.Historical"),modelValue:e(s).created_at,"onUpdate:modelValue":l[3]||(l[3]=a=>e(s).created_at=a),"error-messages":e(t).created_at},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),r(C,null,{default:o(()=>[e(s).country_ids.length?(V(),b(pe,{key:0,fields:e(w),errors:e(t),push:e(I),remove:e(O),statusStage:_.value},null,8,["fields","errors","push","remove","statusStage"])):F("",!0)]),_:1}),r(C,null,{default:o(()=>[_.value>=2?(V(),b(y,{key:0},{default:o(()=>[r(D,null,{default:o(()=>[...l[26]||(l[26]=[$("2ПО",-1)])]),_:1}),r(v,null,{default:o(()=>[r(n,{cols:"4"},{default:o(()=>[r(f,{label:e(u)("fields.Down payment 1"),modelValue:e(s).down_payment_1,"onUpdate:modelValue":l[4]||(l[4]=a=>e(s).down_payment_1=a),"error-messages":e(t).down_payment_1},null,8,["label","modelValue","error-messages"])]),_:1}),r(n,{cols:"4"},{default:o(()=>[r(f,{label:e(u)("fields.Down payment 2"),modelValue:e(s).down_payment_2,"onUpdate:modelValue":l[5]||(l[5]=a=>e(s).down_payment_2=a),"error-messages":e(t).down_payment_2},null,8,["label","modelValue","error-messages"])]),_:1}),r(n,{cols:"4"},{default:o(()=>[r(f,{label:e(u)("fields.Down payment condition"),modelValue:e(s).down_payment_condition,"onUpdate:modelValue":l[6]||(l[6]=a=>e(s).down_payment_condition=a),"error-messages":e(t).down_payment_condition},null,8,["label","modelValue","error-messages"])]),_:1}),r(n,{cols:"4"},{default:o(()=>[r(f,{label:e(u)("fields.Dossier status"),modelValue:e(s).dossier_status,"onUpdate:modelValue":l[7]||(l[7]=a=>e(s).dossier_status=a),"error-messages":e(t).dossier_status},null,8,["label","modelValue","error-messages"])]),_:1}),r(n,{cols:"4"},{default:o(()=>[r(f,{label:e(u)("fields.Year Cr/Be"),modelValue:e(s).clinical_trial_year,"onUpdate:modelValue":l[8]||(l[8]=a=>e(s).clinical_trial_year=a),"error-messages":e(t).clinical_trial_year},null,8,["label","modelValue","error-messages"])]),_:1}),r(n,{cols:"4"},{default:o(()=>[r(c,{label:e(u)("fields.Countries Cr/Be"),items:e(m).props.countriesOrderedByName,modelValue:e(s).clinical_trial_country_ids,"onUpdate:modelValue":l[9]||(l[9]=a=>e(s).clinical_trial_country_ids=a),"error-messages":e(t).clinical_trial_country_ids,multiple:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),r(n,{cols:"4"},{default:o(()=>[r(f,{label:e(u)("fields.Country ich"),modelValue:e(s).clinical_trial_ich_country,"onUpdate:modelValue":l[10]||(l[10]=a=>e(s).clinical_trial_ich_country=a),"error-messages":e(t).clinical_trial_ich_country},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1})):F("",!0)]),_:1}),r(C,null,{default:o(()=>[_.value>=3?(V(),b(y,{key:0},{default:o(()=>[r(D,null,{default:o(()=>[...l[27]||(l[27]=[$("3АЦ",-1)])]),_:1}),r(v,null,{default:o(()=>[r(n,{cols:"4"},{default:o(()=>[r(g,{label:e(u)("fields.Manufacturer price 1"),modelValue:e(s).manufacturer_first_offered_price,"onUpdate:modelValue":l[11]||(l[11]=a=>e(s).manufacturer_first_offered_price=a),"error-messages":e(t).manufacturer_first_offered_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),r(n,{cols:"4"},{default:o(()=>[r(g,{label:e(u)("fields.Manufacturer price 2"),modelValue:e(s).manufacturer_followed_offered_price,"onUpdate:modelValue":l[12]||(l[12]=a=>e(s).manufacturer_followed_offered_price=a),"error-messages":e(t).manufacturer_followed_offered_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),r(n,{cols:"4"},{default:o(()=>[r(c,{label:e(u)("fields.Currency"),items:e(m).props.currencies,modelValue:e(s).currency_id,"onUpdate:modelValue":l[13]||(l[13]=a=>e(s).currency_id=a),"error-messages":e(t).currency_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),r(n,{cols:"4"},{default:o(()=>[r(g,{label:e(u)("fields.Our price 1"),modelValue:e(s).our_first_offered_price,"onUpdate:modelValue":l[14]||(l[14]=a=>e(s).our_first_offered_price=a),"error-messages":e(t).our_first_offered_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),r(n,{cols:"4"},{default:o(()=>[r(g,{label:e(u)("fields.Our price 2"),modelValue:e(s).our_followed_offered_price,"onUpdate:modelValue":l[15]||(l[15]=a=>e(s).our_followed_offered_price=a),"error-messages":e(t).our_followed_offered_price,min:0,precision:2,step:.01},null,8,["label","modelValue","error-messages"])]),_:1}),r(n,{cols:"4"},{default:o(()=>[r(c,{label:e(u)("fields.MAH"),items:e(m).props.MAHs,modelValue:e(s).marketing_authorization_holder_id,"onUpdate:modelValue":l[16]||(l[16]=a=>e(s).marketing_authorization_holder_id=a),"error-messages":e(t).marketing_authorization_holder_id,required:_.value>=5},null,8,["label","items","modelValue","error-messages","required"])]),_:1}),r(n,{cols:"4"},{default:o(()=>[r(f,{label:e(u)("fields.TM Eng"),modelValue:e(s).trademark_en,"onUpdate:modelValue":l[17]||(l[17]=a=>e(s).trademark_en=a),"error-messages":e(t).trademark_en,required:_.value>=5},null,8,["label","modelValue","error-messages","required"])]),_:1}),r(n,{cols:"4"},{default:o(()=>[r(f,{label:e(u)("fields.TM Rus"),modelValue:e(s).trademark_ru,"onUpdate:modelValue":l[18]||(l[18]=a=>e(s).trademark_ru=a),"error-messages":e(t).trademark_ru,required:_.value>=5},null,8,["label","modelValue","error-messages","required"])]),_:1})]),_:1})]),_:1})):F("",!0)]),_:1}),r(C,null,{default:o(()=>[_.value>=4?(V(),b(y,{key:0},{default:o(()=>[r(D,null,{default:o(()=>[...l[28]||(l[28]=[$("4СЦ",-1)])]),_:1}),r(v,null,{default:o(()=>[r(n,{cols:"4"},{default:o(()=>[r(g,{label:e(u)("fields.Agreed price"),modelValue:e(s).agreed_price,"onUpdate:modelValue":l[19]||(l[19]=a=>e(s).agreed_price=a),"error-messages":e(t).agreed_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),r(n,{cols:"4"},{default:o(()=>[r(g,{label:e(u)("fields.Increased price"),modelValue:e(s).increased_price,"onUpdate:modelValue":l[20]||(l[20]=a=>e(s).increased_price=a),"error-messages":e(t).increased_price,min:0,precision:2,step:.01},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1})):F("",!0)]),_:1}),r(y,null,{default:o(()=>[r(v,null,{default:o(()=>[r(n,{cols:"12"},{default:o(()=>[r(te,{modelValue:e(s).comment,"onUpdate:modelValue":l[21]||(l[21]=a=>e(s).comment=a),label:e(u)("Comment"),folder:"comments"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),r(ie,null,{default:o(()=>[r(ne,{onClick:l[22]||(l[22]=a=>e(T)()),loading:p.value},null,8,["loading"]),r(fe,{onClick:l[23]||(l[23]=a=>{k.value=!1,q.value=!1,e(z)()}),loading:p.value,disabled:!e(B).valid},null,8,["loading","disabled"]),r(me,{onClick:l[24]||(l[24]=a=>{k.value=!0,q.value=!1,e(z)()}),loading:p.value,disabled:!e(B).valid},null,8,["loading","disabled"]),r(_e,{onClick:l[25]||(l[25]=a=>{k.value=!0,q.value=!0,e(z)()}),loading:p.value,disabled:!e(B).valid},null,8,["loading","disabled"])]),_:1})]),_:1}))}};export{Je as default};
