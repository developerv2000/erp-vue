import{u as L,d as Q,h as U,l as H,p as z,m as N,q as d,D as W,n as C,J as P,v as X,j as Z,c as b,o as V,w as s,a as r,b as e,g as F,t as h,dc as S,k as $}from"./app-CMSjNDK4.js";import{u as ee,b as le,F as re}from"./vee-validate-D0NdbX5f.js";import{u as ae}from"./useVeeFormFields-CKtARDYP.js";import{u as oe}from"./useFormData-DEk4Ge6e.js";import{u as se}from"./messages-eCh_LZOb.js";import{u as ue}from"./useDateFormatter-DsH7D03H.js";import{D as y}from"./DefaultSheet-C3udEJ1M.js";import{_ as D}from"./DefaultTitle-C2ikS6Ai.js";import te from"./AboutProduct-BphIU5zP.js";import de from"./ProcessesEditProductBlock-CL4HdNLL.js";import{_ as f}from"./DefaultTextField-JI6kPgYm.js";import{_ as c}from"./DefaultAutocomplete-D9uSFHTZ.js";import{_ as ie}from"./DefaultWysiwyg-Dc19NImY.js";import{_ as ne}from"./DefaultDateInput-hK9FKZtC.js";import{_ as g}from"./DefaultNumberInput-D6-zTVQO.js";import{F as me}from"./FormActionsContainer-CD-jvVHg.js";import{_ as _e}from"./FormResetButton-BccgBDwk.js";import{_ as fe}from"./FormStoreAndRedirectBack-CjMu7GIX.js";import{_ as pe}from"./FormStoreAndReset-C6f2rSFj.js";import{_ as ce}from"./FormStoreWithoutReseting-QUSHW1uk.js";import ge from"./ProcessesCreateCountriesBlock-C_ofLrfO.js";import{V as v,a as i}from"./VRow-Dvbb8rke.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VTable-C3mZiDDs.js";import"./utilities-BOpNCN-e.js";import"./WrappedLabelGroup-YDYEYAYF.js";import"./StandardLabeledGroup-DYDuYIbt.js";import"./filter-gwBCF0wV.js";import"./mdi-BZMfrfO1.js";import"./VNumberInput-BfmNjXd2.js";import"./DefaultButton-CFfFCqKo.js";const Qe={__name:"ProcessesCreateForm",setup(be){const{t:u}=L(),{objectToFormData:R}=oe(),m=Q(),M=se(),{removeDateTimezonesFromFormData:j}=ue(),p=U(!1),q=U(!1),k=U(!1),_=U(1),E=H(()=>{const n={product_id:d().required(),product_form_id:d().required(),product_shelf_life_id:d().required(),product_class_id:d().required(),product_moq:d().nullable(),status_id:d().required(),country_ids:z().required().min(1),responsible_person_id:d().required(),created_at:W().nullable(),countries:z().of(N({country_id:d().required(),forecast_year_1:_.value>=2?d().required():d().nullable(),forecast_year_2:_.value>=2?d().required():d().nullable(),forecast_year_3:_.value>=2?d().required():d().nullable()}))};return _.value>=2&&(n.clinical_trial_country_ids=z()),_.value>=3&&(n.manufacturer_first_offered_price=d().required(),n.manufacturer_followed_offered_price=d().nullable(),n.currency_id=d().required(),n.our_first_offered_price=d().required(),n.our_followed_offered_price=d().nullable(),n.marketing_authorization_holder_id=_.value>=5?d().required():d().nullable(),n.trademark_en=_.value>=5?C().required():C().nullable(),n.trademark_ru=_.value>=5?C().required():C().nullable()),_.value>=4&&(n.agreed_price=d().required(),n.increased_price=d().nullable()),N(n)}),x=H(()=>({product_id:m.props.product.id,product_form_id:m.props.product.form_id,product_dosage:m.props.product.dosage,product_pack:m.props.product.pack,product_shelf_life_id:m.props.product.shelf_life_id,product_class_id:m.props.product.class_id,product_moq:m.props.product.moq,status_id:m.props.defaultSelectedStatusID,country_ids:[],responsible_person_id:null,created_at:null,countries:[],comment:null,down_payment_1:null,down_payment_2:null,down_payment_condition:null,dossier_status:null,clinical_trial_year:null,clinical_trial_country_ids:[],clinical_trial_ich_country:null,manufacturer_first_offered_price:null,manufacturer_followed_offered_price:null,currency_id:m.props.defaultSelectedCurrencyID,our_first_offered_price:null,our_followed_offered_price:null,marketing_authorization_holder_id:m.props.defaultSelectedMAHID,trademark_en:null,trademark_ru:null,agreed_price:null,increased_price:null})),{errors:t,handleSubmit:Y,resetForm:I,setErrors:J,meta:A}=ee({validationSchema:E,initialValues:{...x.value}}),{values:o}=ae(Object.keys(x.value)),{fields:w,push:O,remove:T}=le("countries");P(()=>o.status_id,n=>{if(!n){_.value=1;return}_.value=m.props.restrictedStatuses.find(l=>l.id==n).general_status.stage}),P(()=>o.country_ids,(n=[])=>{for(const l of n)w.value.some(K=>K.value.country_id===l)||O({country_id:l,forecast_year_1:null,forecast_year_2:null,forecast_year_3:null});for(let l=w.value.length-1;l>=0;l--){const a=w.value[l].value.country_id;n.includes(a)||T(l)}},{deep:!0,immediate:!0});const B=Y(n=>{const l=R(n);j(l),p.value=!0,X.post(route("mad.processes.store"),l).then(()=>{M.addCreatedSuccessfullyMessage(),q.value?window.history.back():G()}).catch(a=>{a.response?.status===422?(J(a.response.data.errors),M.addFixErrorsMessage()):M.addSubmitionFailedMessage()}).finally(()=>{p.value=!1})}),G=()=>{Z.reload({only:["product"],onSuccess:()=>{k.value&&I({values:x.value})}})};return(n,l)=>(V(),b(e(re),{class:"d-flex flex-column ga-6 pb-8",enctype:"multipart/form-data"},{default:s(()=>[r(te,{product:e(m).props.product},null,8,["product"]),r(de,{values:e(o),errors:e(t)},null,8,["values","errors"]),r(y,null,{default:s(()=>[r(D,null,{default:s(()=>[F(h(e(u)("pages.Main")),1)]),_:1}),r(v,null,{default:s(()=>[r(i,{cols:"4"},{default:s(()=>[r(c,{label:e(u)("fields.Status"),items:e(m).props.restrictedStatuses,modelValue:e(o).status_id,"onUpdate:modelValue":l[0]||(l[0]=a=>e(o).status_id=a),"error-messages":e(t).status_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(c,{label:e(u)("fields.Search country"),"item-title":"code",items:e(m).props.countriesOrderedByProcessesCount,modelValue:e(o).country_ids,"onUpdate:modelValue":l[1]||(l[1]=a=>e(o).country_ids=a),"error-messages":e(t).country_id,multiple:"",required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(c,{label:e(u)("fields.Responsible"),items:e(m).props.responsiblePeople,modelValue:e(o).responsible_person_id,"onUpdate:modelValue":l[2]||(l[2]=a=>e(o).responsible_person_id=a),"error-messages":e(t).responsible_person_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(ne,{label:e(u)("dates.Historical"),modelValue:e(o).created_at,"onUpdate:modelValue":l[3]||(l[3]=a=>e(o).created_at=a),"error-messages":e(t).created_at},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),r(S,null,{default:s(()=>[e(o).country_ids.length?(V(),b(ge,{key:0,fields:e(w),errors:e(t),push:e(O),remove:e(T),statusStage:_.value},null,8,["fields","errors","push","remove","statusStage"])):$("",!0)]),_:1}),r(S,null,{default:s(()=>[_.value>=2?(V(),b(y,{key:0},{default:s(()=>[r(D,null,{default:s(()=>[...l[25]||(l[25]=[F("2ПО",-1)])]),_:1}),r(v,null,{default:s(()=>[r(i,{cols:"4"},{default:s(()=>[r(f,{label:e(u)("fields.Down payment 1"),modelValue:e(o).down_payment_1,"onUpdate:modelValue":l[4]||(l[4]=a=>e(o).down_payment_1=a),"error-messages":e(t).down_payment_1},null,8,["label","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(f,{label:e(u)("fields.Down payment 2"),modelValue:e(o).down_payment_2,"onUpdate:modelValue":l[5]||(l[5]=a=>e(o).down_payment_2=a),"error-messages":e(t).down_payment_2},null,8,["label","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(f,{label:e(u)("fields.Down payment condition"),modelValue:e(o).down_payment_condition,"onUpdate:modelValue":l[6]||(l[6]=a=>e(o).down_payment_condition=a),"error-messages":e(t).down_payment_condition},null,8,["label","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(f,{label:e(u)("fields.Dossier status"),modelValue:e(o).dossier_status,"onUpdate:modelValue":l[7]||(l[7]=a=>e(o).dossier_status=a),"error-messages":e(t).dossier_status},null,8,["label","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(f,{label:e(u)("fields.Year Cr/Be"),modelValue:e(o).clinical_trial_year,"onUpdate:modelValue":l[8]||(l[8]=a=>e(o).clinical_trial_year=a),"error-messages":e(t).clinical_trial_year},null,8,["label","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(c,{label:e(u)("fields.Countries Cr/Be"),items:e(m).props.countriesOrderedByName,modelValue:e(o).clinical_trial_country_ids,"onUpdate:modelValue":l[9]||(l[9]=a=>e(o).clinical_trial_country_ids=a),"error-messages":e(t).clinical_trial_country_ids,multiple:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(f,{label:e(u)("fields.Country ich"),modelValue:e(o).clinical_trial_ich_country,"onUpdate:modelValue":l[10]||(l[10]=a=>e(o).clinical_trial_ich_country=a),"error-messages":e(t).clinical_trial_ich_country},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1})):$("",!0)]),_:1}),r(S,null,{default:s(()=>[_.value>=3?(V(),b(y,{key:0},{default:s(()=>[r(D,null,{default:s(()=>[...l[26]||(l[26]=[F("3АЦ",-1)])]),_:1}),r(v,null,{default:s(()=>[r(i,{cols:"4"},{default:s(()=>[r(g,{label:e(u)("fields.Manufacturer price 1"),modelValue:e(o).manufacturer_first_offered_price,"onUpdate:modelValue":l[11]||(l[11]=a=>e(o).manufacturer_first_offered_price=a),"error-messages":e(t).manufacturer_first_offered_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(g,{label:e(u)("fields.Manufacturer price 2"),modelValue:e(o).manufacturer_followed_offered_price,"onUpdate:modelValue":l[12]||(l[12]=a=>e(o).manufacturer_followed_offered_price=a),"error-messages":e(t).manufacturer_followed_offered_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(c,{label:e(u)("fields.Currency"),items:e(m).props.currencies,modelValue:e(o).currency_id,"onUpdate:modelValue":l[13]||(l[13]=a=>e(o).currency_id=a),"error-messages":e(t).currency_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(g,{label:e(u)("fields.Our price 1"),modelValue:e(o).our_first_offered_price,"onUpdate:modelValue":l[14]||(l[14]=a=>e(o).our_first_offered_price=a),"error-messages":e(t).our_first_offered_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(g,{label:e(u)("fields.Our price 2"),modelValue:e(o).our_followed_offered_price,"onUpdate:modelValue":l[15]||(l[15]=a=>e(o).our_followed_offered_price=a),"error-messages":e(t).our_followed_offered_price,min:0,precision:2,step:.01},null,8,["label","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(c,{label:e(u)("fields.MAH"),items:e(m).props.MAHs,modelValue:e(o).marketing_authorization_holder_id,"onUpdate:modelValue":l[16]||(l[16]=a=>e(o).marketing_authorization_holder_id=a),"error-messages":e(t).marketing_authorization_holder_id,required:_.value>=5},null,8,["label","items","modelValue","error-messages","required"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(f,{label:e(u)("fields.TM Eng"),modelValue:e(o).trademark_en,"onUpdate:modelValue":l[17]||(l[17]=a=>e(o).trademark_en=a),"error-messages":e(t).trademark_en,required:_.value>=5},null,8,["label","modelValue","error-messages","required"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(f,{label:e(u)("fields.TM Rus"),modelValue:e(o).trademark_ru,"onUpdate:modelValue":l[18]||(l[18]=a=>e(o).trademark_ru=a),"error-messages":e(t).trademark_ru,required:_.value>=5},null,8,["label","modelValue","error-messages","required"])]),_:1})]),_:1})]),_:1})):$("",!0)]),_:1}),r(S,null,{default:s(()=>[_.value>=4?(V(),b(y,{key:0},{default:s(()=>[r(D,null,{default:s(()=>[...l[27]||(l[27]=[F("4СЦ",-1)])]),_:1}),r(v,null,{default:s(()=>[r(i,{cols:"4"},{default:s(()=>[r(g,{label:e(u)("fields.Agreed price"),modelValue:e(o).agreed_price,"onUpdate:modelValue":l[19]||(l[19]=a=>e(o).agreed_price=a),"error-messages":e(t).agreed_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(g,{label:e(u)("fields.Increased price"),modelValue:e(o).increased_price,"onUpdate:modelValue":l[20]||(l[20]=a=>e(o).increased_price=a),"error-messages":e(t).increased_price,min:0,precision:2,step:.01},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1})):$("",!0)]),_:1}),r(y,null,{default:s(()=>[r(v,null,{default:s(()=>[r(i,{cols:"12"},{default:s(()=>[r(ie,{modelValue:e(o).comment,"onUpdate:modelValue":l[21]||(l[21]=a=>e(o).comment=a),label:e(u)("Comment"),folder:"comments"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),r(me,null,{default:s(()=>[r(_e,{onClick:e(I),loading:p.value},null,8,["onClick","loading"]),r(ce,{onClick:l[22]||(l[22]=a=>{k.value=!1,q.value=!1,e(B)()}),loading:p.value,disabled:!e(A).valid},null,8,["loading","disabled"]),r(pe,{onClick:l[23]||(l[23]=a=>{k.value=!0,q.value=!1,e(B)()}),loading:p.value,disabled:!e(A).valid},null,8,["loading","disabled"]),r(fe,{onClick:l[24]||(l[24]=a=>{k.value=!0,q.value=!0,e(B)()}),loading:p.value,disabled:!e(A).valid},null,8,["loading","disabled"])]),_:1})]),_:1}))}};export{Qe as default};
