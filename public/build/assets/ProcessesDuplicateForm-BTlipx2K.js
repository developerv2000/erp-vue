import{u as R,c as b,o as y,w as s,g as q,t as E,b as e,d as J,h as B,l as T,p as D,m as I,q as n,d6 as L,n as U,Y as O,v as W,a as l,d7 as $,k as F}from"./app-SLdfdST1.js";import{u as X,b as Z,F as h}from"./vee-validate-s7Jr4GzR.js";import{u as ee}from"./useVeeFormFields-BSwow4AR.js";import{u as re}from"./useFormData-CgBSWld4.js";import{u as le}from"./messages-DVX0Iyax.js";import{D as V}from"./DefaultSheet-DeG_jyLU.js";import{_ as C}from"./DefaultTitle-DO0xp_CO.js";import ae from"./AboutProduct-BeR2oLn5.js";import oe from"./ProcessesEditProductBlock-CsaXWjMz.js";import{_ as p}from"./DefaultTextField-BQf_WgAB.js";import{_ as c}from"./DefaultAutocomplete-CwROT9Gd.js";import{_ as se}from"./DefaultWysiwyg-DBZ6n2Re.js";import{_ as te}from"./DefaultDateInput-ev0cfuy0.js";import{_ as g}from"./DefaultNumberInput-CochmA24.js";import{F as de}from"./FormActionsContainer-D9nsxAS8.js";import{_ as ue}from"./FormResetButton-BQGzC965.js";import ie from"./ProcessesCreateCountriesBlock-zuFqbIv0.js";import{r as ne}from"./queryHelper-C2x2SXyh.js";import{_ as _e}from"./DefaultButton-BeKIUX7r.js";import{E as me}from"./mdi-DZCuF3m0.js";import{V as v,a as _}from"./VRow-C6_DkKUC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VTable-CvUAm-J-.js";import"./utilities-BOpNCN-e.js";import"./StandardLabeledGroup-CT3OW7Q_.js";import"./filter-CukaYM7o.js";import"./WrappedLabelGroup-DxXllw0E.js";import"./VNumberInput-CRTYTHMa.js";const fe={__name:"FormDuplicateAndRedirectBack",setup(H){const{t:d}=R();return(M,f)=>(y(),b(_e,{color:"success","prepend-icon":e(me)},{default:s(()=>[q(E(e(d)("actions.Duplicate and redirect back")),1)]),_:1},8,["prepend-icon"]))}},Pe={__name:"ProcessesDuplicateForm",setup(H){const{t:d}=R(),{objectToFormData:M}=re(),f=J(),S=le(),w=B(!1),t=f.props.record,m=B(t.status.general_status.stage),N=T(()=>{const u={product_id:n().required(),product_form_id:n().required(),product_shelf_life_id:n().required(),product_class_id:n().required(),product_moq:n().nullable(),status_id:n().required(),country_ids:D().required().min(1),responsible_person_id:n().required(),created_at:L().nullable(),countries:D().of(I({country_id:n().required(),forecast_year_1:m.value>=2?n().required():n().nullable(),forecast_year_2:m.value>=2?n().required():n().nullable(),forecast_year_3:m.value>=2?n().required():n().nullable()}))};return m.value>=2&&(u.clinical_trial_country_ids=D()),m.value>=3&&(u.manufacturer_first_offered_price=n().required(),u.manufacturer_followed_offered_price=n().nullable(),u.currency_id=n().required(),u.our_first_offered_price=n().required(),u.our_followed_offered_price=n().nullable(),u.marketing_authorization_holder_id=m.value>=5?n().required():n().nullable(),u.trademark_en=m.value>=5?U().required():U().nullable(),u.trademark_ru=m.value>=5?U().required():U().nullable()),m.value>=4&&(u.agreed_price=n().required(),u.increased_price=n().nullable()),I(u)}),x=T(()=>({product_id:t.product_id,product_form_id:t.product.form_id,product_dosage:t.product.dosage,product_pack:t.product.pack,product_shelf_life_id:t.product.shelf_life_id,product_class_id:t.product.class_id,product_moq:t.product.moq,status_id:t.status_id,country_ids:[],responsible_person_id:t.responsible_person_id,created_at:null,countries:[],comment:null,down_payment_1:t.down_payment_1,down_payment_2:t.down_payment_2,down_payment_condition:t.down_payment_condition,dossier_status:t.dossier_status,clinical_trial_year:t.clinical_trial_year,clinical_trial_country_ids:t.clinical_trial_countries.map(u=>u.id),clinical_trial_ich_country:t.clinical_trial_ich_country,manufacturer_first_offered_price:t.manufacturer_first_offered_price,manufacturer_followed_offered_price:t.manufacturer_followed_offered_price,currency_id:t.currency_id??f.props.defaultSelectedCurrencyID,our_first_offered_price:t.our_first_offered_price,our_followed_offered_price:t.our_followed_offered_price,marketing_authorization_holder_id:t.marketing_authorization_holder_id??f.props.defaultSelectedMAHID,trademark_en:t.trademark_en,trademark_ru:t.trademark_ru,agreed_price:t.agreed_price,increased_price:t.increased_price})),{errors:i,handleSubmit:P,resetForm:Y,setErrors:j,meta:K}=X({validationSchema:N,initialValues:{...x.value}}),{values:o}=ee(Object.keys(x.value)),{fields:k,push:z,remove:A}=Z("countries");O(()=>o.status_id,u=>{if(!u){m.value=1;return}m.value=f.props.restrictedStatuses.find(r=>r.id==u).general_status.stage}),O(()=>o.country_ids,(u=[])=>{for(const r of u)k.value.some(G=>G.value.country_id===r)||z({country_id:r,forecast_year_1:null,forecast_year_2:null,forecast_year_3:null});for(let r=k.value.length-1;r>=0;r--){const a=k.value[r].value.country_id;u.includes(a)||A(r)}},{deep:!0,immediate:!0});const Q=P(u=>{w.value=!0,ne(u,["created_at"]);const r=M(u);W.post(route("mad.processes.store"),r).then(()=>{S.addCreatedSuccessfullyMessage(),window.history.back()}).catch(a=>{a.response?.status===422?(j(a.response.data.errors),S.addFixErrorsMessage()):S.addSubmitionFailedMessage()}).finally(()=>{w.value=!1})});return(u,r)=>(y(),b(e(h),{class:"d-flex flex-column ga-6 pb-8",enctype:"multipart/form-data"},{default:s(()=>[l(ae,{product:e(t).product},null,8,["product"]),l(oe,{values:e(o),errors:e(i)},null,8,["values","errors"]),l(V,null,{default:s(()=>[l(C,null,{default:s(()=>[q(E(e(d)("pages.Main")),1)]),_:1}),l(v,null,{default:s(()=>[l(_,{cols:"4"},{default:s(()=>[l(c,{label:e(d)("fields.Status"),items:e(f).props.restrictedStatuses,modelValue:e(o).status_id,"onUpdate:modelValue":r[0]||(r[0]=a=>e(o).status_id=a),"error-messages":e(i).status_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(c,{label:e(d)("fields.Search country"),"item-title":"code",items:e(f).props.countriesOrderedByProcessesCount,modelValue:e(o).country_ids,"onUpdate:modelValue":r[1]||(r[1]=a=>e(o).country_ids=a),"error-messages":e(i).country_ids,multiple:"",required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(c,{label:e(d)("fields.Responsible"),items:e(f).props.responsiblePeople,modelValue:e(o).responsible_person_id,"onUpdate:modelValue":r[2]||(r[2]=a=>e(o).responsible_person_id=a),"error-messages":e(i).responsible_person_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(te,{label:e(d)("dates.Historical"),modelValue:e(o).created_at,"onUpdate:modelValue":r[3]||(r[3]=a=>e(o).created_at=a),"error-messages":e(i).created_at},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),l($,null,{default:s(()=>[e(o).country_ids.length?(y(),b(ie,{key:0,fields:e(k),errors:e(i),push:e(z),remove:e(A),statusStage:m.value},null,8,["fields","errors","push","remove","statusStage"])):F("",!0)]),_:1}),l($,null,{default:s(()=>[m.value>=2?(y(),b(V,{key:0},{default:s(()=>[l(C,null,{default:s(()=>[...r[24]||(r[24]=[q("2ПО",-1)])]),_:1}),l(v,null,{default:s(()=>[l(_,{cols:"4"},{default:s(()=>[l(p,{label:e(d)("fields.Down payment 1"),modelValue:e(o).down_payment_1,"onUpdate:modelValue":r[4]||(r[4]=a=>e(o).down_payment_1=a),"error-messages":e(i).down_payment_1},null,8,["label","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(p,{label:e(d)("fields.Down payment 2"),modelValue:e(o).down_payment_2,"onUpdate:modelValue":r[5]||(r[5]=a=>e(o).down_payment_2=a),"error-messages":e(i).down_payment_2},null,8,["label","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(p,{label:e(d)("fields.Down payment condition"),modelValue:e(o).down_payment_condition,"onUpdate:modelValue":r[6]||(r[6]=a=>e(o).down_payment_condition=a),"error-messages":e(i).down_payment_condition},null,8,["label","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(p,{label:e(d)("fields.Dossier status"),modelValue:e(o).dossier_status,"onUpdate:modelValue":r[7]||(r[7]=a=>e(o).dossier_status=a),"error-messages":e(i).dossier_status},null,8,["label","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(p,{label:e(d)("fields.Year Cr/Be"),modelValue:e(o).clinical_trial_year,"onUpdate:modelValue":r[8]||(r[8]=a=>e(o).clinical_trial_year=a),"error-messages":e(i).clinical_trial_year},null,8,["label","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(c,{label:e(d)("fields.Countries Cr/Be"),items:e(f).props.countriesOrderedByName,modelValue:e(o).clinical_trial_country_ids,"onUpdate:modelValue":r[9]||(r[9]=a=>e(o).clinical_trial_country_ids=a),"error-messages":e(i).clinical_trial_country_ids,multiple:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(p,{label:e(d)("fields.Country ich"),modelValue:e(o).clinical_trial_ich_country,"onUpdate:modelValue":r[10]||(r[10]=a=>e(o).clinical_trial_ich_country=a),"error-messages":e(i).clinical_trial_ich_country},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1})):F("",!0)]),_:1}),l($,null,{default:s(()=>[m.value>=3?(y(),b(V,{key:0},{default:s(()=>[l(C,null,{default:s(()=>[...r[25]||(r[25]=[q("3АЦ",-1)])]),_:1}),l(v,null,{default:s(()=>[l(_,{cols:"4"},{default:s(()=>[l(g,{label:e(d)("fields.Manufacturer price 1"),modelValue:e(o).manufacturer_first_offered_price,"onUpdate:modelValue":r[11]||(r[11]=a=>e(o).manufacturer_first_offered_price=a),"error-messages":e(i).manufacturer_first_offered_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(g,{label:e(d)("fields.Manufacturer price 2"),modelValue:e(o).manufacturer_followed_offered_price,"onUpdate:modelValue":r[12]||(r[12]=a=>e(o).manufacturer_followed_offered_price=a),"error-messages":e(i).manufacturer_followed_offered_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(c,{label:e(d)("fields.Currency"),items:e(f).props.currencies,modelValue:e(o).currency_id,"onUpdate:modelValue":r[13]||(r[13]=a=>e(o).currency_id=a),"error-messages":e(i).currency_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(g,{label:e(d)("fields.Our price 1"),modelValue:e(o).our_first_offered_price,"onUpdate:modelValue":r[14]||(r[14]=a=>e(o).our_first_offered_price=a),"error-messages":e(i).our_first_offered_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(g,{label:e(d)("fields.Our price 2"),modelValue:e(o).our_followed_offered_price,"onUpdate:modelValue":r[15]||(r[15]=a=>e(o).our_followed_offered_price=a),"error-messages":e(i).our_followed_offered_price,min:0,precision:2,step:.01},null,8,["label","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(c,{label:e(d)("fields.MAH"),items:e(f).props.MAHs,modelValue:e(o).marketing_authorization_holder_id,"onUpdate:modelValue":r[16]||(r[16]=a=>e(o).marketing_authorization_holder_id=a),"error-messages":e(i).marketing_authorization_holder_id,required:m.value>=5},null,8,["label","items","modelValue","error-messages","required"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(p,{label:e(d)("fields.TM Eng"),modelValue:e(o).trademark_en,"onUpdate:modelValue":r[17]||(r[17]=a=>e(o).trademark_en=a),"error-messages":e(i).trademark_en,required:m.value>=5},null,8,["label","modelValue","error-messages","required"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(p,{label:e(d)("fields.TM Rus"),modelValue:e(o).trademark_ru,"onUpdate:modelValue":r[18]||(r[18]=a=>e(o).trademark_ru=a),"error-messages":e(i).trademark_ru,required:m.value>=5},null,8,["label","modelValue","error-messages","required"])]),_:1})]),_:1})]),_:1})):F("",!0)]),_:1}),l($,null,{default:s(()=>[m.value>=4?(y(),b(V,{key:0},{default:s(()=>[l(C,null,{default:s(()=>[...r[26]||(r[26]=[q("4СЦ",-1)])]),_:1}),l(v,null,{default:s(()=>[l(_,{cols:"4"},{default:s(()=>[l(g,{label:e(d)("fields.Agreed price"),modelValue:e(o).agreed_price,"onUpdate:modelValue":r[19]||(r[19]=a=>e(o).agreed_price=a),"error-messages":e(i).agreed_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(g,{label:e(d)("fields.Increased price"),modelValue:e(o).increased_price,"onUpdate:modelValue":r[20]||(r[20]=a=>e(o).increased_price=a),"error-messages":e(i).increased_price,min:0,precision:2,step:.01},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1})):F("",!0)]),_:1}),l(V,null,{default:s(()=>[l(v,null,{default:s(()=>[l(_,{cols:"12"},{default:s(()=>[l(se,{modelValue:e(o).comment,"onUpdate:modelValue":r[21]||(r[21]=a=>e(o).comment=a),label:e(d)("Comment"),folder:"comments"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),l(de,null,{default:s(()=>[l(ue,{onClick:r[22]||(r[22]=a=>e(Y)()),loading:w.value},null,8,["loading"]),l(fe,{onClick:r[23]||(r[23]=a=>e(Q)()),loading:w.value,disabled:!e(K).valid},null,8,["loading","disabled"])]),_:1})]),_:1}))}};export{Pe as default};
