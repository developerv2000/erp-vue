import{u as R,c as y,o as b,w as s,g as w,t as H,b as e,d as J,h as A,s as T,y as S,v as I,z as _,cT as L,x as U,S as O,B as W,a as l,cU as $,k as C}from"./app-DFGAykv1.js";import{u as X,b as Z,F as h}from"./vee-validate-bwBYQxrX.js";import{u as ee}from"./useVeeFormFields-BYBd5kGd.js";import{u as re}from"./useFormData-CgBSWld4.js";import{u as le}from"./messages-DM6Hzgr9.js";import{D as V}from"./DefaultSheet-dw4Mk5Bv.js";import{_ as F}from"./DefaultTitle-CJn9DB1m.js";import ae from"./AboutProduct-CCFBLPjV.js";import oe from"./ProcessesEditProductBlock-DpPgQCG0.js";import{_ as p}from"./DefaultTextField-C7s22ckC.js";import{_ as c}from"./DefaultAutocomplete-D2AwreME.js";import{_ as se}from"./DefaultWysiwyg-ChN-Wu_1.js";import{_ as te}from"./DefaultDateInput-CKsnSWej.js";import{_ as g}from"./DefaultNumberInput-BlxvA38l.js";import{F as de}from"./FormActionsContainer-DhN9f8m4.js";import{_ as ie}from"./FormResetButton-eM4AfET6.js";import ue from"./ProcessesCreateCountriesBlock-BdHE4WTs.js";import{r as ne}from"./queryHelper-zuYrvkeK.js";import{_ as _e}from"./DefaultButton-BwBxuaXS.js";import{C as me}from"./mdi-_GS73Yti.js";import{V as v,a as n}from"./VRow-DeYYAS09.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VTable-rJPrYe08.js";import"./utilities-BOpNCN-e.js";import"./StandardLabeledGroup-DZwc3k__.js";import"./filter-DJBblzN3.js";import"./WrappedLabelGroup-uY5caKSu.js";import"./VNumberInput-_J9CdEh5.js";const fe={__name:"FormDuplicateAndRedirectBack",setup(N){const{t:d}=R();return(x,f)=>(b(),y(_e,{color:"success","prepend-icon":e(me)},{default:s(()=>[w(H(e(d)("actions.Duplicate and redirect back")),1)]),_:1},8,["prepend-icon"]))}},Ee={__name:"ProcessesDuplicateForm",setup(N){const{t:d}=R(),{objectToFormData:x}=re(),f=J(),D=le(),q=A(!1),t=f.props.record,m=A(t.status.general_status.stage),P=T(()=>{const i={product_id:_().required(),product_form_id:_().required(),product_shelf_life_id:_().required(),product_class_id:_().required(),product_moq:_().nullable(),status_id:_().required(),country_ids:S().required().min(1),responsible_person_id:_().required(),created_at:L().nullable(),countries:S().of(I({country_id:_().required(),forecast_year_1:_().required(),forecast_year_2:_().required(),forecast_year_3:_().required()}))};return m.value>=2&&(i.clinical_trial_country_ids=S()),m.value>=3&&(i.manufacturer_first_offered_price=_().required(),i.manufacturer_followed_offered_price=_().nullable(),i.currency_id=_().required(),i.our_first_offered_price=_().required(),i.our_followed_offered_price=_().nullable(),i.marketing_authorization_holder_id=m.value>=5?_().required():_().nullable(),i.trademark_en=m.value>=5?U().required():U().nullable(),i.trademark_ru=m.value>=5?U().required():U().nullable()),m.value>=4&&(i.agreed_price=_().required(),i.increased_price=_().nullable()),I(i)}),M=T(()=>({product_id:t.product_id,product_form_id:t.product.form_id,product_dosage:t.product.dosage,product_pack:t.product.pack,product_shelf_life_id:t.product.shelf_life_id,product_class_id:t.product.class_id,product_moq:t.product.moq,status_id:t.status_id,country_ids:[],responsible_person_id:t.responsible_person_id,created_at:null,countries:[],comment:null,down_payment_1:t.down_payment_1,down_payment_2:t.down_payment_2,down_payment_condition:t.down_payment_condition,dossier_status:t.dossier_status,clinical_trial_year:t.clinical_trial_year,clinical_trial_country_ids:t.clinical_trial_countries.map(i=>i.id),clinical_trial_ich_country:t.clinical_trial_ich_country,manufacturer_first_offered_price:t.manufacturer_first_offered_price,manufacturer_followed_offered_price:t.manufacturer_followed_offered_price,currency_id:t.currency_id??f.props.defaultSelectedCurrencyID,our_first_offered_price:t.our_first_offered_price,our_followed_offered_price:t.our_followed_offered_price,marketing_authorization_holder_id:t.marketing_authorization_holder_id??f.props.defaultSelectedMAHID,trademark_en:t.trademark_en,trademark_ru:t.trademark_ru,agreed_price:t.agreed_price,increased_price:t.increased_price})),{errors:u,handleSubmit:E,resetForm:j,setErrors:Y,meta:K}=X({validationSchema:P,initialValues:{...M.value}}),{values:o}=ee(Object.keys(M.value)),{fields:k,push:z,remove:B}=Z("countries");O(()=>o.status_id,i=>{if(!i){m.value=1;return}m.value=f.props.restrictedStatuses.find(r=>r.id==i).general_status.stage}),O(()=>o.country_ids,(i=[])=>{for(const r of i)k.value.some(G=>G.value.country_id===r)||z({country_id:r,forecast_year_1:null,forecast_year_2:null,forecast_year_3:null});for(let r=k.value.length-1;r>=0;r--){const a=k.value[r].value.country_id;i.includes(a)||B(r)}},{deep:!0,immediate:!0});const Q=E(i=>{q.value=!0,ne(i,["created_at"]);const r=x(i);W.post(route("mad.processes.store"),r).then(()=>{D.addCreatedSuccessfullyMessage(),window.history.back()}).catch(a=>{a.response?.status===422?(Y(a.response.data.errors),D.addFixErrorsMessage()):D.addSubmitionFailedMessage()}).finally(()=>{q.value=!1})});return(i,r)=>(b(),y(e(h),{class:"d-flex flex-column ga-6 pb-8",enctype:"multipart/form-data"},{default:s(()=>[l(ae,{product:e(t).product},null,8,["product"]),l(oe,{values:e(o),errors:e(u)},null,8,["values","errors"]),l(V,null,{default:s(()=>[l(F,null,{default:s(()=>[w(H(e(d)("pages.Main")),1)]),_:1}),l(v,null,{default:s(()=>[l(n,{cols:"4"},{default:s(()=>[l(c,{label:e(d)("fields.Status"),items:e(f).props.restrictedStatuses,modelValue:e(o).status_id,"onUpdate:modelValue":r[0]||(r[0]=a=>e(o).status_id=a),"error-messages":e(u).status_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),l(n,{cols:"4"},{default:s(()=>[l(c,{label:e(d)("fields.Search country"),"item-title":"code",items:e(f).props.countriesOrderedByProcessesCount,modelValue:e(o).country_ids,"onUpdate:modelValue":r[1]||(r[1]=a=>e(o).country_ids=a),"error-messages":e(u).country_ids,multiple:"",required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),l(n,{cols:"4"},{default:s(()=>[l(c,{label:e(d)("fields.Responsible"),items:e(f).props.responsiblePeople,modelValue:e(o).responsible_person_id,"onUpdate:modelValue":r[2]||(r[2]=a=>e(o).responsible_person_id=a),"error-messages":e(u).responsible_person_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),l(n,{cols:"4"},{default:s(()=>[l(te,{label:e(d)("dates.Historical"),modelValue:e(o).created_at,"onUpdate:modelValue":r[3]||(r[3]=a=>e(o).created_at=a),"error-messages":e(u).created_at},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),l($,null,{default:s(()=>[e(o).country_ids.length?(b(),y(ue,{key:0,fields:e(k),errors:e(u),push:e(z),remove:e(B)},null,8,["fields","errors","push","remove"])):C("",!0)]),_:1}),l($,null,{default:s(()=>[m.value>=2?(b(),y(V,{key:0},{default:s(()=>[l(F,null,{default:s(()=>[...r[24]||(r[24]=[w("2ПО",-1)])]),_:1}),l(v,null,{default:s(()=>[l(n,{cols:"4"},{default:s(()=>[l(p,{label:e(d)("fields.Down payment 1"),modelValue:e(o).down_payment_1,"onUpdate:modelValue":r[4]||(r[4]=a=>e(o).down_payment_1=a),"error-messages":e(u).down_payment_1},null,8,["label","modelValue","error-messages"])]),_:1}),l(n,{cols:"4"},{default:s(()=>[l(p,{label:e(d)("fields.Down payment 2"),modelValue:e(o).down_payment_2,"onUpdate:modelValue":r[5]||(r[5]=a=>e(o).down_payment_2=a),"error-messages":e(u).down_payment_2},null,8,["label","modelValue","error-messages"])]),_:1}),l(n,{cols:"4"},{default:s(()=>[l(p,{label:e(d)("fields.Down payment condition"),modelValue:e(o).down_payment_condition,"onUpdate:modelValue":r[6]||(r[6]=a=>e(o).down_payment_condition=a),"error-messages":e(u).down_payment_condition},null,8,["label","modelValue","error-messages"])]),_:1}),l(n,{cols:"4"},{default:s(()=>[l(p,{label:e(d)("fields.Dossier status"),modelValue:e(o).dossier_status,"onUpdate:modelValue":r[7]||(r[7]=a=>e(o).dossier_status=a),"error-messages":e(u).dossier_status},null,8,["label","modelValue","error-messages"])]),_:1}),l(n,{cols:"4"},{default:s(()=>[l(p,{label:e(d)("fields.Year Cr/Be"),modelValue:e(o).clinical_trial_year,"onUpdate:modelValue":r[8]||(r[8]=a=>e(o).clinical_trial_year=a),"error-messages":e(u).clinical_trial_year},null,8,["label","modelValue","error-messages"])]),_:1}),l(n,{cols:"4"},{default:s(()=>[l(c,{label:e(d)("fields.Countries Cr/Be"),items:e(f).props.countriesOrderedByName,modelValue:e(o).clinical_trial_country_ids,"onUpdate:modelValue":r[9]||(r[9]=a=>e(o).clinical_trial_country_ids=a),"error-messages":e(u).clinical_trial_country_ids,multiple:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),l(n,{cols:"4"},{default:s(()=>[l(p,{label:e(d)("fields.Country ich"),modelValue:e(o).clinical_trial_ich_country,"onUpdate:modelValue":r[10]||(r[10]=a=>e(o).clinical_trial_ich_country=a),"error-messages":e(u).clinical_trial_ich_country},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1})):C("",!0)]),_:1}),l($,null,{default:s(()=>[m.value>=3?(b(),y(V,{key:0},{default:s(()=>[l(F,null,{default:s(()=>[...r[25]||(r[25]=[w("3АЦ",-1)])]),_:1}),l(v,null,{default:s(()=>[l(n,{cols:"4"},{default:s(()=>[l(g,{label:e(d)("fields.Manufacturer price 1"),modelValue:e(o).manufacturer_first_offered_price,"onUpdate:modelValue":r[11]||(r[11]=a=>e(o).manufacturer_first_offered_price=a),"error-messages":e(u).manufacturer_first_offered_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),l(n,{cols:"4"},{default:s(()=>[l(g,{label:e(d)("fields.Manufacturer price 2"),modelValue:e(o).manufacturer_followed_offered_price,"onUpdate:modelValue":r[12]||(r[12]=a=>e(o).manufacturer_followed_offered_price=a),"error-messages":e(u).manufacturer_followed_offered_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),l(n,{cols:"4"},{default:s(()=>[l(c,{label:e(d)("fields.Currency"),items:e(f).props.currencies,modelValue:e(o).currency_id,"onUpdate:modelValue":r[13]||(r[13]=a=>e(o).currency_id=a),"error-messages":e(u).currency_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),l(n,{cols:"4"},{default:s(()=>[l(g,{label:e(d)("fields.Our price 1"),modelValue:e(o).our_first_offered_price,"onUpdate:modelValue":r[14]||(r[14]=a=>e(o).our_first_offered_price=a),"error-messages":e(u).our_first_offered_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),l(n,{cols:"4"},{default:s(()=>[l(g,{label:e(d)("fields.Our price 2"),modelValue:e(o).our_followed_offered_price,"onUpdate:modelValue":r[15]||(r[15]=a=>e(o).our_followed_offered_price=a),"error-messages":e(u).our_followed_offered_price,min:0,precision:2,step:.01},null,8,["label","modelValue","error-messages"])]),_:1}),l(n,{cols:"4"},{default:s(()=>[l(c,{label:e(d)("fields.MAH"),items:e(f).props.MAHs,modelValue:e(o).marketing_authorization_holder_id,"onUpdate:modelValue":r[16]||(r[16]=a=>e(o).marketing_authorization_holder_id=a),"error-messages":e(u).marketing_authorization_holder_id,required:m.value>=5},null,8,["label","items","modelValue","error-messages","required"])]),_:1}),l(n,{cols:"4"},{default:s(()=>[l(p,{label:e(d)("fields.TM Eng"),modelValue:e(o).trademark_en,"onUpdate:modelValue":r[17]||(r[17]=a=>e(o).trademark_en=a),"error-messages":e(u).trademark_en,required:m.value>=5},null,8,["label","modelValue","error-messages","required"])]),_:1}),l(n,{cols:"4"},{default:s(()=>[l(p,{label:e(d)("fields.TM Rus"),modelValue:e(o).trademark_ru,"onUpdate:modelValue":r[18]||(r[18]=a=>e(o).trademark_ru=a),"error-messages":e(u).trademark_ru,required:m.value>=5},null,8,["label","modelValue","error-messages","required"])]),_:1})]),_:1})]),_:1})):C("",!0)]),_:1}),l($,null,{default:s(()=>[m.value>=4?(b(),y(V,{key:0},{default:s(()=>[l(F,null,{default:s(()=>[...r[26]||(r[26]=[w("4СЦ",-1)])]),_:1}),l(v,null,{default:s(()=>[l(n,{cols:"4"},{default:s(()=>[l(g,{label:e(d)("fields.Agreed price"),modelValue:e(o).agreed_price,"onUpdate:modelValue":r[19]||(r[19]=a=>e(o).agreed_price=a),"error-messages":e(u).agreed_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),l(n,{cols:"4"},{default:s(()=>[l(g,{label:e(d)("fields.Increased price"),modelValue:e(o).increased_price,"onUpdate:modelValue":r[20]||(r[20]=a=>e(o).increased_price=a),"error-messages":e(u).increased_price,min:0,precision:2,step:.01},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1})):C("",!0)]),_:1}),l(V,null,{default:s(()=>[l(v,null,{default:s(()=>[l(n,{cols:"12"},{default:s(()=>[l(se,{modelValue:e(o).comment,"onUpdate:modelValue":r[21]||(r[21]=a=>e(o).comment=a),label:e(d)("Comment"),folder:"comments"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),l(de,null,{default:s(()=>[l(ie,{onClick:r[22]||(r[22]=a=>e(j)()),loading:q.value},null,8,["loading"]),l(fe,{onClick:r[23]||(r[23]=a=>e(Q)()),loading:q.value,disabled:!e(K).valid},null,8,["loading","disabled"])]),_:1})]),_:1}))}};export{Ee as default};
