import{u as O,c as b,o as y,w as s,g as q,t as R,b as e,d as Q,h as B,l as T,p as S,m as I,q as n,D as W,n as U,J as N,v as X,a as l,dc as F,k as D}from"./app-Bv235s-M.js";import{u as Z,b as h,F as ee}from"./vee-validate-B-1CKIak.js";import{u as re}from"./useVeeFormFields-J-_CRR1z.js";import{u as le}from"./useFormData-DEk4Ge6e.js";import{u as ae}from"./messages-CrCj1jht.js";import{u as oe}from"./useDateFormatter-cYKpR2k9.js";import{D as V}from"./DefaultSheet-kIGXXLen.js";import{_ as $}from"./DefaultTitle-BFXSLasM.js";import se from"./AboutProduct-b56Wbe_Y.js";import te from"./ProcessesEditProductBlock-QYnq6Dj1.js";import{_ as p}from"./DefaultTextField-DEo4xlzs.js";import{_ as c}from"./DefaultAutocomplete-TUcT7G3v.js";import{_ as ue}from"./DefaultWysiwyg-4IHBiKGV.js";import{_ as de}from"./DefaultDateInput-Bd8T_AhU.js";import{_ as g}from"./DefaultNumberInput-RkEgRrqI.js";import{F as ie}from"./FormActionsContainer-Bg-aVW1K.js";import{_ as ne}from"./FormResetButton-B0o_1JkG.js";import _e from"./ProcessesCreateCountriesBlock-PGl3RS5u.js";import{_ as me}from"./DefaultButton-DBGLuZMW.js";import{N as fe}from"./mdi-CnKAdudM.js";import{V as v,a as _}from"./VRow-DQpkIAa1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VTable-gLoNSE0h.js";import"./utilities-BOpNCN-e.js";import"./StandardLabeledGroup-DHmFV98J.js";import"./filter-ELhmIoIq.js";import"./WrappedLabelGroup-Cjr3GLjY.js";import"./VNumberInput-CfdQXUlt.js";const pe={__name:"FormDuplicateAndRedirectBack",setup(H){const{t:u}=O();return(M,f)=>(y(),b(me,{color:"success","prepend-icon":e(fe)},{default:s(()=>[q(R(e(u)("actions.Duplicate and redirect back")),1)]),_:1},8,["prepend-icon"]))}},je={__name:"ProcessesDuplicateForm",setup(H){const{t:u}=O(),{objectToFormData:M}=le(),f=Q(),C=ae(),{removeDateTimezonesFromFormData:P}=oe(),w=B(!1),t=f.props.record,m=B(t.status.general_status.stage),E=T(()=>{const i={product_id:n().required(),product_form_id:n().required(),product_shelf_life_id:n().required(),product_class_id:n().required(),product_moq:n().nullable(),status_id:n().required(),country_ids:S().required().min(1),responsible_person_id:n().required(),created_at:W().nullable(),countries:S().of(I({country_id:n().required(),forecast_year_1:m.value>=2?n().required():n().nullable(),forecast_year_2:m.value>=2?n().required():n().nullable(),forecast_year_3:m.value>=2?n().required():n().nullable()}))};return m.value>=2&&(i.clinical_trial_country_ids=S()),m.value>=3&&(i.manufacturer_first_offered_price=n().required(),i.manufacturer_followed_offered_price=n().nullable(),i.currency_id=n().required(),i.our_first_offered_price=n().required(),i.our_followed_offered_price=n().nullable(),i.marketing_authorization_holder_id=m.value>=5?n().required():n().nullable(),i.trademark_en=m.value>=5?U().required():U().nullable(),i.trademark_ru=m.value>=5?U().required():U().nullable()),m.value>=4&&(i.agreed_price=n().required(),i.increased_price=n().nullable()),I(i)}),x=T(()=>({product_id:t.product_id,product_form_id:t.product.form_id,product_dosage:t.product.dosage,product_pack:t.product.pack,product_shelf_life_id:t.product.shelf_life_id,product_class_id:t.product.class_id,product_moq:t.product.moq,status_id:t.status_id,country_ids:[],responsible_person_id:t.responsible_person_id,created_at:null,countries:[],comment:null,down_payment_1:t.down_payment_1,down_payment_2:t.down_payment_2,down_payment_condition:t.down_payment_condition,dossier_status:t.dossier_status,clinical_trial_year:t.clinical_trial_year,clinical_trial_country_ids:t.clinical_trial_countries.map(i=>i.id),clinical_trial_ich_country:t.clinical_trial_ich_country,manufacturer_first_offered_price:t.manufacturer_first_offered_price,manufacturer_followed_offered_price:t.manufacturer_followed_offered_price,currency_id:t.currency_id??f.props.defaultSelectedCurrencyID,our_first_offered_price:t.our_first_offered_price,our_followed_offered_price:t.our_followed_offered_price,marketing_authorization_holder_id:t.marketing_authorization_holder_id??f.props.defaultSelectedMAHID,trademark_en:t.trademark_en,trademark_ru:t.trademark_ru,agreed_price:t.agreed_price,increased_price:t.increased_price})),{errors:d,handleSubmit:j,resetForm:Y,setErrors:J,meta:K}=Z({validationSchema:E,initialValues:{...x.value}}),{values:o}=re(Object.keys(x.value)),{fields:k,push:z,remove:A}=h("countries");N(()=>o.status_id,i=>{if(!i){m.value=1;return}m.value=f.props.restrictedStatuses.find(r=>r.id==i).general_status.stage}),N(()=>o.country_ids,(i=[])=>{for(const r of i)k.value.some(L=>L.value.country_id===r)||z({country_id:r,forecast_year_1:null,forecast_year_2:null,forecast_year_3:null});for(let r=k.value.length-1;r>=0;r--){const a=k.value[r].value.country_id;i.includes(a)||A(r)}},{deep:!0,immediate:!0});const G=j(i=>{const r=M(i);P(r),w.value=!0,X.post(route("mad.processes.store"),r).then(()=>{C.addCreatedSuccessfullyMessage(),window.history.back()}).catch(a=>{a.response?.status===422?(J(a.response.data.errors),C.addFixErrorsMessage()):C.addSubmitionFailedMessage()}).finally(()=>{w.value=!1})});return(i,r)=>(y(),b(e(ee),{class:"d-flex flex-column ga-6 pb-8",enctype:"multipart/form-data"},{default:s(()=>[l(se,{product:e(t).product},null,8,["product"]),l(te,{values:e(o),errors:e(d)},null,8,["values","errors"]),l(V,null,{default:s(()=>[l($,null,{default:s(()=>[q(R(e(u)("pages.Main")),1)]),_:1}),l(v,null,{default:s(()=>[l(_,{cols:"4"},{default:s(()=>[l(c,{label:e(u)("fields.Status"),items:e(f).props.restrictedStatuses,modelValue:e(o).status_id,"onUpdate:modelValue":r[0]||(r[0]=a=>e(o).status_id=a),"error-messages":e(d).status_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(c,{label:e(u)("fields.Search country"),"item-title":"code",items:e(f).props.countriesOrderedByProcessesCount,modelValue:e(o).country_ids,"onUpdate:modelValue":r[1]||(r[1]=a=>e(o).country_ids=a),"error-messages":e(d).country_ids,multiple:"",required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(c,{label:e(u)("fields.Responsible"),items:e(f).props.responsiblePeople,modelValue:e(o).responsible_person_id,"onUpdate:modelValue":r[2]||(r[2]=a=>e(o).responsible_person_id=a),"error-messages":e(d).responsible_person_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(de,{label:e(u)("dates.Historical"),modelValue:e(o).created_at,"onUpdate:modelValue":r[3]||(r[3]=a=>e(o).created_at=a),"error-messages":e(d).created_at},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),l(F,null,{default:s(()=>[e(o).country_ids.length?(y(),b(_e,{key:0,fields:e(k),errors:e(d),push:e(z),remove:e(A),statusStage:m.value},null,8,["fields","errors","push","remove","statusStage"])):D("",!0)]),_:1}),l(F,null,{default:s(()=>[m.value>=2?(y(),b(V,{key:0},{default:s(()=>[l($,null,{default:s(()=>[...r[24]||(r[24]=[q("2ПО",-1)])]),_:1}),l(v,null,{default:s(()=>[l(_,{cols:"4"},{default:s(()=>[l(p,{label:e(u)("fields.Down payment 1"),modelValue:e(o).down_payment_1,"onUpdate:modelValue":r[4]||(r[4]=a=>e(o).down_payment_1=a),"error-messages":e(d).down_payment_1},null,8,["label","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(p,{label:e(u)("fields.Down payment 2"),modelValue:e(o).down_payment_2,"onUpdate:modelValue":r[5]||(r[5]=a=>e(o).down_payment_2=a),"error-messages":e(d).down_payment_2},null,8,["label","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(p,{label:e(u)("fields.Down payment condition"),modelValue:e(o).down_payment_condition,"onUpdate:modelValue":r[6]||(r[6]=a=>e(o).down_payment_condition=a),"error-messages":e(d).down_payment_condition},null,8,["label","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(p,{label:e(u)("fields.Dossier status"),modelValue:e(o).dossier_status,"onUpdate:modelValue":r[7]||(r[7]=a=>e(o).dossier_status=a),"error-messages":e(d).dossier_status},null,8,["label","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(p,{label:e(u)("fields.Year Cr/Be"),modelValue:e(o).clinical_trial_year,"onUpdate:modelValue":r[8]||(r[8]=a=>e(o).clinical_trial_year=a),"error-messages":e(d).clinical_trial_year},null,8,["label","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(c,{label:e(u)("fields.Countries Cr/Be"),items:e(f).props.countriesOrderedByName,modelValue:e(o).clinical_trial_country_ids,"onUpdate:modelValue":r[9]||(r[9]=a=>e(o).clinical_trial_country_ids=a),"error-messages":e(d).clinical_trial_country_ids,multiple:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(p,{label:e(u)("fields.Country ich"),modelValue:e(o).clinical_trial_ich_country,"onUpdate:modelValue":r[10]||(r[10]=a=>e(o).clinical_trial_ich_country=a),"error-messages":e(d).clinical_trial_ich_country},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1})):D("",!0)]),_:1}),l(F,null,{default:s(()=>[m.value>=3?(y(),b(V,{key:0},{default:s(()=>[l($,null,{default:s(()=>[...r[25]||(r[25]=[q("3АЦ",-1)])]),_:1}),l(v,null,{default:s(()=>[l(_,{cols:"4"},{default:s(()=>[l(g,{label:e(u)("fields.Manufacturer price 1"),modelValue:e(o).manufacturer_first_offered_price,"onUpdate:modelValue":r[11]||(r[11]=a=>e(o).manufacturer_first_offered_price=a),"error-messages":e(d).manufacturer_first_offered_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(g,{label:e(u)("fields.Manufacturer price 2"),modelValue:e(o).manufacturer_followed_offered_price,"onUpdate:modelValue":r[12]||(r[12]=a=>e(o).manufacturer_followed_offered_price=a),"error-messages":e(d).manufacturer_followed_offered_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(c,{label:e(u)("fields.Currency"),items:e(f).props.currencies,modelValue:e(o).currency_id,"onUpdate:modelValue":r[13]||(r[13]=a=>e(o).currency_id=a),"error-messages":e(d).currency_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(g,{label:e(u)("fields.Our price 1"),modelValue:e(o).our_first_offered_price,"onUpdate:modelValue":r[14]||(r[14]=a=>e(o).our_first_offered_price=a),"error-messages":e(d).our_first_offered_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(g,{label:e(u)("fields.Our price 2"),modelValue:e(o).our_followed_offered_price,"onUpdate:modelValue":r[15]||(r[15]=a=>e(o).our_followed_offered_price=a),"error-messages":e(d).our_followed_offered_price,min:0,precision:2,step:.01},null,8,["label","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(c,{label:e(u)("fields.MAH"),items:e(f).props.MAHs,modelValue:e(o).marketing_authorization_holder_id,"onUpdate:modelValue":r[16]||(r[16]=a=>e(o).marketing_authorization_holder_id=a),"error-messages":e(d).marketing_authorization_holder_id,required:m.value>=5},null,8,["label","items","modelValue","error-messages","required"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(p,{label:e(u)("fields.TM Eng"),modelValue:e(o).trademark_en,"onUpdate:modelValue":r[17]||(r[17]=a=>e(o).trademark_en=a),"error-messages":e(d).trademark_en,required:m.value>=5},null,8,["label","modelValue","error-messages","required"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(p,{label:e(u)("fields.TM Rus"),modelValue:e(o).trademark_ru,"onUpdate:modelValue":r[18]||(r[18]=a=>e(o).trademark_ru=a),"error-messages":e(d).trademark_ru,required:m.value>=5},null,8,["label","modelValue","error-messages","required"])]),_:1})]),_:1})]),_:1})):D("",!0)]),_:1}),l(F,null,{default:s(()=>[m.value>=4?(y(),b(V,{key:0},{default:s(()=>[l($,null,{default:s(()=>[...r[26]||(r[26]=[q("4СЦ",-1)])]),_:1}),l(v,null,{default:s(()=>[l(_,{cols:"4"},{default:s(()=>[l(g,{label:e(u)("fields.Agreed price"),modelValue:e(o).agreed_price,"onUpdate:modelValue":r[19]||(r[19]=a=>e(o).agreed_price=a),"error-messages":e(d).agreed_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),l(_,{cols:"4"},{default:s(()=>[l(g,{label:e(u)("fields.Increased price"),modelValue:e(o).increased_price,"onUpdate:modelValue":r[20]||(r[20]=a=>e(o).increased_price=a),"error-messages":e(d).increased_price,min:0,precision:2,step:.01},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1})):D("",!0)]),_:1}),l(V,null,{default:s(()=>[l(v,null,{default:s(()=>[l(_,{cols:"12"},{default:s(()=>[l(ue,{modelValue:e(o).comment,"onUpdate:modelValue":r[21]||(r[21]=a=>e(o).comment=a),label:e(u)("Comment"),folder:"comments"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),l(ie,null,{default:s(()=>[l(ne,{onClick:r[22]||(r[22]=a=>e(Y)()),loading:w.value},null,8,["loading"]),l(pe,{onClick:r[23]||(r[23]=a=>e(G)()),loading:w.value,disabled:!e(K).valid},null,8,["loading","disabled"])]),_:1})]),_:1}))}};export{je as default};
