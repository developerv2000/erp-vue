import{u as L,d as G,l as C,h as $,n as b,q as _,p as K,m as Q,J as W,j as X,c as g,o as y,w as s,a as r,b as e,g as U,t as I,db as D,k as S}from"./app-DOf95tBZ.js";import{u as Z,F as h}from"./vee-validate-iGy6L2Et.js";import{u as ee}from"./useVeeFormFields-BgSQN7NI.js";import{u as re}from"./useFormData-DEk4Ge6e.js";import{u as le}from"./messages-CJWGX76Z.js";import{u as ae}from"./useAuth-D6vGxOb_.js";import{D as V}from"./DefaultSheet-Bo28t-lZ.js";import{_ as F}from"./DefaultTitle-B3d09Usl.js";import{_ as c}from"./DefaultTextField-GcET5rA7.js";import{_ as v}from"./DefaultAutocomplete-BJbYhNkf.js";import{_ as T}from"./DefaultWysiwyg-CWkSG_Q_.js";import{_ as p}from"./DefaultNumberInput-ClQn_v_M.js";import{F as oe}from"./FormActionsContainer-Dotk18hQ.js";import{_ as se}from"./FormResetButton-DP-Ysz90.js";import{a as ue,_ as de}from"./FormUpdateWithourRedirect-DwgEvEcO.js";import te from"./AboutProduct-u3bOf30d.js";import ie from"./ProcessesEditProductBlock-BJIwM4Os.js";import{V as q,a as i}from"./VRow-Cy3v7yA0.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./WrappedLabelGroup-CL5wgard.js";import"./StandardLabeledGroup-DUofg0o0.js";import"./filter-DZdboOLp.js";import"./VNumberInput-ykTB3xol.js";import"./DefaultButton-CDvad8-0.js";import"./mdi-BiCQTzTv.js";import"./VTable-SPIWM53q.js";import"./utilities-BOpNCN-e.js";const Ne={__name:"ProcessesEditForm",setup(ne){const{t:d}=L(),{objectToFormData:N}=re(),f=G(),M=le(),{isAnyAdministrator:O}=ae(),u=C(()=>f.props.record),w=$(!1),x=$(!1),k=$(!1),m=$(u.value.status.general_status.stage),E=C(()=>{const n={product_id:_().required(),product_form_id:_().required(),product_shelf_life_id:_().required(),product_class_id:_().required(),product_moq:_().nullable(),status_id:_().required(),country_id:_().required(),responsible_person_id:_().required(),comment:k.value?b().required():b().nullable()};return m.value>=2&&(n.forecast_year_1=_().required(),n.forecast_year_2=_().required(),n.forecast_year_3=_().required(),n.clinical_trial_country_ids=K()),m.value>=3&&(n.manufacturer_first_offered_price=_().required(),n.manufacturer_followed_offered_price=u.value.manufacturer_followed_offered_price?_().required():_().nullable(),n.currency_id=_().required(),n.our_first_offered_price=_().required(),n.our_followed_offered_price=u.value.our_followed_offered_price?_().required():_().nullable(),n.marketing_authorization_holder_id=m.value>=5?_().required():_().nullable(),n.trademark_en=m.value>=5?b().required():b().nullable(),n.trademark_ru=m.value>=5?b().required():b().nullable()),m.value>=4&&(n.agreed_price=_().required(),n.increased_price=_().nullable()),Q(n)}),P=C(()=>({product_id:u.value.product_id,product_form_id:u.value.product.form_id,product_dosage:u.value.product.dosage,product_pack:u.value.product.pack,product_shelf_life_id:u.value.product.shelf_life_id,product_class_id:u.value.product.class_id,product_moq:u.value.product.moq,status_id:u.value.status_id,country_id:u.value.country_id,responsible_person_id:u.value.responsible_person_id,forecast_year_1:u.value.forecast_year_1,forecast_year_2:u.value.forecast_year_2,forecast_year_3:u.value.forecast_year_3,down_payment_1:u.value.down_payment_1,down_payment_2:u.value.down_payment_2,down_payment_condition:u.value.down_payment_condition,dossier_status:u.value.dossier_status,clinical_trial_year:u.value.clinical_trial_year,clinical_trial_country_ids:u.value.clinical_trial_countries.map(n=>n.id),clinical_trial_ich_country:u.value.clinical_trial_ich_country,manufacturer_first_offered_price:u.value.manufacturer_first_offered_price,manufacturer_followed_offered_price:u.value.manufacturer_followed_offered_price,currency_id:u.value.currency_id??f.props.defaultSelectedCurrencyID,our_first_offered_price:u.value.our_first_offered_price,our_followed_offered_price:u.value.our_followed_offered_price,marketing_authorization_holder_id:u.value.marketing_authorization_holder_id??f.props.defaultSelectedMAHID,trademark_en:u.value.trademark_en,trademark_ru:u.value.trademark_ru,agreed_price:u.value.agreed_price,increased_price:u.value.increased_price})),j={comment:null},A=C(()=>({...P.value,...j})),{handleSubmit:H,errors:t,setErrors:Y,resetForm:B,meta:R}=Z({validationSchema:E,initialValues:A.value}),{values:o}=ee(Object.keys(A.value));W(()=>o.status_id,n=>{if(!n){m.value=1,k.value=!1;return}const l=f.props.restrictedStatuses.find(a=>a.id==n);m.value=l.general_status.stage,k.value=!!(l.id!=u.value.status_id&&l.is_stopped_status)});const z=H(n=>{const l=N(n);w.value=!0,axios.post(route("mad.processes.update",{record:u.value.id}),l).then(()=>{M.addUpdatedSuccessfullyMessage(),x.value?window.history.back():J()}).catch(a=>{a.response?.status===422?(Y(a.response.data.errors),M.addFixErrorsMessage()):M.addSubmitionFailedMessage()}).finally(()=>{w.value=!1})}),J=()=>{X.reload({only:["record","breadcrumbs"],onSuccess:()=>{B({values:A.value})}})};return(n,l)=>(y(),g(e(h),{class:"d-flex flex-column ga-6 pb-8",enctype:"multipart/form-data"},{default:s(()=>[r(te,{product:u.value.product},null,8,["product"]),r(ie,{values:e(o),errors:e(t)},null,8,["values","errors"]),r(V,null,{default:s(()=>[r(F,null,{default:s(()=>[U(I(e(d)("pages.Main")),1)]),_:1}),r(q,null,{default:s(()=>[r(i,{cols:"4"},{default:s(()=>[r(v,{label:e(d)("fields.Status"),items:u.value.current_status_can_be_edited_for_auth_user?e(f).props.restrictedStatuses:e(f).props.allStatuses,modelValue:e(o).status_id,"onUpdate:modelValue":l[0]||(l[0]=a=>e(o).status_id=a),"error-messages":e(t).status_id,disabled:!u.value.current_status_can_be_edited_for_auth_user,required:""},null,8,["label","items","modelValue","error-messages","disabled"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(v,{label:e(d)("fields.Search country"),"item-title":"code",items:e(f).props.countriesOrderedByProcessesCount,modelValue:e(o).country_id,"onUpdate:modelValue":l[1]||(l[1]=a=>e(o).country_id=a),"error-messages":e(t).country_id,disabled:u.value.status.general_status.stage>1&&!e(O)(),required:""},null,8,["label","items","modelValue","error-messages","disabled"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(v,{label:e(d)("fields.Responsible"),items:e(f).props.responsiblePeople,modelValue:e(o).responsible_person_id,"onUpdate:modelValue":l[2]||(l[2]=a=>e(o).responsible_person_id=a),"error-messages":e(t).responsible_person_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),r(D,null,{default:s(()=>[m.value>=2?(y(),g(V,{key:0},{default:s(()=>[r(F,null,{default:s(()=>[U(I(e(d)("fields.Forecasts")),1)]),_:1}),r(q,null,{default:s(()=>[r(i,null,{default:s(()=>[r(p,{modelValue:e(o).forecast_year_1,"onUpdate:modelValue":l[3]||(l[3]=a=>e(o).forecast_year_1=a),label:e(d)("fields.Forecast 1 year"),"error-messages":e(t).forecast_year_1,min:0,required:""},null,8,["modelValue","label","error-messages"])]),_:1}),r(i,null,{default:s(()=>[r(p,{modelValue:e(o).forecast_year_2,"onUpdate:modelValue":l[4]||(l[4]=a=>e(o).forecast_year_2=a),label:e(d)("fields.Forecast 2 year"),"error-messages":e(t).forecast_year_2,min:0,required:""},null,8,["modelValue","label","error-messages"])]),_:1}),r(i,null,{default:s(()=>[r(p,{modelValue:e(o).forecast_year_3,"onUpdate:modelValue":l[5]||(l[5]=a=>e(o).forecast_year_3=a),label:e(d)("fields.Forecast 3 year"),"error-messages":e(t).forecast_year_3,min:0,required:""},null,8,["modelValue","label","error-messages"])]),_:1})]),_:1})]),_:1})):S("",!0)]),_:1}),r(D,null,{default:s(()=>[m.value>=2?(y(),g(V,{key:0},{default:s(()=>[r(F,null,{default:s(()=>[...l[27]||(l[27]=[U("2ПО",-1)])]),_:1}),r(q,null,{default:s(()=>[r(i,{cols:"4"},{default:s(()=>[r(c,{label:e(d)("fields.Down payment 1"),modelValue:e(o).down_payment_1,"onUpdate:modelValue":l[6]||(l[6]=a=>e(o).down_payment_1=a),"error-messages":e(t).down_payment_1},null,8,["label","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(c,{label:e(d)("fields.Down payment 2"),modelValue:e(o).down_payment_2,"onUpdate:modelValue":l[7]||(l[7]=a=>e(o).down_payment_2=a),"error-messages":e(t).down_payment_2},null,8,["label","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(c,{label:e(d)("fields.Down payment condition"),modelValue:e(o).down_payment_condition,"onUpdate:modelValue":l[8]||(l[8]=a=>e(o).down_payment_condition=a),"error-messages":e(t).down_payment_condition},null,8,["label","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(c,{label:e(d)("fields.Dossier status"),modelValue:e(o).dossier_status,"onUpdate:modelValue":l[9]||(l[9]=a=>e(o).dossier_status=a),"error-messages":e(t).dossier_status},null,8,["label","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(c,{label:e(d)("fields.Year Cr/Be"),modelValue:e(o).clinical_trial_year,"onUpdate:modelValue":l[10]||(l[10]=a=>e(o).clinical_trial_year=a),"error-messages":e(t).clinical_trial_year},null,8,["label","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(v,{label:e(d)("fields.Countries Cr/Be"),items:e(f).props.countriesOrderedByName,modelValue:e(o).clinical_trial_country_ids,"onUpdate:modelValue":l[11]||(l[11]=a=>e(o).clinical_trial_country_ids=a),"error-messages":e(t).clinical_trial_country_ids,multiple:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(c,{label:e(d)("fields.Country ich"),modelValue:e(o).clinical_trial_ich_country,"onUpdate:modelValue":l[12]||(l[12]=a=>e(o).clinical_trial_ich_country=a),"error-messages":e(t).clinical_trial_ich_country},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1})):S("",!0)]),_:1}),r(D,null,{default:s(()=>[m.value>=3?(y(),g(V,{key:0},{default:s(()=>[r(F,null,{default:s(()=>[...l[28]||(l[28]=[U("3АЦ",-1)])]),_:1}),r(q,null,{default:s(()=>[r(i,{cols:"4"},{default:s(()=>[r(p,{label:e(d)("fields.Manufacturer price 1"),modelValue:e(o).manufacturer_first_offered_price,"onUpdate:modelValue":l[13]||(l[13]=a=>e(o).manufacturer_first_offered_price=a),"error-messages":e(t).manufacturer_first_offered_price,min:0,precision:2,step:.01,disabled:u.value.manufacturer_followed_offered_price!=null,required:""},null,8,["label","modelValue","error-messages","disabled"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(p,{label:e(d)("fields.Manufacturer price 2"),modelValue:e(o).manufacturer_followed_offered_price,"onUpdate:modelValue":l[14]||(l[14]=a=>e(o).manufacturer_followed_offered_price=a),"error-messages":e(t).manufacturer_followed_offered_price,min:0,precision:2,step:.01,required:u.value.manufacturer_followed_offered_price!=null},null,8,["label","modelValue","error-messages","required"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(v,{label:e(d)("fields.Currency"),items:e(f).props.currencies,modelValue:e(o).currency_id,"onUpdate:modelValue":l[15]||(l[15]=a=>e(o).currency_id=a),"error-messages":e(t).currency_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(p,{label:e(d)("fields.Our price 1"),modelValue:e(o).our_first_offered_price,"onUpdate:modelValue":l[16]||(l[16]=a=>e(o).our_first_offered_price=a),"error-messages":e(t).our_first_offered_price,min:0,precision:2,step:.01,disabled:u.value.our_followed_offered_price!=null,required:""},null,8,["label","modelValue","error-messages","disabled"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(p,{label:e(d)("fields.Our price 2"),modelValue:e(o).our_followed_offered_price,"onUpdate:modelValue":l[17]||(l[17]=a=>e(o).our_followed_offered_price=a),"error-messages":e(t).our_followed_offered_price,min:0,precision:2,step:.01,required:u.value.our_followed_offered_price!=null},null,8,["label","modelValue","error-messages","required"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(v,{label:e(d)("fields.MAH"),items:e(f).props.MAHs,modelValue:e(o).marketing_authorization_holder_id,"onUpdate:modelValue":l[18]||(l[18]=a=>e(o).marketing_authorization_holder_id=a),"error-messages":e(t).marketing_authorization_holder_id,required:m.value>=5},null,8,["label","items","modelValue","error-messages","required"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(c,{label:e(d)("fields.TM Eng"),modelValue:e(o).trademark_en,"onUpdate:modelValue":l[19]||(l[19]=a=>e(o).trademark_en=a),"error-messages":e(t).trademark_en,required:m.value>=5},null,8,["label","modelValue","error-messages","required"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(c,{label:e(d)("fields.TM Rus"),modelValue:e(o).trademark_ru,"onUpdate:modelValue":l[20]||(l[20]=a=>e(o).trademark_ru=a),"error-messages":e(t).trademark_ru,required:m.value>=5},null,8,["label","modelValue","error-messages","required"])]),_:1})]),_:1})]),_:1})):S("",!0)]),_:1}),r(D,null,{default:s(()=>[m.value>=4?(y(),g(V,{key:0},{default:s(()=>[r(F,null,{default:s(()=>[...l[29]||(l[29]=[U("4СЦ",-1)])]),_:1}),r(q,null,{default:s(()=>[r(i,{cols:"4"},{default:s(()=>[r(p,{label:e(d)("fields.Agreed price"),modelValue:e(o).agreed_price,"onUpdate:modelValue":l[21]||(l[21]=a=>e(o).agreed_price=a),"error-messages":e(t).agreed_price,min:0,precision:2,step:.01,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),r(i,{cols:"4"},{default:s(()=>[r(p,{label:e(d)("fields.Increased price"),modelValue:e(o).increased_price,"onUpdate:modelValue":l[22]||(l[22]=a=>e(o).increased_price=a),"error-messages":e(t).increased_price,min:0,precision:2,step:.01},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1})):S("",!0)]),_:1}),r(V,null,{default:s(()=>[r(q,null,{default:s(()=>[r(i,null,{default:s(()=>[r(T,{modelValue:e(o).comment,"onUpdate:modelValue":l[23]||(l[23]=a=>e(o).comment=a),label:k.value?e(d)("statuses.Reason for stop"):e(d)("comments.New"),"error-messages":e(t).comment,folder:"comments",required:k.value},null,8,["modelValue","label","error-messages","required"])]),_:1}),u.value.last_comment?(y(),g(i,{key:0},{default:s(()=>[r(T,{modelValue:u.value.last_comment.body,"onUpdate:modelValue":l[24]||(l[24]=a=>u.value.last_comment.body=a),label:e(d)("comments.Last"),disabled:""},null,8,["modelValue","label"])]),_:1})):S("",!0)]),_:1})]),_:1}),r(oe,null,{default:s(()=>[r(se,{onClick:e(B),loading:w.value},null,8,["onClick","loading"]),r(ue,{onClick:l[25]||(l[25]=a=>{x.value=!1,e(z)()}),loading:w.value,disabled:!e(R).valid},null,8,["loading","disabled"]),r(de,{onClick:l[26]||(l[26]=a=>{x.value=!0,e(z)()}),loading:w.value,disabled:!e(R).valid},null,8,["loading","disabled"])]),_:1})]),_:1}))}};export{Ne as default};
