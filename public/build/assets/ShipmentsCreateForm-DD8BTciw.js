import{u as A,d as E,h as V,m as C,p as O,q as n,cP as R,D as v,s as z,v as D,c as G,o as H,w as s,a,g as I,t as J,b as e}from"./app-BQRYHKht.js";import{u as K,b as L,F as Q}from"./vee-validate-DrS_gLnz.js";import{u as W}from"./useVeeFormFields-Dg2HoVj1.js";import{u as X}from"./useFormData-DEk4Ge6e.js";import{u as Y}from"./messages-Cr-leA4g.js";import{u as Z}from"./useDateFormatter-KmwXWHv0.js";import{D as w}from"./DefaultSheet-BK-fqgfD.js";import{_ as h}from"./DefaultTitle-RSaZXzDR.js";import{_ as c}from"./DefaultAutocomplete-BuRqL9PL.js";import{_ as ee}from"./DefaultWysiwyg-x4NvAbOl.js";import{F as le}from"./FormActionsContainer-C3ElCyZ7.js";import{_ as ae}from"./FormResetButton-BmrmXXzN.js";import{_ as re}from"./FormStoreAndRedirectBack-BVYGWQHY.js";import{_ as te}from"./FormStoreAndReset-CRycJE4S.js";import{_ as y}from"./DefaultDateInput-C61eSffF.js";import{_ as se}from"./DefaultFileInput-CdpxiVE6.js";import{_ as q}from"./DefaultNumberInput-uQbTjR1q.js";import{_ as oe}from"./DefaultTextField-DbOR6j_7.js";import ue from"./ShipmentsCreateProductsList-Dj145oun.js";import{V as S,a as u}from"./VRow-pii14n6-.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./StandardLabeledGroup-2MFCue-t.js";import"./filter-3O7ON2dG.js";import"./DefaultButton-_QegtWBB.js";import"./mdi-BZMfrfO1.js";import"./WrappedLabelGroup-BiDUtg_g.js";import"./VNumberInput-Br0mPjnE.js";const je={__name:"ShipmentsCreateForm",setup(ie){const{t:o}=A(),{objectToFormData:x}=X(),_=E(),m=Y(),{removeDateTimezonesFromFormData:M}=Z(),d=V(!1),b=V(!1),g=V(!1),P=C({manufacturer_id:n().required(),packing_list_file:z().required(),transportation_method_id:n().required(),destination_id:n().required(),pallets_quantity:n().nullable(),volume:n().nullable(),transportation_requested_at:v().nullable(),price:n().nullable(),currency_id:n().nullable(),rate_approved_at:v().nullable(),confirmed_at:v().nullable(),products:O().of(C({id:n().required(),checked:R().required(),produced_by_manufacturer_quantity:n().nullable()})).min(1)}),F={manufacturer_id:null,packing_list_file:null,transportation_method_id:null,destination_id:null,pallets_quantity:null,volume:null,transportation_requested_at:null,forwarder:null,price:null,currency_id:null,rate_approved_at:null,confirmed_at:null,comment:null,products:[]},{errors:i,handleSubmit:T,resetForm:$,setErrors:B,meta:k}=K({validationSchema:P,initialValues:{...F}}),{values:t}=W(Object.keys(F)),{fields:N,replace:p}=L("products"),U=T(f=>{const l=x(f);M(l),d.value=!0,D.post(route("import.shipments.store"),l).then(()=>{m.addCreatedSuccessfullyMessage(),g.value&&$(),b.value&&window.history.back()}).catch(r=>{r.response?.status===422?(B(r.response.data.errors),m.addFixErrorsMessage()):m.addSubmitionFailedMessage()}).finally(()=>{d.value=!1})}),j=async f=>{if(!f){p([]);return}d.value=!0;try{const l=await D.get(route("import.shipments.get-ready-without-shipment-from-manufacturer-products",{manufacturer_id:f}));if(!l.data.length){p([]),m.add({text:o("messages.No products found for the given manufacturer"),color:"error"});return}p(l.data.map(r=>({id:r.id,label:r.process.full_english_product_label,checked:!1,produced_by_manufacturer_quantity:null})))}catch{p([]),m.addSubmitionFailedMessage()}finally{d.value=!1}};return(f,l)=>(H(),G(e(Q),{class:"d-flex flex-column ga-6 pb-8",enctype:"multipart/form-data"},{default:s(()=>[a(w,null,{default:s(()=>[a(h,null,{default:s(()=>[I(J(e(o)("Shipment")),1)]),_:1}),a(S,null,{default:s(()=>[a(u,{cols:"4"},{default:s(()=>[a(c,{label:e(o)("fields.Manufacturer"),items:e(_).props.manufacturers,modelValue:e(t).manufacturer_id,"onUpdate:modelValue":[l[0]||(l[0]=r=>e(t).manufacturer_id=r),l[1]||(l[1]=r=>j(r))],"error-messages":e(i).manufacturer_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),a(u,{cols:"4"},{default:s(()=>[a(se,{label:e(o)("fields.Packing list"),modelValue:e(t).packing_list_file,"onUpdate:modelValue":l[2]||(l[2]=r=>e(t).packing_list_file=r),"error-messages":e(i).packing_list_file,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),a(u,{cols:"4"},{default:s(()=>[a(c,{label:e(o)("fields.Transportation method"),items:e(_).props.transportationMethods,modelValue:e(t).transportation_method_id,"onUpdate:modelValue":l[3]||(l[3]=r=>e(t).transportation_method_id=r),"error-messages":e(i).transportation_method_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),a(u,{cols:"4"},{default:s(()=>[a(c,{label:e(o)("fields.Destination"),items:e(_).props.shipmentDestinations,modelValue:e(t).destination_id,"onUpdate:modelValue":l[4]||(l[4]=r=>e(t).destination_id=r),"error-messages":e(i).destination_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),a(u,{cols:"4"},{default:s(()=>[a(c,{label:e(o)("fields.Currency"),items:e(_).props.currencies,modelValue:e(t).currency_id,"onUpdate:modelValue":l[5]||(l[5]=r=>e(t).currency_id=r),"error-messages":e(i).currency_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),a(u,{cols:"4"},{default:s(()=>[a(q,{label:e(o)("fields.Pallets"),modelValue:e(t).pallets_quantity,"onUpdate:modelValue":l[6]||(l[6]=r=>e(t).pallets_quantity=r),"error-messages":e(i).pallets_quantity,min:0},null,8,["label","modelValue","error-messages"])]),_:1}),a(u,{cols:"4"},{default:s(()=>[a(q,{label:e(o)("fields.Volume"),modelValue:e(t).volume,"onUpdate:modelValue":l[7]||(l[7]=r=>e(t).volume=r),"error-messages":e(i).volume,min:0},null,8,["label","modelValue","error-messages"])]),_:1}),a(u,{cols:"4"},{default:s(()=>[a(y,{label:e(o)("dates.Transportation request"),modelValue:e(t).transportation_requested_at,"onUpdate:modelValue":l[8]||(l[8]=r=>e(t).transportation_requested_at=r),"error-messages":e(i).transportation_requested_at},null,8,["label","modelValue","error-messages"])]),_:1}),a(u,{cols:"4"},{default:s(()=>[a(oe,{label:e(o)("fields.Forwarder"),modelValue:e(t).forwarder,"onUpdate:modelValue":l[9]||(l[9]=r=>e(t).forwarder=r)},null,8,["label","modelValue"])]),_:1}),a(u,{cols:"4"},{default:s(()=>[a(q,{label:e(o)("fields.Price"),modelValue:e(t).price,"onUpdate:modelValue":l[10]||(l[10]=r=>e(t).price=r),"error-messages":e(i).price,min:0,precision:2,step:.01},null,8,["label","modelValue","error-messages"])]),_:1}),a(u,{cols:"4"},{default:s(()=>[a(y,{label:e(o)("dates.Rate approved"),modelValue:e(t).rate_approved_at,"onUpdate:modelValue":l[11]||(l[11]=r=>e(t).rate_approved_at=r),"error-messages":e(i).rate_approved_at},null,8,["label","modelValue","error-messages"])]),_:1}),a(u,{cols:"4"},{default:s(()=>[a(y,{label:e(o)("dates.Confirmed"),modelValue:e(t).confirmed_at,"onUpdate:modelValue":l[12]||(l[12]=r=>e(t).confirmed_at=r),"error-messages":e(i).confirmed_at},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),a(ue,{fields:e(N),replace:e(p),errors:e(i)},null,8,["fields","replace","errors"]),a(w,null,{default:s(()=>[a(S,null,{default:s(()=>[a(u,{cols:"12"},{default:s(()=>[a(ee,{modelValue:e(t).comment,"onUpdate:modelValue":l[13]||(l[13]=r=>e(t).comment=r),label:e(o)("Comment"),folder:"comments"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),a(le,null,{default:s(()=>[a(ae,{onClick:e($),loading:d.value},null,8,["onClick","loading"]),a(te,{onClick:l[14]||(l[14]=r=>{g.value=!0,b.value=!1,e(U)()}),loading:d.value,disabled:!e(k).valid},null,8,["loading","disabled"]),a(re,{onClick:l[15]||(l[15]=r=>{g.value=!0,b.value=!0,e(U)()}),loading:d.value,disabled:!e(k).valid},null,8,["loading","disabled"])]),_:1})]),_:1}))}};export{je as default};
