import{u as G,d as H,l as y,h as N,m as P,p as J,q as m,D as q,s as K,j as W,c as F,o as f,w as r,a,g as k,t as U,b as e,f as X,F as Y,r as Z,k as h}from"./app-Bv235s-M.js";import{u as ee,F as ae}from"./vee-validate-B-1CKIak.js";import{u as le}from"./useVeeFormFields-J-_CRR1z.js";import{u as te}from"./useFormData-DEk4Ge6e.js";import{u as re}from"./messages-CrCj1jht.js";import{u as oe}from"./useDateFormatter-cYKpR2k9.js";import{D as $}from"./DefaultSheet-kIGXXLen.js";import{_ as D}from"./DefaultTitle-BFXSLasM.js";import{_ as w}from"./DefaultTextField-DEo4xlzs.js";import{_ as C}from"./DefaultAutocomplete-TUcT7G3v.js";import{_ as R}from"./DefaultWysiwyg-4IHBiKGV.js";import{F as se}from"./FormActionsContainer-Bg-aVW1K.js";import{_ as ue}from"./FormResetButton-B0o_1JkG.js";import{a as de,_ as ne}from"./FormUpdateWithourRedirect-CCYSlGQz.js";import{_ as c}from"./DefaultNumberInput-RkEgRrqI.js";import{_ as me}from"./DefaultFileInput-DBvx7X94.js";import{_ as S}from"./DefaultDateInput-Bd8T_AhU.js";import{V as x,a as d}from"./VRow-DQpkIAa1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./WrappedLabelGroup-Cjr3GLjY.js";import"./StandardLabeledGroup-DHmFV98J.js";import"./filter-ELhmIoIq.js";import"./DefaultButton-DBGLuZMW.js";import"./mdi-CnKAdudM.js";import"./VNumberInput-CfdQXUlt.js";const Be={__name:"ShipmentsEditForm",setup(ie){const{t:s}=G(),{objectToFormData:B}=te(),_=H(),b=re(),{removeDateTimezonesFromFormData:j}=oe(),u=y(()=>_.props.record),p=N(!1),V=N(!1),I=P({packing_list_file:K().nullable(),transportation_method_id:m().required(),destination_id:m().required(),pallets_quantity:m().nullable(),volume:m().nullable(),transportation_requested_at:q().nullable(),price:m().nullable(),currency_id:m().nullable(),rate_approved_at:q().nullable(),confirmed_at:q().nullable(),products:J().of(P({id:m().required(),produced_by_manufacturer_quantity:m().required()})).min(1)}),A=y(()=>({transportation_method_id:u.value.transportation_method_id,destination_id:u.value.destination_id,pallets_quantity:u.value.pallets_quantity,volume:u.value.volume,transportation_requested_at:u.value.transportation_requested_at,forwarder:u.value.forwarder,price:u.value.price,currency_id:u.value.currency_id,rate_approved_at:u.value.rate_approved_at,confirmed_at:u.value.confirmed_at,products:u.value.products.map(i=>({id:i.id,label:i.process.full_english_product_label,produced_by_manufacturer_quantity:Number(i.produced_by_manufacturer_quantity)}))})),L={comment:null},v=y(()=>({...A.value,...L})),{handleSubmit:z,errors:n,setErrors:O,resetForm:M,meta:T}=ee({validationSchema:I,initialValues:v.value}),{values:o}=le(Object.keys(v.value)),E=z(i=>{const t=B(i);j(t),p.value=!0,axios.post(route("import.shipments.update",{record:u.value.id}),t).then(()=>{b.addUpdatedSuccessfullyMessage(),V.value?window.history.back():Q()}).catch(l=>{l.response?.status===422?(O(l.response.data.errors),b.addFixErrorsMessage()):b.addSubmitionFailedMessage()}).finally(()=>{p.value=!1})}),Q=()=>{W.reload({only:["record"],onSuccess:()=>{M({values:v.value})}})};return(i,t)=>(f(),F(e(ae),{class:"d-flex flex-column ga-6 pb-8",enctype:"multipart/form-data"},{default:r(()=>[a($,null,{default:r(()=>[a(D,null,{default:r(()=>[k(U(e(s)("Shipment")),1)]),_:1}),a(x,null,{default:r(()=>[a(d,{cols:"4"},{default:r(()=>[a(w,{label:e(s)("Manufacturer"),value:u.value.manufacturer.name,disabled:""},null,8,["label","value"])]),_:1}),a(d,{cols:"4"},{default:r(()=>[a(me,{label:e(s)("fields.Packing list"),modelValue:e(o).packing_list_file,"onUpdate:modelValue":t[0]||(t[0]=l=>e(o).packing_list_file=l),"error-messages":e(n).packing_list_file},null,8,["label","modelValue","error-messages"])]),_:1}),a(d,{cols:"4"},{default:r(()=>[a(C,{label:e(s)("fields.Transportation method"),items:e(_).props.transportationMethods,modelValue:e(o).transportation_method_id,"onUpdate:modelValue":t[1]||(t[1]=l=>e(o).transportation_method_id=l),"error-messages":e(n).transportation_method_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),a(d,{cols:"4"},{default:r(()=>[a(C,{label:e(s)("fields.Destination"),items:e(_).props.shipmentDestinations,modelValue:e(o).destination_id,"onUpdate:modelValue":t[2]||(t[2]=l=>e(o).destination_id=l),"error-messages":e(n).destination_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),a(d,{cols:"4"},{default:r(()=>[a(C,{label:e(s)("fields.Currency"),items:e(_).props.currencies,modelValue:e(o).currency_id,"onUpdate:modelValue":t[3]||(t[3]=l=>e(o).currency_id=l),"error-messages":e(n).currency_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),a(d,{cols:"4"},{default:r(()=>[a(c,{label:e(s)("fields.Pallets"),modelValue:e(o).pallets_quantity,"onUpdate:modelValue":t[4]||(t[4]=l=>e(o).pallets_quantity=l),"error-messages":e(n).pallets_quantity,min:0},null,8,["label","modelValue","error-messages"])]),_:1}),a(d,{cols:"4"},{default:r(()=>[a(c,{label:e(s)("fields.Volume"),modelValue:e(o).volume,"onUpdate:modelValue":t[5]||(t[5]=l=>e(o).volume=l),"error-messages":e(n).volume,min:0},null,8,["label","modelValue","error-messages"])]),_:1}),a(d,{cols:"4"},{default:r(()=>[a(S,{label:e(s)("dates.Transportation request"),modelValue:e(o).transportation_requested_at,"onUpdate:modelValue":t[6]||(t[6]=l=>e(o).transportation_requested_at=l),"error-messages":e(n).transportation_requested_at},null,8,["label","modelValue","error-messages"])]),_:1}),a(d,{cols:"4"},{default:r(()=>[a(w,{label:e(s)("fields.Forwarder"),modelValue:e(o).forwarder,"onUpdate:modelValue":t[7]||(t[7]=l=>e(o).forwarder=l)},null,8,["label","modelValue"])]),_:1}),a(d,{cols:"4"},{default:r(()=>[a(c,{label:e(s)("fields.Price"),modelValue:e(o).price,"onUpdate:modelValue":t[8]||(t[8]=l=>e(o).price=l),"error-messages":e(n).price,min:0,precision:2,step:.01},null,8,["label","modelValue","error-messages"])]),_:1}),a(d,{cols:"4"},{default:r(()=>[a(S,{label:e(s)("dates.Rate approved"),modelValue:e(o).rate_approved_at,"onUpdate:modelValue":t[9]||(t[9]=l=>e(o).rate_approved_at=l),"error-messages":e(n).rate_approved_at},null,8,["label","modelValue","error-messages"])]),_:1}),a(d,{cols:"4"},{default:r(()=>[a(S,{label:e(s)("dates.Confirmed"),modelValue:e(o).confirmed_at,"onUpdate:modelValue":t[10]||(t[10]=l=>e(o).confirmed_at=l),"error-messages":e(n).confirmed_at},null,8,["label","modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),a($,null,{default:r(()=>[a(D,null,{default:r(()=>[k(U(e(s)("Products")),1)]),_:1}),(f(!0),X(Y,null,Z(e(o).products,l=>(f(),F(x,{key:l.id},{default:r(()=>[a(d,null,{default:r(()=>[a(w,{label:e(s)("fields.TM Eng"),modelValue:l.label,"onUpdate:modelValue":g=>l.label=g,disabled:""},null,8,["label","modelValue","onUpdate:modelValue"])]),_:2},1024),a(d,null,{default:r(()=>[a(c,{label:e(s)("fields.Quantity"),modelValue:l.produced_by_manufacturer_quantity,"onUpdate:modelValue":g=>l.produced_by_manufacturer_quantity=g,"error-messages":e(n).produced_by_manufacturer_quantity,min:0,required:""},null,8,["label","modelValue","onUpdate:modelValue","error-messages"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),a($,null,{default:r(()=>[a(D,null,{default:r(()=>[k(U(e(s)("Comments")),1)]),_:1}),a(x,null,{default:r(()=>[a(d,null,{default:r(()=>[a(R,{modelValue:e(o).comment,"onUpdate:modelValue":t[11]||(t[11]=l=>e(o).comment=l),label:e(s)("comments.New"),"error-messages":e(n).comment,folder:"comments"},null,8,["modelValue","label","error-messages"])]),_:1}),u.value.last_comment?(f(),F(d,{key:0},{default:r(()=>[a(R,{modelValue:u.value.last_comment.body,"onUpdate:modelValue":t[12]||(t[12]=l=>u.value.last_comment.body=l),label:e(s)("comments.Last"),disabled:""},null,8,["modelValue","label"])]),_:1})):h("",!0)]),_:1})]),_:1}),a(se,null,{default:r(()=>[a(ue,{onClick:e(M),loading:p.value},null,8,["onClick","loading"]),a(de,{onClick:t[13]||(t[13]=l=>{V.value=!1,e(E)()}),loading:p.value,disabled:!e(T).valid},null,8,["loading","disabled"]),a(ne,{onClick:t[14]||(t[14]=l=>{V.value=!0,e(E)()}),loading:p.value,disabled:!e(T).valid},null,8,["loading","disabled"])]),_:1})]),_:1}))}};export{Be as default};
