import{u as S,d as P,s as F,h as $,v as j,y as w,z as R,x as k,j as B,c as E,o as M,w as r,a as s,g as N,t as A,b as e}from"./app-DbF7619L.js";import{u as O,F as T}from"./vee-validate-Cz3A8hOL.js";import{u as z}from"./useVeeFormFields-DRlw0xZe.js";import{u as I}from"./useFormData-CgBSWld4.js";import{u as G}from"./messages-CVClqrL8.js";import{D as H}from"./DefaultSheet-xxI3phiQ.js";import{_ as J}from"./DefaultTitle-DK6VMU3V.js";import{_ as q}from"./DefaultTextField-D5OAaj5Q.js";import{_ as f}from"./DefaultAutocomplete-nKCYajvt.js";import{_ as K}from"./DefaultFileInput-zwWX0Qzc.js";import{F as L}from"./FormActionsContainer-CYnXYmO8.js";import{_ as Q}from"./FormResetButton-CBqJ6blw.js";import{_ as W,a as X}from"./FormUpdateWithourRedirect-CMzhSllT.js";import{V as Y,a as n}from"./VRow-DBZypA_6.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./WrappedLabelGroup-D1FWQrLg.js";import"./StandardLabeledGroup-CZatLQxD.js";import"./filter-BrR-1rHs.js";import"./mdi-BINEaKNx.js";import"./DefaultButton-B0FsLInu.js";const ve={__name:"UsersEditPersonalDataForm",setup(Z){const{t}=S(),{objectToFormData:x}=I(),u=P(),c=G(),m=F(()=>u.props.record),p=$(!1),g=$(!1),y=j({name:k().required(),email:k().email().required(),department_id:R().required(),roles:w().required().min(1)}),_=F(()=>({name:m.value.name,email:m.value.email,photo:null,department_id:m.value.department_id,roles:m.value.roles.map(i=>i.id),responsible_countries:m.value.responsible_countries.map(i=>i.id),permissions:m.value.permissions.map(i=>i.id)})),{handleSubmit:D,errors:d,setErrors:U,resetForm:b,meta:V}=O({validationSchema:y,initialValues:_.value}),{values:o}=z(Object.keys(_.value)),v=D(i=>{const a=x(i);p.value=!0,axios.post(route("administration.users.update",{record:m.value.id}),a).then(()=>{c.addUpdatedSuccessfullyMessage(),g.value?window.history.back():C()}).catch(l=>{l.response?.status===422?(U(l.response.data.errors),c.addFixErrorsMessage()):c.addSubmitionFailedMessage()}).finally(()=>{p.value=!1})}),C=()=>{B.reload({only:["auth","record"],onSuccess:()=>{b({values:_.value})}})};return(i,a)=>(M(),E(e(T),{class:"d-flex flex-column ga-6",enctype:"multipart/form-data"},{default:r(()=>[s(H,null,{default:r(()=>[s(J,null,{default:r(()=>[N(A(e(t)("forms.Personal data")),1)]),_:1}),s(Y,null,{default:r(()=>[s(n,{cols:"4"},{default:r(()=>[s(q,{label:e(t)("fields.Name"),modelValue:e(o).name,"onUpdate:modelValue":a[0]||(a[0]=l=>e(o).name=l),"error-messages":e(d).name,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),s(n,{cols:"4"},{default:r(()=>[s(q,{label:e(t)("fields.Email"),modelValue:e(o).email,"onUpdate:modelValue":a[1]||(a[1]=l=>e(o).email=l),"error-messages":e(d).email,required:""},null,8,["label","modelValue","error-messages"])]),_:1}),s(n,{cols:"4"},{default:r(()=>[s(K,{label:e(t)("fields.Photo"),modelValue:e(o).photo,"onUpdate:modelValue":a[2]||(a[2]=l=>e(o).photo=l),"error-messages":e(d).photo,accept:".png, .jpg, .jpeg"},null,8,["label","modelValue","error-messages"])]),_:1}),s(n,{cols:"4"},{default:r(()=>[s(f,{label:e(t)("Department"),items:e(u).props.departments,modelValue:e(o).department_id,"onUpdate:modelValue":a[3]||(a[3]=l=>e(o).department_id=l),"error-messages":e(d).department_id,required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),s(n,{cols:"4"},{default:r(()=>[s(f,{label:e(t)("Roles"),items:e(u).props.roles,modelValue:e(o).roles,"onUpdate:modelValue":a[4]||(a[4]=l=>e(o).roles=l),"error-messages":e(d).roles,multiple:"",required:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),s(n,{cols:"4"},{default:r(()=>[s(f,{label:e(t)("fields.Responsible"),items:e(u).props.countriesOrderedByProcessesCount,modelValue:e(o).responsible_countries,"onUpdate:modelValue":a[5]||(a[5]=l=>e(o).responsible_countries=l),"error-messages":e(d).responsible_countries,"item-title":"code",multiple:""},null,8,["label","items","modelValue","error-messages"])]),_:1}),s(n,{cols:"4"},{default:r(()=>[s(f,{label:e(t)("Permissions"),items:e(u).props.permissions,modelValue:e(o).permissions,"onUpdate:modelValue":a[6]||(a[6]=l=>e(o).permissions=l),"error-messages":e(d).permissions,multiple:""},null,8,["label","items","modelValue","error-messages"])]),_:1})]),_:1})]),_:1}),s(L,null,{default:r(()=>[s(Q,{onClick:e(b),loading:p.value},null,8,["onClick","loading"]),s(W,{onClick:a[7]||(a[7]=l=>{g.value=!0,e(v)()}),loading:p.value,disabled:!e(V).valid},null,8,["loading","disabled"]),s(X,{onClick:a[8]||(a[8]=l=>{g.value=!1,e(v)()}),loading:p.value,disabled:!e(V).valid},null,8,["loading","disabled"])]),_:1})]),_:1}))}};export{ve as default};
