import{aH as o,j as s,v as d}from"./app-CAQEU6tV.js";import{b as _,c as u,n as l,d as c,a as p,e as g}from"./queryHelper-C2x2SXyh.js";function h(t){return{updateRecord(e){if(!e||!e.id)return;const a=this.records.findIndex(i=>i.id===e.id);a!==-1?this.records[a]=e:this.records.unshift(e)},updateRecords(e=[]){e.forEach(this.updateRecord)},removeRecord(e){const a=this.records.findIndex(i=>i.id===e);a!==-1&&this.records.splice(a,1)}}}const r={page:1,per_page:50,order_by:"updated_at",order_direction:"desc",total_records:0,last_page:1,navigate_to_page:1},n={order_by_days_past_since_last_activity:null,contracted_in_asp:null,registered_in_asp:null,product_dosage:null,product_pack:null,trademark_en:null,trademark_ru:null,active_status_start_date_range:null,created_at:null,updated_at:null,deadline_status:null,manufacturer_region:null,manufacturer_analyst_user_id:null,manufacturer_bdm_user_id:null,responsible_person_id:null,manufacturer_category_id:null,general_status_name_for_analysts:[],product_brand:[],id:[],product_inn_id:[],manufacturer_id:[],product_form_id:[],country_id:[],status_id:[],status_general_status_id:[],manufacturer_country_id:[],product_class_id:[]},f=route("api.processes.get"),b=o("MADProcessesTable",{state:()=>({records:[],loading:!1,initializedFromInertiaPage:!1,selected:[],isTrashPage:!1,pagination:{...r},filters:{...n}}),actions:{...h(),detectCurrentPage(){this.isTrashPage=route().current("*.trash")},initFromInertiaPage(t){this.records=[];const e=t.props.query;this.pagination.page=Number(e.page??1),this.pagination.per_page=Number(e.per_page??r.per_page),this.pagination.order_by=e.order_by??r.order_by,this.pagination.order_direction=e.order_direction??r.order_direction,this.navigate_to_page=this.pagination.page,this.filters.product_dosage=e.product_dosage,this.filters.product_pack=e.product_pack,this.filters.trademark_en=e.trademark_en,this.filters.trademark_ru=e.trademark_ru,this.filters.deadline_status=e.deadline_status,this.filters.manufacturer_region=e.manufacturer_region,this.filters.general_status_name_for_analysts=e.general_status_name_for_analysts,this.filters.product_brand=e.product_brand,this.filters.id=e.id,l(this.filters,e,["order_by_days_past_since_last_activity","contracted_in_asp","registered_in_asp"]),c(this.filters,e,["manufacturer_analyst_user_id","manufacturer_bdm_user_id","responsible_person_id","manufacturer_category_id"]),p(this.filters,e,["product_inn_id","manufacturer_id","product_form_id","country_id","status_id","status_general_status_id","manufacturer_country_id","product_class_id"]),g(this.filters,e,["active_status_start_date_range","created_at","updated_at"]),this.initializedFromInertiaPage=!0},toQuery(){const t={only_trashed:this.isTrashPage?!0:null,page:this.pagination.page,per_page:this.pagination.per_page,order_by:this.pagination.order_by,order_direction:this.pagination.order_direction,...this.filters,..._(this.filters,["active_status_start_date_range","created_at","updated_at"])};return t.page===r.page&&delete t.page,t.per_page===r.per_page&&delete t.per_page,t.order_by===r.order_by&&delete t.order_by,t.order_direction===r.order_direction&&delete t.order_direction,u(t)},fetchRecords({updateUrl:t=!0}={}){this.loading=!0,d.get(f,{params:this.toQuery()}).then(e=>{this.records=e.data.data,this.pagination.total_records=e.data.total,this.pagination.last_page=e.data.last_page,this.pagination.navigate_to_page=e.data.current_page,t&&this.updateUrlAfterFetch()}).finally(()=>{this.loading=!1,this.selected=[]})},fetchRecordsIfOptionsChanged(t){const e=t.sortBy?.[0]??{};(t.page!==this.pagination.page||t.itemsPerPage!==this.pagination.per_page||e.key!==this.pagination.order_by||e.order!==this.pagination.order_direction)&&(this.pagination.page=t.page,this.pagination.per_page=t.itemsPerPage,this.pagination.order_by=e.key??this.pagination.order_by,this.pagination.order_direction=e.order??this.pagination.order_direction,this.fetchRecords({updateUrl:!0}))},updateUrlAfterFetch(){s.get(route(route().current()),this.toQuery(),{only:["smartFilterDependencies","query"],replace:!0,preserveState:!0,preserveScroll:!0})},handleNavigateToPage(){this.pagination.page=this.pagination.navigate_to_page,this.fetchRecords({updateUrl:!0})},resetState(){this.records=[],this.loading=!1,this.selected=[],this.pagination={...r},this.filters={...n}},resetUrl(){s.get(route(route().current()),{},{only:["smartFilterDependencies"],replace:!0,preserveState:!0,preserveScroll:!0})},applyFilter(){this.pagination.page=1,this.fetchRecords()},resetFilter(){this.resetState(),this.resetUrl(),this.fetchRecords()}}});export{b as u};
